import{r as c,j as e,B as Ce,T as ae,D as xs,X as ne,S as ps,I as Ne,C as me,a as bs,b as fs,A as gs,c as ue,U as Me,d as vs,L as ws,M as js,F as ys,e as le,f as ve,g as re,P as fe,h as Pe,i as Ns,R as De,H as Ie,k as Ss,l as Ee,m as $e,n as Cs,E as Is,o as ke,p as de,q as ks,s as Us,W as Le,Z as _e,t as As,u as Ts,v as Ds,w as Fe,x as Es,y as Rs,z as Ps}from"./react-vendor-6qOBSu6s.js";import{a as ce,P as x,R as $s,L as Ls,C as _s,X as Fs,Y as Os,T as Bs,b as Xs,c as Vs}from"./vendor-DMb609Cv.js";import{i as Hs,g as qs,a as Ms,b as Gs,e as zs,G as Ws,d as Y,c as ge,s as ie,f as Oe,u as Js,h as Be,j as Xe}from"./firebase-vendor-BkZVVcGE.js";class Ks{constructor(){this.logs=[],this.maxLogs=1e3,this.listeners=new Set,this.logLevel="debug",this.levels={debug:0,info:1,warn:2,error:3},console.log("%cüìù –°–∏—Å—Ç–µ–º–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞","color: #10b981; font-weight: bold; font-size: 14px",{logLevel:this.logLevel,maxLogs:this.maxLogs,timestamp:new Date().toISOString()})}shouldLog(s){const t=this.levels[this.logLevel]||1;return(this.levels[s]||1)>=t}addLog(s,t,n,i=null,r=null){if(!this.shouldLog(s))return;const u={id:Date.now()+Math.random(),timestamp:new Date().toISOString(),level:s,category:t,message:n,data:i?this.sanitizeData(i):null,error:r?this.formatError(r):null,stack:r?.stack||null};this.logs.unshift(u),this.logs.length>this.maxLogs&&(this.logs=this.logs.slice(0,this.maxLogs)),this.logToConsole(s,t,n,i,r),this.notifyListeners(u)}sanitizeData(s){if(!s||typeof s!="object")return s;const t=["password","passwordHash","token","apiKey","secret","key"],n={...s};for(const i in n)t.some(r=>i.toLowerCase().includes(r.toLowerCase()))?n[i]="***REDACTED***":typeof n[i]=="object"&&n[i]!==null&&(n[i]=this.sanitizeData(n[i]));return n}formatError(s){return s?{name:s.name,message:s.message,code:s.code,response:s.response?{status:s.response.status,statusText:s.response.statusText,data:this.sanitizeData(s.response.data)}:null}:null}logToConsole(s,t,n,i,r){const l=`${`[${t}]`} ${n}`;let f=null;if(i)if(typeof i=="object")try{f=JSON.stringify(i,null,2)}catch{f=String(i)}else f=i;const N=r?r.stack||r.message||r:null;switch(s){case"debug":f||N?console.debug(`%c${l}`,"color: #6b7280; font-style: italic",f||"",N||""):console.debug(`%c${l}`,"color: #6b7280; font-style: italic");break;case"info":f||N?console.log(`%c${l}`,"color: #3b82f6; font-weight: bold",f||"",N||""):console.log(`%c${l}`,"color: #3b82f6; font-weight: bold");break;case"warn":f||N?console.warn(l,f||"",N||""):console.warn(l);break;case"error":console.group(`%c${l}`,"color: red; font-weight: bold"),f&&console.log("%cData:","color: orange; font-weight: bold",f),N&&console.error("%cError:","color: red; font-weight: bold",N),r&&r.stack&&console.log("%cStack:","color: gray; font-weight: bold",r.stack),console.groupEnd();break;default:f||N?console.log(l,f||"",N||""):console.log(l)}}notifyListeners(s){this.listeners.forEach(t=>{try{t(s)}catch(n){console.error("–û—à–∏–±–∫–∞ –≤ —Å–ª—É—à–∞—Ç–µ–ª–µ –ª–æ–≥–æ–≤:",n)}})}subscribe(s){return this.listeners.add(s),()=>{this.listeners.delete(s)}}debug(s,t,n=null){this.addLog("debug",s,t,n)}info(s,t,n=null){this.addLog("info",s,t,n)}warn(s,t,n=null,i=null){this.addLog("warn",s,t,n,i)}error(s,t,n=null,i=null){this.addLog("error",s,t,n,i)}getLogs(s={}){let t=[...this.logs];if(s.level&&(t=t.filter(n=>n.level===s.level)),s.category&&(t=t.filter(n=>n.category===s.category)),s.search){const n=s.search.toLowerCase();t=t.filter(i=>i.message.toLowerCase().includes(n)||i.data&&JSON.stringify(i.data).toLowerCase().includes(n)||i.error&&JSON.stringify(i.error).toLowerCase().includes(n))}return t}getStats(){const s={total:this.logs.length,byLevel:{debug:0,info:0,warn:0,error:0},byCategory:{},latestError:null};return this.logs.forEach(t=>{s.byLevel[t.level]=(s.byLevel[t.level]||0)+1,s.byCategory[t.category]=(s.byCategory[t.category]||0)+1,t.level==="error"&&!s.latestError&&(s.latestError=t)}),s}clear(){this.logs=[],this.notifyListeners({type:"clear"})}exportJSON(s={}){const t=this.getLogs(s);return JSON.stringify(t,null,2)}exportText(s={}){return this.getLogs(s).map(n=>{let r=`[${new Date(n.timestamp).toLocaleString("ru-RU")}] [${n.level.toUpperCase()}] [${n.category}] ${n.message}`;return n.data&&(r+=`
  Data: ${JSON.stringify(n.data,null,2)}`),n.error&&(r+=`
  Error: ${JSON.stringify(n.error,null,2)}`),n.stack&&(r+=`
  Stack: ${n.stack}`),r}).join(`

`)}setLogLevel(s){this.levels.hasOwnProperty(s)&&(this.logLevel=s,this.info("Logger",`–£—Ä–æ–≤–µ–Ω—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω –Ω–∞: ${s}`))}getLogLevel(){return this.logLevel}}const o=new Ks;class Ys{constructor(s=5,t=6e4){this.failureCount=0,this.threshold=s,this.timeout=t,this.state="CLOSED",this.nextAttempt=Date.now()}async execute(s){if(this.state==="OPEN"){if(Date.now()<this.nextAttempt)throw new Error("Circuit breaker is OPEN - API temporarily unavailable");this.state="HALF_OPEN"}try{const t=await s();return this.onSuccess(),t}catch(t){throw this.onFailure(),t}}onSuccess(){this.failureCount=0,this.state="CLOSED"}onFailure(){this.failureCount++,this.failureCount>=this.threshold&&(this.state="OPEN",this.nextAttempt=Date.now()+this.timeout,o.warn("ThreeXUI","Circuit breaker opened due to failures",{failureCount:this.failureCount,threshold:this.threshold,nextAttempt:new Date(this.nextAttempt).toISOString()}))}getState(){return{state:this.state,failureCount:this.failureCount,nextAttempt:this.nextAttempt>Date.now()?new Date(this.nextAttempt).toISOString():null}}}class Zs{constructor(s=10,t=1e3){this.requests=[],this.maxRequests=s,this.windowMs=t,this.cleanupInterval=setInterval(()=>{const n=Date.now(),i=this.requests.length;this.requests=this.requests.filter(u=>n-u<this.windowMs);const r=this.requests.length;i!==r&&o.debug("ThreeXUI","RateLimiter cleanup",{removed:i-r,remaining:r})},this.windowMs*2)}destroy(){this.cleanupInterval&&(clearInterval(this.cleanupInterval),this.cleanupInterval=null)}async throttle(){const s=Date.now();if(this.requests=this.requests.filter(t=>s-t<this.windowMs),this.requests.length>=this.maxRequests){const t=this.requests[0],n=this.windowMs-(s-t);return o.debug("ThreeXUI","Rate limit: waiting",{waitTime:n,queueLength:this.requests.length}),await new Promise(i=>setTimeout(i,n)),this.throttle()}this.requests.push(s)}}class Q{static instance=null;constructor(){if(Q.instance)return o.debug("ThreeXUI","–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ —ç–∫–∑–µ–º–ø–ª—è—Ä–∞ (Singleton)"),Q.instance;this.baseURL="/api/xui",this.api=ce.create({baseURL:this.baseURL,withCredentials:!0,headers:{"Content-Type":"application/json"}}),this.username="vladislav4endev",this.password="v902l733a00d94%",this.clientsCache=new Map,this.cacheExpiry=300*1e3,this.lastCacheUpdate=0,this.cacheRefreshing=!1,this.cacheRefreshPromise=null,this.circuitBreaker=new Ys(5,6e4),this.rateLimiter=new Zs(10,1e3),this.apiVersion=null,this.useNewClientAPI=!0,this.setupInterceptors(),Q.instance=this}static getInstance(){return Q.instance||(Q.instance=new Q),Q.instance}setupInterceptors(){this.api.interceptors.request.use(s=>{const t={method:s.method?.toUpperCase(),url:s.url,baseURL:s.baseURL,fullURL:`${s.baseURL}${s.url}`,headers:this.sanitizeHeaders(s.headers),params:s.params};return s.data&&(t.data=this.sanitizeRequestData(s.data)),o.info("ThreeXUI",`‚Üí API Request: ${s.method?.toUpperCase()} ${s.url}`,t),s},s=>(o.error("ThreeXUI","–û—à–∏–±–∫–∞ –ø—Ä–∏ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–∏ –∑–∞–ø—Ä–æ—Å–∞",{message:s.message,config:s.config?{method:s.config.method,url:s.config.url,baseURL:s.config.baseURL}:null},s),Promise.reject(s))),this.api.interceptors.response.use(s=>{const t={status:s.status,statusText:s.statusText,url:s.config?.url,method:s.config?.method?.toUpperCase()};if(s.data){const n=JSON.stringify(s.data);n.length>1e3?t.data=`[–ë–æ–ª—å—à–æ–π –æ—Ç–≤–µ—Ç: ${n.length} —Å–∏–º–≤–æ–ª–æ–≤] ${n.substring(0,500)}...`:t.data=s.data}return o.info("ThreeXUI",`‚Üê API Response: ${s.status} ${s.config?.method?.toUpperCase()} ${s.config?.url}`,t),s},s=>{const t={status:s.response?.status,statusText:s.response?.statusText,url:s.config?.url,method:s.config?.method?.toUpperCase(),baseURL:s.config?.baseURL,requestData:s.config?.data?this.sanitizeRequestData(s.config.data):null};if(s.response?.data){const n=JSON.stringify(s.response.data);n.length>500?t.responseData=`[–ë–æ–ª—å—à–æ–π –æ—Ç–≤–µ—Ç: ${n.length} —Å–∏–º–≤–æ–ª–æ–≤] ${n.substring(0,300)}...`:t.responseData=s.response.data}return s.response?o.error("ThreeXUI",`‚Üê API Error Response: ${s.response.status} ${s.config?.method?.toUpperCase()} ${s.config?.url}`,t,s):s.request?o.error("ThreeXUI",`‚Üê API Network Error: ${s.config?.method?.toUpperCase()} ${s.config?.url}`,{...t,message:"–ù–µ—Ç –æ—Ç–≤–µ—Ç–∞ –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞",timeout:s.code==="ECONNABORTED"},s):o.error("ThreeXUI",`‚Üê API Request Setup Error: ${s.config?.method?.toUpperCase()} ${s.config?.url}`,{...t,message:s.message},s),Promise.reject(s)})}sanitizeHeaders(s){if(!s)return null;const t={...s},n=["authorization","cookie","x-api-key"];return Object.keys(t).forEach(i=>{n.some(r=>i.toLowerCase().includes(r.toLowerCase()))&&(t[i]="***REDACTED***")}),t}sanitizeRequestData(s){if(!s)return null;if(typeof s=="string")try{const t=JSON.parse(s);return this.sanitizeObject(t)}catch{return s.length>200?s.substring(0,200)+"...":s}return typeof s=="object"?this.sanitizeObject(s):s}sanitizeObject(s){if(!s||typeof s!="object")return s;if(Array.isArray(s))return s.map(i=>this.sanitizeObject(i));const t=["password","token","apiKey","secret","key","auth","credentials"],n={...s};return Object.keys(n).forEach(i=>{t.some(r=>i.toLowerCase().includes(r.toLowerCase()))?n[i]="***REDACTED***":typeof n[i]=="object"&&n[i]!==null&&(n[i]=this.sanitizeObject(n[i]))}),n}async retryRequest(s,t=3,n=1e3,i=null){for(let r=0;r<t;r++)try{return await s()}catch(u){if(r===t-1||i&&!i(u)||u.response?.status===401||u.response?.status===403||u.response?.status===400||u.message?.includes("—É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç"))throw u;const l=n*Math.pow(2,r);o.warn("ThreeXUI",`Retry ${r+1}/${t} after error`,{attempt:r+1,maxRetries:t,waitTime:l,error:u.message}),await new Promise(f=>setTimeout(f,l))}}async refreshClientCache(){const s=Date.now();if(s-this.lastCacheUpdate<this.cacheExpiry){o.debug("ThreeXUI","–ö–µ—à –∫–ª–∏–µ–Ω—Ç–æ–≤ –µ—â–µ –≤–∞–ª–∏–¥–µ–Ω",{age:s-this.lastCacheUpdate,expiry:this.cacheExpiry});return}return this.cacheRefreshing?(o.debug("ThreeXUI","–ö–µ—à —É–∂–µ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è, –æ–∂–∏–¥–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è"),this.cacheRefreshPromise):(this.cacheRefreshing=!0,this.cacheRefreshPromise=(async()=>{try{o.debug("ThreeXUI","–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–µ—à–∞ –∫–ª–∏–µ–Ω—Ç–æ–≤");const t=await this.getInbounds();this.clientsCache.clear();for(const n of t){let i=[];if(n.settings)try{i=(typeof n.settings=="string"?JSON.parse(n.settings):n.settings).clients||[]}catch(r){o.warn("ThreeXUI","–û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ settings –∏–Ω–±–∞—É–Ω–¥–∞",{inboundId:n.id,error:r.message}),i=n.clients||[]}else i=n.clients||[];i.forEach(r=>{r.email&&this.clientsCache.set(r.email,{...r,inboundId:n.id,inboundTag:n.tag,inbound:n})})}this.lastCacheUpdate=Date.now(),o.info("ThreeXUI","–ö–µ—à –∫–ª–∏–µ–Ω—Ç–æ–≤ –æ–±–Ω–æ–≤–ª–µ–Ω",{clientsCount:this.clientsCache.size,inboundsCount:t.length})}catch(t){o.error("ThreeXUI","–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–µ—à–∞ –∫–ª–∏–µ–Ω—Ç–æ–≤",null,t)}finally{this.cacheRefreshing=!1,this.cacheRefreshPromise=null}})(),this.cacheRefreshPromise)}invalidateCache(){this.lastCacheUpdate=0,o.debug("ThreeXUI","–ö–µ—à –∫–ª–∏–µ–Ω—Ç–æ–≤ –∏–Ω–≤–∞–ª–∏–¥–∏—Ä–æ–≤–∞–Ω")}async healthCheck(){const s={api_reachable:!1,authenticated:!1,inbound_accessible:!1,response_time:null,circuit_breaker_state:this.circuitBreaker.getState(),cache_status:{clients_cached:this.clientsCache.size,cache_age:this.lastCacheUpdate?Date.now()-this.lastCacheUpdate:null},error:null},t=Date.now();try{const n=await this.api.get("/panel/api/inbounds",{timeout:5e3});s.api_reachable=!0,s.response_time=Date.now()-t;const i=n.data||{};i.success!==!1&&i.success!==0&&(s.authenticated=!0);const r="1";if(r)try{const u=await this.getInbound(r);s.inbound_accessible=!!u}catch(u){s.inbound_accessible=!1,s.error=`Inbound check failed: ${u.message}`}}catch(n){s.error=n.message,s.response_time=Date.now()-t,n.response?(s.api_reachable=!0,(n.response.status===401||n.response.status===403)&&(s.authenticated=!1)):s.api_reachable=!1}return s}async login(){try{if(o.debug("ThreeXUI","–ù–∞—á–∞–ª–æ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –≤ 3x-ui",{username:this.username?"—É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω":"–Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω",password:this.password?"—É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω":"–Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω",baseURL:this.baseURL}),!this.username||!this.password){const n=new Error(`XUI credentials –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è.
–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –≤ .env —Ñ–∞–π–ª–µ:
- VITE_XUI_USERNAME=${this.username?"—É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω":"–ù–ï –£–°–¢–ê–ù–û–í–õ–ï–ù"}
- VITE_XUI_PASSWORD=${this.password?"—É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω":"–ù–ï –£–°–¢–ê–ù–û–í–õ–ï–ù"}
–ü–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è .env –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ dev-—Å–µ—Ä–≤–µ—Ä (npm run dev)`);throw o.error("ThreeXUI","–û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç credentials –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏",{hasUsername:!!this.username,hasPassword:!!this.password},n),n}const t=(await this.api.post("/login",{username:this.username||"",password:this.password||""},{headers:{"Content-Type":"application/json",Accept:"application/json"}})).data||{};if(t.success===!1||t.success===0){const n=new Error(t.msg||"–û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏");throw o.error("ThreeXUI","–û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –≤ 3x-ui",{response:t},n),n}return o.info("ThreeXUI","–£—Å–ø–µ—à–Ω–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –≤ 3x-ui"),t}catch(s){o.error("ThreeXUI","–û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –≤ 3x-ui",{status:s.response?.status,statusText:s.response?.statusText,url:s.config?.url,baseURL:this.baseURL},s);let t=s.response?.data?.msg||s.response?.data?.message||s.message||"–ù–µ —É–¥–∞–ª–æ—Å—å –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞—Ç—å—Å—è –≤ –ø–∞–Ω–µ–ª–∏ 3x-ui";throw s.response?.status===404?t=`–ü–∞–Ω–µ–ª—å 3x-ui –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞ (404). –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:
- XUI_HOST –≤ .env –¥–æ–ª–∂–µ–Ω —É–∫–∞–∑—ã–≤–∞—Ç—å –Ω–∞ –ø–∞–Ω–µ–ª—å (–Ω–∞–ø—Ä–∏–º–µ—Ä: http://localhost:2053)
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø–∞–Ω–µ–ª—å 3x-ui –∑–∞–ø—É—â–µ–Ω–∞ –∏ –¥–æ—Å—Ç—É–ø–Ω–∞
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–æ–∫—Å–∏ –≤ vite.config.js
- –ü–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è .env –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ dev-—Å–µ—Ä–≤–µ—Ä

–¢–µ–∫—É—â–∏–π baseURL: ${this.baseURL}
–ó–∞–ø—Ä–æ—Å: ${s.config?.method?.toUpperCase()} ${s.config?.url}`:(s.response?.status===401||s.response?.status===403)&&(t=`–û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ (${s.response?.status}). –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å VITE_XUI_USERNAME –∏ VITE_XUI_PASSWORD –≤ .env —Ñ–∞–π–ª–µ.`),new Error(t)}}async addClient(s,t,n,i={}){return this.circuitBreaker.execute(async()=>(await this.rateLimiter.throttle(),this.retryRequest(async()=>{try{o.info("ThreeXUI","–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞",{inboundId:s,email:t,uuid:n,options:i}),await this.ensureAuthenticated(),o.debug("ThreeXUI","–ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ–± –∏–Ω–±–∞—É–Ω–¥–µ",{inboundId:s});let r;try{const j=await this.api.get(`/panel/api/inbounds/get/${s}`);r=j.data?.obj||j.data}catch(j){if(j.response?.status===404){o.warn("ThreeXUI","–≠–Ω–¥–ø–æ–∏–Ω—Ç get/{id} –Ω–µ –Ω–∞–π–¥–µ–Ω, –ø—Ä–æ–±—É–µ–º –ø–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –∏–Ω–±–∞—É–Ω–¥–æ–≤",{inboundId:s});try{const y=await this.api.get("/panel/api/inbounds"),m=y.data?.obj||y.data;Array.isArray(m)&&(r=m.find(T=>T.id===Number(s)||T.id===String(s)))}catch(y){throw o.error("ThreeXUI","–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –∏–Ω–±–∞—É–Ω–¥–æ–≤",{inboundId:s},y),new Error(`–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–± –∏–Ω–±–∞—É–Ω–¥–µ ${s}. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–æ–∫—Å–∏ –∏ XUI_HOST.`)}}else throw j}if(!r){const j=new Error(`–ò–Ω–±–∞—É–Ω–¥ —Å ID ${s} –Ω–µ –Ω–∞–π–¥–µ–Ω. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å VITE_XUI_INBOUND_ID`);throw o.error("ThreeXUI","–ò–Ω–±–∞—É–Ω–¥ –Ω–µ –Ω–∞–π–¥–µ–Ω",{inboundId:s},j),j}if(r.clients?.find(j=>j.email===t)){const j=new Error(`–ö–ª–∏–µ–Ω—Ç —Å email ${t} —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ —ç—Ç–æ–º –∏–Ω–±–∞—É–Ω–¥–µ`);throw o.warn("ThreeXUI","–ü–æ–ø—ã—Ç–∫–∞ –¥–æ–±–∞–≤–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞",{email:t,inboundId:s},j),j}const l={id:n,email:t,flow:i.flow||"xtls-rprx-vision",limitIp:i.limitIp!==void 0?i.limitIp:1,totalGB:i.totalGB!==void 0?i.totalGB:0,expiryTime:i.expiryTime!==void 0?i.expiryTime:0,enable:i.enable!==void 0?i.enable:!0,tgId:i.tgId||"",subId:i.subId||"",reset:0},f={id:Number(s),settings:JSON.stringify({clients:[l]})};o.debug("ThreeXUI","–û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ –Ω–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞",{inboundId:s,email:t,requestBody:{...f,settings:"[JSON string]"}});const N=await this.api.post("/panel/api/inbounds/addClient",f);return o.info("ThreeXUI","–ö–ª–∏–µ–Ω—Ç —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω",{inboundId:s,email:t,uuid:n}),this.invalidateCache(),N.data}catch(r){throw o.error("ThreeXUI","–û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∫–ª–∏–µ–Ω—Ç–∞",{inboundId:s,email:t,status:r.response?.status},r),new Error(r.response?.data?.msg||r.response?.data?.message||r.message||"–ù–µ —É–¥–∞–ª–æ—Å—å –¥–æ–±–∞–≤–∏—Ç—å –∫–ª–∏–µ–Ω—Ç–∞ –≤ 3x-ui")}})))}async addClientFallback(s,t,n,i={}){return this.addClient(s,t,n,i)}async deleteClient(s,t){return this.circuitBreaker.execute(async()=>(await this.rateLimiter.throttle(),this.retryRequest(async()=>{try{o.info("ThreeXUI","–£–¥–∞–ª–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞",{inboundId:s,email:t}),await this.ensureAuthenticated();const i=(await this.api.get(`/panel/api/inbounds/get/${s}`)).data,r=i?.obj||i;if(!r){const f=new Error(`–ò–Ω–±–∞—É–Ω–¥ —Å ID ${s} –Ω–µ –Ω–∞–π–¥–µ–Ω`);throw o.error("ThreeXUI","–ò–Ω–±–∞—É–Ω–¥ –Ω–µ –Ω–∞–π–¥–µ–Ω –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏",{inboundId:s},f),f}const u=r.clients?.find(f=>f.email===t);if(!u){const f=new Error(`–ö–ª–∏–µ–Ω—Ç —Å email ${t} –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ —ç—Ç–æ–º –∏–Ω–±–∞—É–Ω–¥–µ`);throw o.warn("ThreeXUI","–ö–ª–∏–µ–Ω—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏",{email:t,inboundId:s},f),f}const l=await this.api.post(`/panel/api/inbounds/${s}/delClient/${u.id}`);return o.info("ThreeXUI","–ö–ª–∏–µ–Ω—Ç —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω",{inboundId:s,email:t}),this.invalidateCache(),l.data}catch(n){if(o.error("ThreeXUI","–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –∫–ª–∏–µ–Ω—Ç–∞",{inboundId:s,email:t,status:n.response?.status},n),n.response?.status===404||n.response?.status===405){o.warn("ThreeXUI","–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ fallback –º–µ—Ç–æ–¥–∞ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è –∫–ª–∏–µ–Ω—Ç–∞",{inboundId:s,email:t});const i=await this.deleteClientFallback(s,t);return this.invalidateCache(),i}throw new Error(n.response?.data?.msg||n.response?.data?.message||n.message||"–ù–µ —É–¥–∞–ª–æ—Å—å —É–¥–∞–ª–∏—Ç—å –∫–ª–∏–µ–Ω—Ç–∞ –∏–∑ 3x-ui")}})))}async deleteClientFallback(s,t){const i=(await this.api.get(`/panel/api/inbounds/get/${s}`)).data,r=i?.obj||i;if(!r)throw new Error(`–ò–Ω–±–∞—É–Ω–¥ —Å ID ${s} –Ω–µ –Ω–∞–π–¥–µ–Ω`);const u=r.clients?.findIndex(N=>N.email===t);if(u===-1||u===void 0)throw new Error(`–ö–ª–∏–µ–Ω—Ç —Å email ${t} –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ —ç—Ç–æ–º –∏–Ω–±–∞—É–Ω–¥–µ`);const l=r.clients.filter(N=>N.email!==t);return(await this.api.post(`/panel/api/inbounds/update/${s}`,{...r,clients:l})).data}async getClientStats(s){try{o.debug("ThreeXUI","–ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∫–ª–∏–µ–Ω—Ç–∞",{email:s}),await this.ensureAuthenticated(),await this.refreshClientCache();let t=null,n=null;const i=this.clientsCache.get(s);if(i)t=i,n=i.inbound;else{const N=await this.getInbounds();if(!N||N.length===0){const j=new Error("–ò–Ω–±–∞—É–Ω–¥—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã");throw o.warn("ThreeXUI","–ò–Ω–±–∞—É–Ω–¥—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏",null,j),j}for(const j of N)if(j.clients&&j.clients.length>0){const y=j.clients.find(m=>m.email===s);if(y){t=y,n=j;break}}}if(!t){const N=new Error(`–ö–ª–∏–µ–Ω—Ç —Å email ${s} –Ω–µ –Ω–∞–π–¥–µ–Ω`);throw o.warn("ThreeXUI","–ö–ª–∏–µ–Ω—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏",{email:s},N),N}o.debug("ThreeXUI","–ó–∞–ø—Ä–æ—Å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∫–ª–∏–µ–Ω—Ç–∞",{clientId:t.id,email:s});const u=(await this.api.get(`/panel/api/clients/${t.id}/stats`)).data.obj||{};o.debug("ThreeXUI","–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫–ª–∏–µ–Ω—Ç–∞ –ø–æ–ª—É—á–µ–Ω–∞",{email:s,stats:u});const l=typeof u.up=="number"?u.up:u.up||0,f=typeof u.down=="number"?u.down:u.down||0;return{email:s,uuid:t.id,inboundId:n.id,inboundTag:n.tag,trafficUp:l,trafficDown:f,trafficTotal:l+f,expiryTime:t.expiryTime?t.expiryTime>1e12?t.expiryTime:t.expiryTime*1e3:0,totalGB:t.totalGB||0,enable:t.enable!==!1,limitIp:t.limitIp||0}}catch(t){throw o.error("ThreeXUI","–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∫–ª–∏–µ–Ω—Ç–∞",{email:s,status:t.response?.status},t),new Error(t.response?.data?.msg||t.response?.data?.message||t.message||"–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∫–ª–∏–µ–Ω—Ç–∞")}}async ensureAuthenticated(){try{o.debug("ThreeXUI","–ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏");try{const t=(await this.api.get("/panel/api/inbounds")).data||{};if(t.success===!1||t.success===0)throw Object.assign(new Error("–ù–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω"),{response:{status:401}});o.debug("ThreeXUI","–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∞");return}catch(s){if(s.response?.status===401||s.response?.status===403){o.info("ThreeXUI","–¢—Ä–µ–±—É–µ—Ç—Å—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è, –≤—ã–ø–æ–ª–Ω—è—é login"),await this.login();try{await this.api.get("/panel/api/inbounds"),o.debug("ThreeXUI","–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞ –ø–æ—Å–ª–µ login");return}catch(t){throw o.error("ThreeXUI","–û—à–∏–±–∫–∞ –ø–æ—Å–ª–µ –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏",{status:t.response?.status,url:t.config?.url},t),t}}else if(s.response?.status===404){o.warn("ThreeXUI","–≠–Ω–¥–ø–æ–∏–Ω—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω (404), –ø—Ä–æ–±—É–µ–º –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é",{url:s.config?.url,baseURL:this.baseURL});try{await this.login(),o.debug("ThreeXUI","–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ –ø–æ—Å–ª–µ 404");return}catch(t){o.error("ThreeXUI","–û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –ø–æ—Å–ª–µ 404",null,t);const n="–Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω",i=this.username?"—É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω":"–Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω",r=this.password?"—É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω":"–Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω";throw new Error(`–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ –ø–∞–Ω–µ–ª–∏ 3x-ui (404). –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ .env —Ñ–∞–π–ª–µ:
- XUI_HOST (–¥–ª—è vite.config.js): ${n}
- VITE_XUI_USERNAME: ${i}
- VITE_XUI_PASSWORD: ${r}
- VITE_XUI_INBOUND_ID: 1

–û—à–∏–±–∫–∞: ${t.message||s.message}

–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ:
1. XUI_HOST –≤ .env —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ –ø–∞–Ω–µ–ª—å 3x-ui (–Ω–∞–ø—Ä–∏–º–µ—Ä: http://localhost:2053 –∏–ª–∏ http://your-server:2053/path)
2. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏–ª–∏ dev-—Å–µ—Ä–≤–µ—Ä –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è .env
3. –ü—Ä–æ–∫—Å–∏ –≤ vite.config.js –ø—Ä–∞–≤–∏–ª—å–Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω`)}}else throw o.error("ThreeXUI","–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏",{status:s.response?.status,url:s.config?.url,baseURL:this.baseURL},s),s}}catch(s){throw o.error("ThreeXUI","–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏",{status:s.response?.status,url:s.config?.url,message:s.message},s),s}}async updateClient(s,t,n={}){try{o.info("ThreeXUI","–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞",{inboundId:s,email:t,updates:n}),await this.ensureAuthenticated();const r=(await this.api.get(`/panel/api/inbounds/get/${s}`)).data,u=r?.obj||r;if(!u){const j=new Error(`–ò–Ω–±–∞—É–Ω–¥ —Å ID ${s} –Ω–µ –Ω–∞–π–¥–µ–Ω`);throw o.error("ThreeXUI","–ò–Ω–±–∞—É–Ω–¥ –Ω–µ –Ω–∞–π–¥–µ–Ω –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏",{inboundId:s},j),j}const l=u.clients?.find(j=>j.email===t);if(!l){const j=new Error(`–ö–ª–∏–µ–Ω—Ç —Å email ${t} –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ —ç—Ç–æ–º –∏–Ω–±–∞—É–Ω–¥–µ`);throw o.warn("ThreeXUI","–ö–ª–∏–µ–Ω—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏",{email:t,inboundId:s},j),j}const f={...l,...n,id:l.id,email:t},N=await this.api.post(`/panel/api/inbounds/${s}/updateClient/${l.id}`,f);return o.info("ThreeXUI","–ö–ª–∏–µ–Ω—Ç —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω",{inboundId:s,email:t}),this.invalidateCache(),N.data}catch(i){if(o.error("ThreeXUI","–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–ª–∏–µ–Ω—Ç–∞",{inboundId:s,email:t,status:i.response?.status},i),i.response?.status===404||i.response?.status===405)return o.warn("ThreeXUI","–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ fallback –º–µ—Ç–æ–¥–∞ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–ª–∏–µ–Ω—Ç–∞",{inboundId:s,email:t}),this.updateClientFallback(s,t,n);throw new Error(i.response?.data?.msg||i.response?.data?.message||i.message||"–ù–µ —É–¥–∞–ª–æ—Å—å –æ–±–Ω–æ–≤–∏—Ç—å –∫–ª–∏–µ–Ω—Ç–∞ –≤ 3x-ui")}}async updateClientFallback(s,t,n={}){const r=(await this.api.get(`/panel/api/inbounds/get/${s}`)).data,u=r?.obj||r;if(!u)throw new Error(`–ò–Ω–±–∞—É–Ω–¥ —Å ID ${s} –Ω–µ –Ω–∞–π–¥–µ–Ω`);const l=u.clients?.findIndex(j=>j.email===t);if(l===-1||l===void 0)throw new Error(`–ö–ª–∏–µ–Ω—Ç —Å email ${t} –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ —ç—Ç–æ–º –∏–Ω–±–∞—É–Ω–¥–µ`);const f=[...u.clients];return f[l]={...f[l],...n,id:f[l].id,email:t},(await this.api.post(`/panel/api/inbounds/update/${s}`,{...u,clients:f})).data}async getInbounds(){try{await this.ensureAuthenticated();const t=(await this.api.get("/panel/api/inbounds")).data,n=t?.obj||t||[];return Array.isArray(n)?n:[]}catch(s){throw o.error("ThreeXUI","–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —Å–ø–∏—Å–∫–∞ –∏–Ω–±–∞—É–Ω–¥–æ–≤",null,s),new Error(s.response?.data?.msg||s.response?.data?.message||s.message||"–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –∏–Ω–±–∞—É–Ω–¥–æ–≤")}}async getInbound(s){try{await this.ensureAuthenticated();const n=(await this.api.get(`/panel/api/inbounds/get/${s}`)).data;return n?.obj||n}catch(t){throw o.error("ThreeXUI","–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –∏–Ω–±–∞—É–Ω–¥–∞",{inboundId:s},t),new Error(t.response?.data?.msg||t.response?.data?.message||t.message||`–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –∏–Ω–±–∞—É–Ω–¥ —Å ID ${s}`)}}async getClientByEmail(s){try{await this.ensureAuthenticated(),await this.refreshClientCache();const t=this.clientsCache.get(s);if(t)return o.debug("ThreeXUI","–ö–ª–∏–µ–Ω—Ç –Ω–∞–π–¥–µ–Ω –≤ –∫–µ—à–µ",{email:s}),{client:t,inbound:t.inbound};o.debug("ThreeXUI","–ö–ª–∏–µ–Ω—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ –∫–µ—à–µ, –ø–æ–∏—Å–∫ –Ω–∞–ø—Ä—è–º—É—é",{email:s});const n=await this.getInbounds();for(const i of n)if(i.clients&&i.clients.length>0){const r=i.clients.find(u=>u.email===s);if(r)return this.clientsCache.set(s,{...r,inboundId:i.id,inboundTag:i.tag,inbound:i}),{client:r,inbound:i}}throw new Error(`–ö–ª–∏–µ–Ω—Ç —Å email ${s} –Ω–µ –Ω–∞–π–¥–µ–Ω`)}catch(t){throw o.error("ThreeXUI","–û—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞ –∫–ª–∏–µ–Ω—Ç–∞",{email:s},t),new Error(t.response?.data?.msg||t.response?.data?.message||t.message||"–ù–µ —É–¥–∞–ª–æ—Å—å –Ω–∞–π—Ç–∏ –∫–ª–∏–µ–Ω—Ç–∞")}}generateUUID(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,s=>{const t=Math.random()*16|0;return(s==="x"?t:t&3|8).toString(16)})}generateSubId(){const s=Date.now(),t=Math.floor(Math.random()*1e9);return`${s}${t.toString().padStart(9,"0")}`}createVLESSConfig(s,t=null,n=null,i={}){const r=t||"nl.skyputh.com",u=n||443,l=i.sni||"www.microsoft.com",f=i.fingerprint||"chrome",N=i.publicKey||""||"your-public-key",j=i.shortId||""||"your-short-id";return`vless://${s}@${r}:${u}?type=tcp&security=reality&sni=${l}&fp=${f}&pbk=${N}&sid=${j}#SkyPuth-VPN`}async detectAPIVersion(){try{const s=await this.api.get("/server/status",{timeout:5e3});this.apiVersion=s.data?.obj?.xray?.version||s.data?.obj?.version||"unknown",this.useNewClientAPI=!0,o.info("ThreeXUI","–í–µ—Ä—Å–∏—è API –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞",{version:this.apiVersion,useNewAPI:this.useNewClientAPI})}catch(s){s.response?.status===404?(this.apiVersion="legacy",this.useNewClientAPI=!1,o.info("ThreeXUI","–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è legacy API (fallback –º–µ—Ç–æ–¥—ã)",{version:this.apiVersion})):(this.apiVersion="unknown",this.useNewClientAPI=!0,o.warn("ThreeXUI","–ù–µ —É–¥–∞–ª–æ—Å—å –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –≤–µ—Ä—Å–∏—é API, –∏—Å–ø–æ–ª—å–∑—É–µ–º –Ω–æ–≤—ã–π API",{error:s.message}))}}async initialize(){try{await this.detectAPIVersion(),await this.ensureAuthenticated(),o.info("ThreeXUI","–°–µ—Ä–≤–∏—Å –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω",{apiVersion:this.apiVersion,useNewAPI:this.useNewClientAPI})}catch(s){throw o.error("ThreeXUI","–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ —Å–µ—Ä–≤–∏—Å–∞",null,s),s}}}const Ue=Q.getInstance(),Qs={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_FIREBASE_API_KEY:"AIzaSyBiqe1iDUOYxFoUgNhtXoPBKdjXuEhlTVY",VITE_FIREBASE_APP_ID:"1:269116595714:web:9f26a4ed0445150a5b911b",VITE_FIREBASE_AUTH_DOMAIN:"skypathvpn.firebaseapp.com",VITE_FIREBASE_MESSAGING_SENDER_ID:"269116595714",VITE_FIREBASE_PROJECT_ID:"skypathvpn",VITE_FIREBASE_STORAGE_BUCKET:"skypathvpn.firebasestorage.app",VITE_VLESS_FINGERPRINT:"chrome",VITE_VLESS_PORT:"443",VITE_VLESS_PUBLIC_KEY:"",VITE_VLESS_SERVER:"nl.skyputh.com",VITE_VLESS_SHORT_ID:"",VITE_VLESS_SNI:"www.microsoft.com",VITE_XUI_INBOUND_ID:"1",VITE_XUI_PASSWORD:"v902l733a00d94%",VITE_XUI_USERNAME:"vladislav4endev"},et={VITE_FIREBASE_API_KEY:"Firebase API Key",VITE_FIREBASE_AUTH_DOMAIN:"Firebase Auth Domain",VITE_FIREBASE_PROJECT_ID:"Firebase Project ID",VITE_FIREBASE_STORAGE_BUCKET:"Firebase Storage Bucket",VITE_FIREBASE_MESSAGING_SENDER_ID:"Firebase Messaging Sender ID",VITE_FIREBASE_APP_ID:"Firebase App ID",VITE_XUI_USERNAME:"3x-ui Username",VITE_XUI_PASSWORD:"3x-ui Password",VITE_XUI_INBOUND_ID:"3x-ui Inbound ID"};function st(){const a=[],s=[];for(const[i,r]of Object.entries(et)){const u=Qs[i];(!u||u.trim()===""||u.includes("your_")||u.includes("here"))&&a.push({envVar:i,description:r})}return isNaN(Number("1"))&&s.push("VITE_XUI_INBOUND_ID –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —á–∏—Å–ª–æ–º"),"skypathvpn.firebaseapp.com".includes(".")||s.push("VITE_FIREBASE_AUTH_DOMAIN –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤–∞–ª–∏–¥–Ω—ã–º –¥–æ–º–µ–Ω–æ–º"),{isValid:a.length===0&&s.length===0,missing:a,errors:s}}function tt(a){const s=[];return a.missing.length>0&&(s.push("–û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:"),a.missing.forEach(({envVar:t,description:n})=>{s.push(`  - ${t} (${n})`)}),s.push(""),s.push("–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª .env –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞ –∏ —Å–∫–æ–ø–∏—Ä—É–π—Ç–µ —Ç—É–¥–∞ –∑–Ω–∞—á–µ–Ω–∏—è –∏–∑ .env.example")),a.errors.length>0&&(s.push("–û—à–∏–±–∫–∏ –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:"),a.errors.forEach(t=>{s.push(`  - ${t}`)})),s.join(`
`)}o.info("Firebase","üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è...");const Se=st();if(Se.isValid)o.info("Firebase","‚úÖ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è –ø—Ä–æ–≤–µ—Ä–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ");else{const a=tt(Se);console.error(`–û—à–∏–±–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:
`,a),o.error("Firebase","‚ùå –û—à–∏–±–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è",{validation:Se})}const W={apiKey:"AIzaSyBiqe1iDUOYxFoUgNhtXoPBKdjXuEhlTVY",authDomain:"skypathvpn.firebaseapp.com",projectId:"skypathvpn",storageBucket:"skypathvpn.firebasestorage.app",messagingSenderId:"269116595714",appId:"1:269116595714:web:9f26a4ed0445150a5b911b"};console.log("üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è Firebase:");console.log("  VITE_FIREBASE_API_KEY:",`${W.apiKey.substring(0,10)}...`);console.log("  VITE_FIREBASE_AUTH_DOMAIN:",W.authDomain);console.log("  VITE_FIREBASE_PROJECT_ID:",W.projectId);console.log("  VITE_FIREBASE_STORAGE_BUCKET:",W.storageBucket);console.log("  VITE_FIREBASE_MESSAGING_SENDER_ID:",W.messagingSenderId);console.log("  VITE_FIREBASE_APP_ID:",W.appId);const M={apiKey:W.apiKey,authDomain:W.authDomain,projectId:W.projectId,storageBucket:W.storageBucket,messagingSenderId:W.messagingSenderId,appId:W.appId};if(!M.apiKey||!M.projectId){const a=[];M.apiKey||a.push("VITE_FIREBASE_API_KEY"),M.authDomain||a.push("VITE_FIREBASE_AUTH_DOMAIN"),M.projectId||a.push("VITE_FIREBASE_PROJECT_ID"),M.storageBucket||a.push("VITE_FIREBASE_STORAGE_BUCKET"),M.messagingSenderId||a.push("VITE_FIREBASE_MESSAGING_SENDER_ID"),M.appId||a.push("VITE_FIREBASE_APP_ID"),console.error("‚ùå Firebase –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –Ω–µ–ø–æ–ª–Ω–∞—è!"),console.error("–û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:",a.join(", ")),console.error(""),console.error("üîß –†–ï–®–ï–ù–ò–ï:"),console.error("1. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ñ–∞–π–ª .env —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞"),console.error('2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –≤—Å–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∑–∞–ø–æ–ª–Ω–µ–Ω—ã (–Ω–µ —Å–æ–¥–µ—Ä–∂–∞—Ç "your_" –∏–ª–∏ "here")'),console.error("3. –û–°–¢–ê–ù–û–í–ò–¢–ï dev —Å–µ—Ä–≤–µ—Ä (Ctrl+C)"),console.error("4. –ó–ê–ü–£–°–¢–ò–¢–ï dev —Å–µ—Ä–≤–µ—Ä –ó–ê–ù–û–í–û: npm run dev"),console.error("5. –û–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É –≤ –±—Ä–∞—É–∑–µ—Ä–µ"),console.error(""),console.error("‚ö†Ô∏è  –í–ê–ñ–ù–û: Vite –∑–∞–≥—Ä—É–∂–∞–µ—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –¢–û–õ–¨–ö–û –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ —Å–µ—Ä–≤–µ—Ä–∞!"),console.error("   –ï—Å–ª–∏ –≤—ã –∏–∑–º–µ–Ω–∏–ª–∏ .env –±–µ–∑ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ - –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –ù–ï –∑–∞–≥—Ä—É–∑—è—Ç—Å—è!"),o.error("Firebase","–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Firebase –Ω–µ–ø–æ–ª–Ω–∞—è",{missing:a,config:{...M,apiKey:M.apiKey?"***":null}})}let pe=null,at=null,B=null,Ve=null,He=null;try{if(M.apiKey&&M.projectId){o.info("Firebase","üî• –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Firebase...");try{pe=Hs(M)}catch(a){if(a.code==="app/duplicate-app")pe=qs(),o.debug("Firebase","–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π —ç–∫–∑–µ–º–ø–ª—è—Ä Firebase (hot reload)",null);else throw a}at=Ms(pe),B=Gs(pe);try{zs(B).catch(a=>{a.code!=="failed-precondition"&&(a.code==="unimplemented"?o.warn("Firebase","–û—Ñ–ª–∞–π–Ω-–ø–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞: –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç",null):o.debug("Firebase","–û—à–∏–±–∫–∞ –≤–∫–ª—é—á–µ–Ω–∏—è –æ—Ñ–ª–∞–π–Ω-–ø–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏",null,a))})}catch(a){a.code==="failed-precondition"||o.debug("Firebase","–°–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ—à–∏–±–∫–∞ –ø—Ä–∏ –≤–∫–ª—é—á–µ–Ω–∏–∏ persistence",null,a)}Ve=new Ws,Ve.setCustomParameters({prompt:"select_account"}),o.info("Firebase","‚úÖ Firebase —É—Å–ø–µ—à–Ω–æ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω",{projectId:M.projectId,authDomain:M.authDomain})}else{const a=[];M.apiKey||a.push("apiKey"),M.projectId||a.push("projectId"),He=`–û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏: ${a.join(", ")}`,o.warn("Firebase","‚ö†Ô∏è Firebase –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω",{missing:a,hasApiKey:!!M.apiKey,hasProjectId:!!M.projectId})}}catch(a){a.code==="failed-precondition"&&a.message?.includes("persistence")?o.debug("Firebase","–û—à–∏–±–∫–∞ persistence –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ (hot reload)",null):(He=a.message||"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞",o.error("Firebase","‚ùå –û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ Firebase",null,a),console.error("–î–µ—Ç–∞–ª–∏ –æ—à–∏–±–∫–∏:",{code:a.code,message:a.message,stack:a.stack}))}const z="skyputh";function nt({onClose:a}){const[s,t]=c.useState([]),[n,i]=c.useState({level:"",category:"",search:""}),[r,u]=c.useState(!0),[l,f]=c.useState(new Set),[N,j]=c.useState(null),y=c.useRef(null),m=c.useRef(null);c.useEffect(()=>(T(),S(),o.subscribe(()=>{T(),S()})),[]),c.useEffect(()=>{T()},[n]),c.useEffect(()=>{r&&s.length>0&&P()},[s,r]);const T=()=>{const p=o.getLogs(n);t(p)},S=()=>{j(o.getStats())},P=()=>{y.current?.scrollIntoView({behavior:"smooth"})},C=p=>{const _=new Set(l);_.has(p)?_.delete(p):_.add(p),f(_)},v=()=>{window.confirm("–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –æ—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ –ª–æ–≥–∏?")&&(o.clear(),T(),S(),f(new Set))},h=(p="json")=>{const _=p==="json"?o.exportJSON(n):o.exportText(n),U=new Blob([_],{type:p==="json"?"application/json":"text/plain"}),A=URL.createObjectURL(U),D=document.createElement("a");D.href=A,D.download=`logs-${new Date().toISOString().split("T")[0]}.${p==="json"?"json":"txt"}`,document.body.appendChild(D),D.click(),document.body.removeChild(D),URL.revokeObjectURL(A)},k=p=>{const _=`${p.timestamp} [${p.level.toUpperCase()}] [${p.category}] ${p.message}${p.data?`
`+JSON.stringify(p.data,null,2):""}${p.error?`
`+JSON.stringify(p.error,null,2):""}${p.stack?`
`+p.stack:""}`;navigator.clipboard.writeText(_).then(()=>{}).catch(U=>{console.error("–û—à–∏–±–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è:",U)})},I=p=>{switch(p){case"error":return e.jsx(ue,{className:"w-4 h-4 text-red-400"});case"warn":return e.jsx(gs,{className:"w-4 h-4 text-yellow-400"});case"info":return e.jsx(Ne,{className:"w-4 h-4 text-blue-400"});case"debug":return e.jsx(Ce,{className:"w-4 h-4 text-slate-400"});default:return e.jsx(Ne,{className:"w-4 h-4 text-slate-400"})}},E=p=>{switch(p){case"error":return"bg-red-900/20 border-red-800 text-red-300";case"warn":return"bg-yellow-900/20 border-yellow-800 text-yellow-300";case"info":return"bg-blue-900/20 border-blue-800 text-blue-300";case"debug":return"bg-slate-800 border-slate-700 text-slate-400";default:return"bg-slate-800 border-slate-700 text-slate-300"}},w=p=>new Date(p).toLocaleTimeString("ru-RU",{hour:"2-digit",minute:"2-digit",second:"2-digit",fractionalSecondDigits:3}),R=p=>new Date(p).toLocaleDateString("ru-RU",{year:"numeric",month:"2-digit",day:"2-digit"}),X=[...new Set(s.map(p=>p.category))].sort();return e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-slate-900 rounded-lg shadow-xl w-full max-w-6xl h-[90vh] flex flex-col border border-slate-800",children:[e.jsxs("div",{className:"p-4 border-b border-slate-800 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("h2",{className:"text-xl font-bold text-slate-200 flex items-center gap-2",children:[e.jsx(Ce,{className:"w-5 h-5"}),"–°–∏—Å—Ç–µ–º–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è"]}),N&&e.jsxs("div",{className:"flex items-center gap-4 text-sm text-slate-400",children:[e.jsxs("span",{children:["–í—Å–µ–≥–æ: ",N.total]}),e.jsxs("span",{className:"text-red-400",children:["–û—à–∏–±–æ–∫: ",N.byLevel.error]}),e.jsxs("span",{className:"text-yellow-400",children:["–ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–π: ",N.byLevel.warn]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>u(!r),className:`px-3 py-1 rounded text-sm transition-colors ${r?"bg-blue-600 text-white":"bg-slate-800 text-slate-300 hover:bg-slate-700"}`,children:"–ê–≤—Ç–æ–ø—Ä–æ–∫—Ä—É—Ç–∫–∞"}),e.jsxs("button",{onClick:v,className:"px-3 py-1 bg-red-600 hover:bg-red-700 text-white rounded text-sm transition-colors flex items-center gap-1",children:[e.jsx(ae,{className:"w-4 h-4"}),"–û—á–∏—Å—Ç–∏—Ç—å"]}),e.jsx("div",{className:"relative",children:e.jsxs("button",{onClick:()=>h("json"),className:"px-3 py-1 bg-green-600 hover:bg-green-700 text-white rounded text-sm transition-colors flex items-center gap-1",children:[e.jsx(xs,{className:"w-4 h-4"}),"–≠–∫—Å–ø–æ—Ä—Ç"]})}),e.jsx("button",{onClick:a,className:"text-slate-400 hover:text-slate-200 transition-colors",children:e.jsx(ne,{className:"w-6 h-6"})})]})]}),e.jsx("div",{className:"p-4 border-b border-slate-800 bg-slate-800/50",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[e.jsxs("div",{className:"relative",children:[e.jsx(ps,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-slate-400"}),e.jsx("input",{type:"text",placeholder:"–ü–æ–∏—Å–∫ –ø–æ –ª–æ–≥–∞–º...",value:n.search,onChange:p=>i({...n,search:p.target.value}),className:"w-full pl-10 pr-4 py-2 bg-slate-900 border border-slate-700 rounded text-slate-200 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("select",{value:n.level,onChange:p=>i({...n,level:p.target.value}),className:"px-4 py-2 bg-slate-900 border border-slate-700 rounded text-slate-200 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"–í—Å–µ —É—Ä–æ–≤–Ω–∏"}),e.jsx("option",{value:"debug",children:"Debug"}),e.jsx("option",{value:"info",children:"Info"}),e.jsx("option",{value:"warn",children:"Warn"}),e.jsx("option",{value:"error",children:"Error"})]}),e.jsxs("select",{value:n.category,onChange:p=>i({...n,category:p.target.value}),className:"px-4 py-2 bg-slate-900 border border-slate-700 rounded text-slate-200 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"–í—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏"}),X.map(p=>e.jsx("option",{value:p,children:p},p))]})]})}),e.jsxs("div",{ref:m,className:"flex-1 overflow-y-auto p-4 space-y-2",children:[s.length===0?e.jsxs("div",{className:"text-center py-12 text-slate-400",children:[e.jsx(Ne,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"–õ–æ–≥–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã"}),Object.values(n).some(p=>p)&&e.jsx("p",{className:"text-sm mt-2",children:"–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã"})]}):s.map(p=>{const _=l.has(p.id),U=R(p.timestamp)===R(new Date().toISOString());return e.jsx("div",{className:`border rounded-lg p-3 transition-all ${E(p.level)}`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"mt-0.5",children:I(p.level)}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:"text-xs font-mono text-slate-400",children:U?w(p.timestamp):`${R(p.timestamp)} ${w(p.timestamp)}`}),e.jsx("span",{className:"text-xs font-semibold uppercase px-2 py-0.5 rounded bg-slate-900/50",children:p.level}),e.jsx("span",{className:"text-xs font-medium px-2 py-0.5 rounded bg-slate-900/50",children:p.category})]}),e.jsx("p",{className:"mt-1 text-sm break-words",children:p.message})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:()=>k(p),className:"p-1 hover:bg-slate-700/50 rounded transition-colors",title:"–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å",children:e.jsx(me,{className:"w-4 h-4"})}),(p.data||p.error||p.stack)&&e.jsx("button",{onClick:()=>C(p.id),className:"p-1 hover:bg-slate-700/50 rounded transition-colors",title:_?"–°–≤–µ—Ä–Ω—É—Ç—å":"–†–∞–∑–≤–µ—Ä–Ω—É—Ç—å",children:_?e.jsx(bs,{className:"w-4 h-4"}):e.jsx(fs,{className:"w-4 h-4"})})]})]}),_&&e.jsxs("div",{className:"mt-3 pt-3 border-t border-slate-700 space-y-2",children:[p.data&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-semibold mb-1 text-slate-400",children:"–î–∞–Ω–Ω—ã–µ:"}),e.jsx("pre",{className:"text-xs bg-slate-950 p-2 rounded overflow-x-auto font-mono",children:JSON.stringify(p.data,null,2)})]}),p.error&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-semibold mb-1 text-slate-400",children:"–û—à–∏–±–∫–∞:"}),e.jsx("pre",{className:"text-xs bg-slate-950 p-2 rounded overflow-x-auto font-mono",children:JSON.stringify(p.error,null,2)})]}),p.stack&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-semibold mb-1 text-slate-400",children:"Stack trace:"}),e.jsx("pre",{className:"text-xs bg-slate-950 p-2 rounded overflow-x-auto font-mono text-red-300",children:p.stack})]})]})]})]})},p.id)}),e.jsx("div",{ref:y})]})]})})}const rt=({currentUser:a,view:s,onSetView:t,onLogout:n})=>{const[i,r]=c.useState(!1),u=N=>{t(N),r(!1)},l=()=>{n(),r(!1)},f=e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-4 sm:mb-6 md:mb-8",children:[e.jsx("h1",{className:"text-[clamp(1.25rem,1.1rem+0.75vw,1.75rem)] sm:text-xl md:text-2xl font-black text-white mb-1.5 sm:mb-2",children:"SKYPATH VPN"}),e.jsx("p",{className:"text-[clamp(0.75rem,0.7rem+0.25vw,0.875rem)] sm:text-sm text-slate-400",children:s==="admin"?"–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å":"–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç"})]}),e.jsxs("nav",{className:"flex-1 space-y-1.5 sm:space-y-2 overflow-y-auto min-h-0",children:[a?.role==="admin"&&e.jsxs("button",{onClick:()=>u("admin"),className:`w-full min-h-[44px] flex items-center gap-2 sm:gap-3 px-3 sm:px-4 py-2.5 sm:py-3 rounded-lg transition-colors touch-manipulation ${s==="admin"?"bg-blue-600 text-white":"text-slate-300 hover:bg-slate-800 active:bg-slate-700"}`,"aria-label":"–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å","aria-selected":s==="admin",children:[e.jsx(Me,{size:18,className:"sm:w-5 sm:h-5 flex-shrink-0"}),e.jsx("span",{className:"font-bold text-[clamp(0.875rem,0.8rem+0.375vw,1rem)] sm:text-base",children:"–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å"})]}),e.jsxs("button",{onClick:()=>u("dashboard"),className:`w-full min-h-[44px] flex items-center gap-2 sm:gap-3 px-3 sm:px-4 py-2.5 sm:py-3 rounded-lg transition-colors touch-manipulation ${s==="dashboard"?"bg-blue-600 text-white":"text-slate-300 hover:bg-slate-800 active:bg-slate-700"}`,"aria-label":"–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç","aria-selected":s==="dashboard",children:[e.jsx(vs,{size:18,className:"sm:w-5 sm:h-5 flex-shrink-0"}),e.jsx("span",{className:"font-bold text-[clamp(0.875rem,0.8rem+0.375vw,1rem)] sm:text-base",children:"–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç"})]})]}),e.jsx("div",{className:"border-t border-slate-800 pt-3 sm:pt-4 mt-auto flex-shrink-0",children:e.jsxs("button",{onClick:l,className:"w-full min-h-[44px] flex items-center gap-2 sm:gap-3 px-3 sm:px-4 py-2.5 sm:py-3 rounded-lg text-slate-300 hover:bg-slate-800 active:bg-slate-700 transition-colors touch-manipulation","aria-label":"–í—ã–π—Ç–∏ –∏–∑ –∞–∫–∫–∞—É–Ω—Ç–∞",children:[e.jsx(ws,{size:18,className:"sm:w-5 sm:h-5 flex-shrink-0"}),e.jsx("span",{className:"font-bold text-[clamp(0.875rem,0.8rem+0.375vw,1rem)] sm:text-base",children:"–í—ã–π—Ç–∏"})]})})]});return e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>r(!i),className:"lg:hidden fixed top-3 sm:top-4 left-3 sm:left-4 z-50 p-2 sm:p-2.5 bg-slate-900 hover:bg-slate-800 active:bg-slate-700 rounded-lg text-white border border-slate-800 transition-colors min-h-[44px] min-w-[44px] flex items-center justify-center touch-manipulation","aria-label":"Toggle menu","aria-expanded":i,children:i?e.jsx(ne,{size:20,className:"sm:w-6 sm:h-6"}):e.jsx(js,{size:20,className:"sm:w-6 sm:h-6"})}),i&&e.jsx("div",{className:"lg:hidden fixed inset-0 bg-black/70 backdrop-blur-sm z-40",onClick:()=>r(!1),"aria-hidden":"true"}),e.jsx("div",{className:`
          bg-slate-900 border-r border-slate-800 
          p-3 sm:p-4 md:p-6 
          flex flex-col
          h-screen
          fixed lg:static lg:h-full
          top-0 left-0 z-40
          w-[280px] sm:w-64
          transform transition-transform duration-300 ease-in-out
          overflow-y-auto overflow-x-hidden
          ${i?"translate-x-0":"-translate-x-full lg:translate-x-0"}
        `,children:f})]})},Ge=(a,s=null)=>{if(!a.uuid||a.uuid.trim()==="")return{status:"no-key",label:"–ù–µ—Ç –∫–ª—é—á–∞",color:"text-slate-400"};const t=Date.now();if(a.paymentStatus==="test_period"){if(a.testPeriodEndDate&&a.testPeriodEndDate<t)return{status:"unpaid",label:"–ù–µ –æ–ø–ª–∞—á–µ–Ω–æ",color:"text-red-400"};const i=Math.floor((a.testPeriodEndDate-t)/(3600*1e3)),r=Math.floor((a.testPeriodEndDate-t)%(3600*1e3)/(60*1e3));return{status:"test_period",label:`–¢–µ—Å—Ç (–æ—Å—Ç–∞–ª–æ—Å—å ${i}—á ${r}–º)`,color:"text-yellow-400"}}if(a.paymentStatus==="unpaid")return{status:"unpaid",label:"–ù–µ –æ–ø–ª–∞—á–µ–Ω–æ",color:"text-red-400"};let n=null;return s&&s.expiryTime?n=s.expiryTime:a.expiresAt&&(n=a.expiresAt),n&&n>0&&n<t?{status:"expired",label:"–ò—Å—Ç–µ–∫",color:"text-red-400"}:{status:"active",label:"–ê–∫—Ç–∏–≤–µ–Ω",color:"text-green-400"}},it=({users:a=[],editingUser:s,onSetEditingUser:t,onHandleUpdateUser:n,onHandleDeleteUser:i,onHandleCopy:r,currentUser:u,formatDate:l,handleUserRoleChange:f,handleUserPlanChange:N,handleUserDevicesChange:j,handleUserExpiresAtChange:y,onUserRowClick:m})=>{const[S,P]=c.useState(600),[C,v]=c.useState(1200);c.useEffect(()=>{const I=()=>{P(window.innerWidth<768?400:600),v(Math.max(1200,window.innerWidth))};return I(),window.addEventListener("resize",I),()=>window.removeEventListener("resize",I)},[]);const h=c.useMemo(()=>({users:a,editingUser:s,onSetEditingUser:t,onHandleUpdateUser:n,onHandleDeleteUser:i,onHandleCopy:r,currentUser:u,formatDate:l,handleUserRoleChange:f,handleUserPlanChange:N,handleUserDevicesChange:j,handleUserExpiresAtChange:y,onUserRowClick:m}),[a,s,t,n,i,r,u,l,f,N,j,y,m]),k=({index:I,style:E,data:w})=>{const R=w.users[I];if(!R)return null;const X=Ge(R),p=w.editingUser?.id===R.id;return e.jsx("div",{style:E,className:"border-b border-slate-800 hover:bg-slate-800/50 transition-colors cursor-pointer",onClick:()=>{w.onUserRowClick&&!p&&w.onUserRowClick(R)},children:e.jsxs("div",{className:"grid grid-cols-8 gap-2 sm:gap-4 px-3 sm:px-6 py-4 items-center min-h-[80px] min-w-[1200px]",children:[e.jsx("div",{className:"text-slate-200 truncate",title:R.email,children:R.email}),e.jsx("div",{className:"flex items-center gap-2",children:R.uuid?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-slate-400 font-mono text-xs max-w-[180px] sm:max-w-[220px] truncate",title:R.uuid,children:R.uuid}),e.jsx("button",{onClick:()=>w.onHandleCopy(R.uuid),className:"p-1 rounded bg-slate-800 hover:bg-slate-700 text-slate-200 transition-colors flex-shrink-0",title:"–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å UUID",children:e.jsx(me,{className:"w-3 h-3"})})]}):e.jsx("span",{className:"text-slate-500 text-xs",children:"‚Äî"})}),e.jsx("div",{children:p?e.jsxs("select",{value:w.editingUser.role,onChange:w.handleUserRoleChange,className:"px-2 py-1 bg-slate-800 border border-slate-700 rounded text-slate-200 text-sm w-full",children:[e.jsx("option",{value:"user",children:"–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å"}),e.jsx("option",{value:"admin",children:"–ê–¥–º–∏–Ω"})]}):e.jsx("span",{className:`px-2 py-1 rounded text-xs font-medium inline-block ${R.role==="admin"?"bg-purple-900/30 text-purple-300":"bg-slate-700 text-slate-300"}`,children:R.role==="admin"?"–ê–¥–º–∏–Ω":"–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å"})}),e.jsx("div",{children:p?e.jsxs("select",{value:w.editingUser.plan,onChange:w.handleUserPlanChange,className:"px-2 py-1 bg-slate-800 border border-slate-700 rounded text-slate-200 text-sm w-full",children:[e.jsx("option",{value:"free",children:"–ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π"}),e.jsx("option",{value:"premium",children:"–ü—Ä–µ–º–∏—É–º"})]}):e.jsx("span",{className:"text-slate-200",children:R.plan==="premium"?"–ü—Ä–µ–º–∏—É–º":"–ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π"})}),e.jsx("div",{children:p?e.jsx("input",{type:"number",min:"1",value:w.editingUser.devices||1,onChange:w.handleUserDevicesChange,className:"w-20 px-2 py-1 bg-slate-800 border border-slate-700 rounded text-slate-200 text-sm"}):e.jsx("span",{className:"text-slate-200",children:R.devices||1})}),e.jsx("div",{children:e.jsxs("div",{className:`inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs ${X.status==="active"?"bg-green-900/30 text-green-400":X.status==="expired"?"bg-red-900/30 text-red-400":"bg-slate-700 text-slate-400"}`,children:[X.status==="active"&&e.jsx(le,{className:"w-3 h-3"}),X.status==="expired"&&e.jsx(ve,{className:"w-3 h-3"}),X.status==="no-key"&&e.jsx(ue,{className:"w-3 h-3"}),X.label]})}),e.jsx("div",{children:p?e.jsx("input",{type:"datetime-local",value:w.editingUser.expiresAt?new Date(w.editingUser.expiresAt).toISOString().slice(0,16):"",onChange:w.handleUserExpiresAtChange,className:"px-2 py-1 bg-slate-800 border border-slate-700 rounded text-slate-200 text-sm w-full"}):e.jsx("span",{className:"text-slate-400 text-sm",children:R.expiresAt?w.formatDate(R.expiresAt):"‚Äî"})}),e.jsx("div",{className:"flex items-center gap-2",onClick:_=>_.stopPropagation(),children:p?e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>w.onHandleUpdateUser(R.id,w.editingUser),className:"p-2 bg-green-600 hover:bg-green-700 text-white rounded transition-colors flex items-center justify-center",title:"–°–æ—Ö—Ä–∞–Ω–∏—Ç—å",children:e.jsx(re,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>w.onSetEditingUser(null),className:"p-2 bg-slate-600 hover:bg-slate-700 text-white rounded transition-colors flex items-center justify-center",title:"–û—Ç–º–µ–Ω–∞",children:e.jsx(ne,{className:"w-4 h-4"})})]}):e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:_=>{_.stopPropagation(),w.onUserRowClick&&w.onUserRowClick(R)},className:"p-2 bg-blue-600 hover:bg-blue-700 text-white rounded transition-colors flex items-center justify-center",title:"–û—Ç–∫—Ä—ã—Ç—å",children:e.jsx(fe,{className:"w-4 h-4"})}),e.jsx("button",{onClick:_=>{_.stopPropagation(),w.onHandleDeleteUser(R.id)},disabled:R.id===w.currentUser?.id,className:"p-2 bg-red-600 hover:bg-red-700 disabled:bg-slate-700 disabled:cursor-not-allowed text-white rounded transition-colors flex items-center justify-center",title:"–£–¥–∞–ª–∏—Ç—å",children:e.jsx(ae,{className:"w-4 h-4"})})]})})]})})};return a.length===0?e.jsx("div",{className:"bg-slate-900 rounded-lg shadow-xl border border-slate-800 p-6",children:e.jsx("div",{className:"text-center py-12 text-slate-400",children:e.jsx("p",{children:"–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã"})})}):e.jsxs("div",{className:"bg-slate-900 rounded-lg sm:rounded-xl shadow-xl border border-slate-800 overflow-hidden",children:[e.jsxs("div",{className:"p-3 sm:p-4 md:p-6 border-b border-slate-800",children:[e.jsx("h2",{className:"text-[clamp(1.125rem,1rem+0.625vw,1.5rem)] font-bold text-slate-200",children:"–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏"}),e.jsxs("p",{className:"text-slate-400 text-[clamp(0.875rem,0.8rem+0.375vw,1rem)] mt-1",children:["–í—Å–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: ",a.length]})]}),e.jsxs("div",{className:"bg-slate-800 grid grid-cols-8 gap-2 sm:gap-4 px-3 sm:px-6 py-3 border-b border-slate-700 min-w-[1200px]",children:[e.jsx("div",{className:"text-xs font-medium text-slate-300 uppercase tracking-wider",children:"Email"}),e.jsx("div",{className:"text-xs font-medium text-slate-300 uppercase tracking-wider",children:"UUID"}),e.jsx("div",{className:"text-xs font-medium text-slate-300 uppercase tracking-wider",children:"–†–æ–ª—å"}),e.jsx("div",{className:"text-xs font-medium text-slate-300 uppercase tracking-wider",children:"–ü–ª–∞–Ω"}),e.jsx("div",{className:"text-xs font-medium text-slate-300 uppercase tracking-wider",children:"–£—Å—Ç—Ä–æ–π—Å—Ç–≤–∞"}),e.jsx("div",{className:"text-xs font-medium text-slate-300 uppercase tracking-wider",children:"–°—Ç–∞—Ç—É—Å"}),e.jsx("div",{className:"text-xs font-medium text-slate-300 uppercase tracking-wider",children:"–ò—Å—Ç–µ–∫–∞–µ—Ç"}),e.jsx("div",{className:"text-xs font-medium text-slate-300 uppercase tracking-wider",children:"–î–µ–π—Å—Ç–≤–∏—è"})]}),e.jsx("div",{className:"overflow-x-auto -mx-2 sm:mx-0",children:e.jsx(ys,{height:S,itemCount:a.length,itemSize:80,width:C,itemData:h,overscanCount:5,className:"scrollbar-thin scrollbar-thumb-slate-700 scrollbar-track-slate-900",children:k})})]})};function lt(a){return!a||typeof a!="string"?!1:/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(a.trim())}function ot(a){return!a||typeof a!="string"?!1:/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(a.trim())}function dt(a){return!a||typeof a!="string"?!0:/^[\d\s\-\+\(\)]+$/.test(a.trim())}function Ae(a){const s=[];if(!a||typeof a!="object")return{isValid:!1,errors:["–î–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω—ã"]};if((!a.id||typeof a.id!="string")&&s.push("ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω"),(!a.email||!ot(a.email))&&s.push("Email –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω –∏ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤–∞–ª–∏–¥–Ω—ã–º"),a.uuid&&!lt(a.uuid)&&s.push("UUID –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ"),a.phone&&!dt(a.phone)&&s.push("–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ"),a.trafficGB!==void 0&&(typeof a.trafficGB!="number"||a.trafficGB<0)&&s.push("–õ–∏–º–∏—Ç —Ç—Ä–∞—Ñ–∏–∫–∞ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–µ–æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–º —á–∏—Å–ª–æ–º"),a.devices!==void 0&&(typeof a.devices!="number"||a.devices<1)&&s.push("–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –Ω–µ –º–µ–Ω–µ–µ 1"),a.expiresAt!==void 0&&a.expiresAt!==null){const t=typeof a.expiresAt=="string"?new Date(a.expiresAt).getTime():a.expiresAt;(typeof t!="number"||isNaN(t)||t<0)&&s.push("–î–∞—Ç–∞ –∏—Å—Ç–µ—á–µ–Ω–∏—è –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –≤–∞–ª–∏–¥–Ω–æ–π –≤—Ä–µ–º–µ–Ω–Ω–æ–π –º–µ—Ç–∫–æ–π")}return{isValid:s.length===0,errors:s}}function Te(a){if(!a||typeof a!="object")throw new Error("–î–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω—ã");let s=[];return a.subid&&(Array.isArray(a.subid)?s=a.subid.map(t=>String(t).trim()).filter(t=>t!==""):typeof a.subid=="string"&&a.subid.trim()!==""&&(s=[a.subid.trim()])),{id:String(a.id||""),email:String(a.email||"").trim().toLowerCase(),uuid:a.uuid?String(a.uuid).trim():"",name:a.name?String(a.name).trim():"",phone:a.phone?String(a.phone).trim():"",expiresAt:a.expiresAt!=null?typeof a.expiresAt=="string"?new Date(a.expiresAt).getTime():Number(a.expiresAt):null,trafficGB:a.trafficGB!=null&&Number(a.trafficGB)||0,devices:a.devices!=null&&Number(a.devices)||1,tariffId:a.tariffId?String(a.tariffId):null,plan:a.plan?String(a.plan):"free",role:a.role?String(a.role):"user",subid:s}}const ct={user:x.shape({id:x.string.isRequired,email:x.string.isRequired,uuid:x.string,name:x.string,phone:x.string,expiresAt:x.oneOfType([x.number,x.string]),trafficGB:x.number,devices:x.number,tariffId:x.string,plan:x.string,role:x.string,createdAt:x.oneOfType([x.number,x.string])}).isRequired,onClose:x.func.isRequired,onCopy:x.func,tariffs:x.arrayOf(x.shape({id:x.string.isRequired,name:x.string.isRequired,plan:x.string.isRequired,price:x.number.isRequired,devices:x.number,trafficGB:x.number,active:x.bool})),formatDate:x.func},ze=c.createContext(null),We=()=>{const a=c.useContext(ze);if(!a)throw new Error("useAdminContext must be used within AdminProvider");return a},qe=({children:a,value:s})=>e.jsx(ze.Provider,{value:s,children:a}),Je=({user:a,onClose:s,onCopy:t,tariffs:n=[],formatDate:i})=>{const{handleSaveUserCard:r,generateUUID:u}=We();if(!a)return console.warn("UserCard: user prop –Ω–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω"),null;const[l,f]=c.useState(()=>({...a})),[N,j]=c.useState(!1),[y,m]=c.useState({}),[T,S]=c.useState(null);c.useEffect(()=>{if(a){const d=Array.isArray(a.subid)?a.subid.filter(g=>g!=null&&String(g).trim()!==""):a.subid&&String(a.subid).trim()!==""?[String(a.subid).trim()]:[];console.log("UserCard: –ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ —Ñ–æ—Ä–º—É —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è",{userId:a.id,email:a.email,subidFromUser:a.subid,subidType:Array.isArray(a.subid)?"array":typeof a.subid,normalizedSubid:d,normalizedSubidLength:d.length}),f({...a,subid:d}),m({}),S(null)}},[a?.id,a?.uuid,a?.name,a?.phone,a?.expiresAt,a?.trafficGB,a?.devices,a?.tariffId,a?.plan,a?.periodMonths,a?.paymentStatus,a?.testPeriodStartDate,a?.testPeriodEndDate,a?.natrockPort,a?.syncedWithN8nAt,a?.lastSyncChanges,a?.subid]);const P=Ge(l),C={name:`user-card-name-${a.id}`,phone:`user-card-phone-${a.id}`,uuid:`user-card-uuid-${a.id}`,tariff:`user-card-tariff-${a.id}`,expiresAt:`user-card-expires-at-${a.id}`,subscriptionLink:`user-card-subscription-link-${a.id}`,trafficGB:`user-card-traffic-gb-${a.id}`,devices:`user-card-devices-${a.id}`,subid:`user-card-subid-${a.id}`},v=c.useCallback((d,g)=>{f(L=>({...L,[d]:g})),y[d]&&m(L=>{const O={...L};return delete O[d],O})},[y]),h=c.useCallback(d=>{v("uuid",d.target.value.trim())},[v]),k=c.useCallback(d=>{v("name",d.target.value)},[v]),I=c.useCallback(d=>{v("phone",d.target.value)},[v]),E=c.useCallback(d=>{const g=d.target.value,L=n.find(O=>O.id===g);f(L?O=>({...O,plan:L.plan,tariffId:g,devices:L.devices||O.devices||1,trafficGB:L.trafficGB||O.trafficGB||0}):O=>({...O,plan:"free",tariffId:null}))},[n]),w=c.useCallback(d=>{v("devices",Number(d.target.value)||1)},[v]),R=c.useCallback(d=>{v("trafficGB",Number(d.target.value)||0)},[v]),X=c.useCallback(d=>{const g=d.target.value?new Date(d.target.value).getTime():null;v("expiresAt",g)},[v]),p=c.useCallback(()=>{f(d=>{const g=Array.isArray(d.subid)?d.subid:d.subid?[d.subid]:[];return{...d,subid:[...g,""]}})},[]),_=c.useCallback(d=>{f(g=>{const O=(Array.isArray(g.subid)?g.subid:g.subid?[g.subid]:[]).filter((K,oe)=>oe!==d);return{...g,subid:O}})},[]),U=c.useCallback((d,g)=>{f(L=>{const K=[...Array.isArray(L.subid)?L.subid:L.subid?[L.subid]:[]];return K[d]=g,{...L,subid:K}})},[]),A=c.useCallback(()=>{if(!u||typeof u!="function"){console.error("UserCard: generateUUID –Ω–µ –¥–æ—Å—Ç—É–ø–µ–Ω –∏–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞"),S("–§—É–Ω–∫—Ü–∏—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ UUID –Ω–µ –¥–æ—Å—Ç—É–ø–Ω–∞");return}try{const d=u();d?v("uuid",d):S("–ù–µ —É–¥–∞–ª–æ—Å—å —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å UUID")}catch(d){console.error("UserCard: –û—à–∏–±–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ UUID:",d),S("–û—à–∏–±–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ UUID: "+(d.message||"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞"))}},[u,v]),D=c.useCallback(async()=>{if(!r||typeof r!="function"){const g="–§—É–Ω–∫—Ü–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –Ω–µ –¥–æ—Å—Ç—É–ø–Ω–∞ –∏–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞";console.error("‚ùå UserCard:",g,{hasHandleSaveUserCard:!!r,handleSaveUserCardType:typeof r}),S(g);return}const d=Ae(l);if(!d.isValid){S(d.errors.join(", "));const g={};d.errors.forEach(L=>{L.includes("UUID")&&(g.uuid=L),L.includes("Email")&&(g.email=L),L.includes("—Ç–µ–ª–µ—Ñ–æ–Ω")&&(g.phone=L),L.includes("—Ç—Ä–∞—Ñ–∏–∫")&&(g.trafficGB=L),L.includes("—É—Å—Ç—Ä–æ–π—Å—Ç–≤")&&(g.devices=L)}),m(g);return}j(!0),S(null),m({});try{const g=Te(l);console.log("UserCard: –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è",{id:g.id,fields:Object.keys(g),subid:g.subid,subidCount:g.subid?.length||0,subidType:Array.isArray(g.subid)?"array":typeof g.subid,hasHandleSaveUserCard:!!r,handleSaveUserCardType:typeof r}),await r(g),console.log("UserCard: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω",{savedSubid:g.subid,savedSubidCount:g.subid?.length||0})}catch(g){throw console.error("UserCard: –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è:",g),S(g.message||"–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"),g}finally{j(!1)}},[l,r]),F=(()=>{if(Array.isArray(l.subid)&&l.subid.length>0){const d=l.subid.find(g=>g&&String(g).trim()!=="");if(d)return String(d).trim()}return l.subId&&String(l.subId).trim()!==""?String(l.subId).trim():null})(),q=F?`https://subs.skypath.fun:3458/vk198/${F}`:l.subscriptionLink||l.vpnLink||null;return e.jsx("div",{className:"fixed inset-0 bg-black/70 backdrop-blur-sm z-50 flex items-center justify-center p-2 sm:p-4",children:e.jsxs("div",{className:"bg-slate-900 rounded-xl shadow-2xl border border-slate-800 w-full max-w-4xl max-h-[90vh] overflow-y-auto m-2 sm:m-4",children:[e.jsxs("div",{className:"sticky top-0 bg-slate-900 border-b border-slate-800 p-4 sm:p-6 flex items-center justify-between z-10",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold text-slate-200 flex items-center gap-2",children:[e.jsx(Pe,{className:"w-6 h-6"}),"–ö–∞—Ä—Ç–æ—á–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"]}),e.jsx("p",{className:"text-slate-400 text-sm mt-1",children:a.email})]}),e.jsx("button",{onClick:s,className:"p-2 hover:bg-slate-800 rounded-lg transition-colors text-slate-400 hover:text-slate-200","aria-label":"–ó–∞–∫—Ä—ã—Ç—å –∫–∞—Ä—Ç–æ—á–∫—É",children:e.jsx(ne,{className:"w-5 h-5"})})]}),T&&e.jsx("div",{className:"mx-6 mt-4 p-3 bg-red-900/30 border border-red-800 rounded text-red-300 text-sm",children:T}),e.jsxs("div",{className:"p-4 sm:p-6 space-y-4 sm:space-y-6",children:[e.jsxs("div",{className:"bg-slate-800 rounded-lg p-6 border border-slate-700",children:[e.jsxs("h3",{className:"text-lg font-semibold text-slate-200 mb-4 flex items-center gap-2",children:[e.jsx(Ns,{className:"w-5 h-5"}),"–û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è"]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-slate-300 text-sm font-medium mb-2",children:"Email"}),e.jsx("div",{className:"px-4 py-2 bg-slate-900 border border-slate-700 rounded text-slate-200",children:l.email}),e.jsx("p",{className:"text-slate-500 text-xs mt-1",children:"Email –Ω–µ–ª—å–∑—è –∏–∑–º–µ–Ω–∏—Ç—å"})]}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:C.name,className:"block text-slate-300 text-sm font-medium mb-2",children:["–ò–º—è ",y.name&&e.jsxs("span",{className:"text-red-400 text-xs",children:["(",y.name,")"]})]}),e.jsx("input",{id:C.name,name:"name",type:"text",value:l.name||"",onChange:k,className:`w-full px-4 py-2 bg-slate-900 border rounded text-slate-200 focus:outline-none focus:ring-2 focus:ring-blue-500 ${y.name?"border-red-500":"border-slate-700"}`,placeholder:"–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"})]}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:C.phone,className:"block text-slate-300 text-sm font-medium mb-2",children:["–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ ",y.phone&&e.jsxs("span",{className:"text-red-400 text-xs",children:["(",y.phone,")"]})]}),e.jsx("input",{id:C.phone,name:"phone",type:"tel",value:l.phone||"",onChange:I,className:`w-full px-4 py-2 bg-slate-900 border rounded text-slate-200 focus:outline-none focus:ring-2 focus:ring-blue-500 ${y.phone?"border-red-500":"border-slate-700"}`,placeholder:"+7 (999) 123-45-67"})]}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:C.uuid,className:"block text-slate-300 text-sm font-medium mb-2",children:["UUID ",y.uuid&&e.jsxs("span",{className:"text-red-400 text-xs",children:["(",y.uuid,")"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{id:C.uuid,name:"uuid",type:"text",value:l.uuid||"",onChange:h,className:`flex-1 px-4 py-2 bg-slate-900 border rounded text-slate-200 font-mono text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 ${y.uuid?"border-red-500":"border-slate-700"}`,placeholder:"xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx"}),e.jsx("button",{onClick:A,className:"px-3 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded transition-colors flex items-center gap-2",title:"–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –Ω–æ–≤—ã–π UUID",type:"button",children:e.jsx(De,{className:"w-4 h-4"})}),l.uuid&&e.jsx("button",{onClick:()=>t?.(l.uuid),className:"px-3 py-2 bg-slate-700 hover:bg-slate-600 text-white rounded transition-colors flex items-center gap-2",title:"–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å UUID",type:"button",children:e.jsx(me,{className:"w-4 h-4"})})]})]})]})]}),e.jsxs("div",{className:"bg-slate-800 rounded-lg p-6 border border-slate-700",children:[e.jsxs("h3",{className:"text-lg font-semibold text-slate-200 mb-4 flex items-center gap-2",children:[e.jsx(le,{className:"w-5 h-5"}),"–ü–æ–¥–ø–∏—Å–∫–∞"]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-slate-300 text-sm font-medium mb-2",children:"–°—Ç–∞—Ç—É—Å –ø–æ–¥–ø–∏—Å–∫–∏"}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("div",{className:`inline-flex items-center gap-1 px-3 py-2 rounded-lg text-sm font-medium ${P.status==="active"?"bg-green-900/30 text-green-400":P.status==="expired"?"bg-red-900/30 text-red-400":"bg-slate-700 text-slate-400"}`,children:[P.status==="active"&&e.jsx(le,{className:"w-4 h-4"}),P.status==="expired"&&e.jsx(ve,{className:"w-4 h-4"}),P.status==="no-key"&&e.jsx(ue,{className:"w-4 h-4"}),P.label]})}),e.jsxs("p",{className:"text-slate-500 text-xs mt-1",children:[P.status==="no-key"&&"–î–æ–±–∞–≤—å—Ç–µ UUID –¥–ª—è –∞–∫—Ç–∏–≤–∞—Ü–∏–∏",P.status==="expired"&&"–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –¥–∞—Ç—É –æ–∫–æ–Ω—á–∞–Ω–∏—è –≤ –±—É–¥—É—â–µ–º",P.status==="active"&&"–ü–æ–¥–ø–∏—Å–∫–∞ –∞–∫—Ç–∏–≤–Ω–∞"]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:C.tariff,className:"block text-slate-300 text-sm font-medium mb-2",children:"–¢–∞—Ä–∏—Ñ"}),e.jsxs("select",{id:C.tariff,name:"tariff",value:l.tariffId||"",onChange:E,className:"w-full px-4 py-2 bg-slate-900 border border-slate-700 rounded text-slate-200 focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∞—Ä–∏—Ñ"}),n.filter(d=>d.active).map(d=>e.jsxs("option",{value:d.id,children:[d.name," (",d.plan,") - ",d.price," ‚ÇΩ"]},d.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:C.expiresAt,className:"block text-slate-300 text-sm font-medium mb-2",children:"–°—Ä–æ–∫ –æ–∫–æ–Ω—á–∞–Ω–∏—è –ø–æ–¥–ø–∏—Å–∫–∏"}),e.jsx("input",{id:C.expiresAt,name:"expiresAt",type:"datetime-local",value:l.expiresAt?new Date(l.expiresAt).toISOString().slice(0,16):"",onChange:X,className:"w-full px-4 py-2 bg-slate-900 border border-slate-700 rounded text-slate-200 focus:outline-none focus:ring-2 focus:ring-blue-500"}),l.expiresAt&&e.jsx("p",{className:"text-slate-500 text-xs mt-1",children:i?.(l.expiresAt)||new Date(l.expiresAt).toLocaleString()})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:C.subscriptionLink,className:"block text-slate-300 text-sm font-medium mb-2",children:"–°—Å—ã–ª–∫–∞ –ø–æ–¥–ø–∏—Å–∫–∏ –Ω–∞ 3x-ui"}),e.jsx("div",{className:"flex items-center gap-2",children:q?e.jsxs(e.Fragment,{children:[e.jsx("input",{id:C.subscriptionLink,name:"subscriptionLink",type:"text",value:q,readOnly:!0,className:"flex-1 px-4 py-2 bg-slate-900 border border-slate-700 rounded text-slate-200 font-mono text-xs focus:outline-none"}),e.jsx("button",{onClick:()=>t?.(q),className:"px-3 py-2 bg-slate-700 hover:bg-slate-600 text-white rounded transition-colors flex items-center gap-2",title:"–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å—Å—ã–ª–∫—É",type:"button",children:e.jsx(me,{className:"w-4 h-4"})})]}):e.jsx("div",{className:"flex-1 px-4 py-2 bg-slate-900 border border-slate-700 rounded text-slate-500 text-sm",children:"–°–Ω–∞—á–∞–ª–∞ —É–∫–∞–∂–∏—Ç–µ UUID"})})]})]})]}),e.jsxs("div",{className:"bg-slate-800 rounded-lg p-6 border border-slate-700",children:[e.jsxs("h3",{className:"text-lg font-semibold text-slate-200 mb-4 flex items-center gap-2",children:[e.jsx(Ie,{className:"w-5 h-5"}),"–õ–∏–º–∏—Ç—ã"]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{htmlFor:C.trafficGB,className:"block text-slate-300 text-sm font-medium mb-2 flex items-center gap-2",children:[e.jsx(Ie,{className:"w-4 h-4"}),"–õ–∏–º–∏—Ç —Ç—Ä–∞—Ñ–∏–∫–∞ (GB) ",y.trafficGB&&e.jsxs("span",{className:"text-red-400 text-xs",children:["(",y.trafficGB,")"]})]}),e.jsx("input",{id:C.trafficGB,name:"trafficGB",type:"number",min:"0",value:l.trafficGB||0,onChange:R,className:`w-full px-4 py-2 bg-slate-900 border rounded text-slate-200 focus:outline-none focus:ring-2 focus:ring-blue-500 ${y.trafficGB?"border-red-500":"border-slate-700"}`,placeholder:"0 = –±–µ–∑–ª–∏–º–∏—Ç"}),e.jsx("p",{className:"text-slate-500 text-xs mt-1",children:l.trafficGB===0?"–ë–µ–∑–ª–∏–º–∏—Ç":`${l.trafficGB} GB`})]}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:C.devices,className:"block text-slate-300 text-sm font-medium mb-2 flex items-center gap-2",children:[e.jsx(Ss,{className:"w-4 h-4"}),"–õ–∏–º–∏—Ç —É—Å—Ç—Ä–æ–π—Å—Ç–≤ ",y.devices&&e.jsxs("span",{className:"text-red-400 text-xs",children:["(",y.devices,")"]})]}),e.jsx("input",{id:C.devices,name:"devices",type:"number",min:"1",value:l.devices||1,onChange:w,className:`w-full px-4 py-2 bg-slate-900 border rounded text-slate-200 focus:outline-none focus:ring-2 focus:ring-blue-500 ${y.devices?"border-red-500":"border-slate-700"}`})]})]})]}),e.jsxs("div",{className:"bg-slate-800 rounded-lg p-6 border border-slate-700",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"text-lg font-semibold text-slate-200 flex items-center gap-2",children:[e.jsx(Ee,{className:"w-5 h-5"}),"SubID"]}),e.jsxs("button",{onClick:p,className:"px-3 py-1.5 bg-blue-600 hover:bg-blue-700 text-white rounded transition-colors flex items-center gap-2 text-sm",type:"button",title:"–î–æ–±–∞–≤–∏—Ç—å SubID",children:[e.jsx($e,{className:"w-4 h-4"}),"–î–æ–±–∞–≤–∏—Ç—å"]})]}),e.jsxs("div",{className:"space-y-2",children:[Array.isArray(l.subid)&&l.subid.length>0?l.subid.map((d,g)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{id:`${C.subid}-${g}`,name:`subid-${g}`,type:"text",value:d||"",onChange:L=>U(g,L.target.value),className:"flex-1 px-4 py-2 bg-slate-900 border border-slate-700 rounded text-slate-200 font-mono text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:`SubID ${g+1}`}),e.jsx("button",{onClick:()=>_(g),className:"px-3 py-2 bg-red-600 hover:bg-red-700 text-white rounded transition-colors flex items-center gap-2",type:"button",title:"–£–¥–∞–ª–∏—Ç—å SubID",children:e.jsx(ae,{className:"w-4 h-4"})})]},g)):e.jsx("div",{className:"text-slate-400 text-sm py-2 px-4 bg-slate-900 border border-slate-700 rounded",children:'SubID –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω—ã. –ù–∞–∂–º–∏—Ç–µ "–î–æ–±–∞–≤–∏—Ç—å" —á—Ç–æ–±—ã –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π SubID.'}),(!l.subid||l.subid.length===0)&&e.jsxs("button",{onClick:p,className:"w-full px-4 py-2 bg-slate-900 border border-slate-700 border-dashed rounded text-slate-400 hover:text-slate-200 hover:border-slate-600 transition-colors flex items-center justify-center gap-2",type:"button",children:[e.jsx($e,{className:"w-4 h-4"}),"–î–æ–±–∞–≤–∏—Ç—å –ø–µ—Ä–≤—ã–π SubID"]})]}),e.jsx("p",{className:"text-slate-500 text-xs mt-2",children:"SubID –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥–ª—è –ø–æ–¥–ø–∏—Å–æ–∫ –≤ 3x-ui. –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –∑–Ω–∞—á–µ–Ω–∏–π."})]}),e.jsxs("div",{className:"bg-slate-800 rounded-lg p-6 border border-slate-700",children:[e.jsxs("h3",{className:"text-lg font-semibold text-slate-200 mb-4 flex items-center gap-2",children:[e.jsx(Cs,{className:"w-5 h-5"}),"–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–¥–ø–∏—Å–∫–µ"]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[l.periodMonths&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-slate-300 text-sm font-medium mb-2",children:"–ü–µ—Ä–∏–æ–¥ –æ–ø–ª–∞—Ç—ã"}),e.jsxs("div",{className:"px-4 py-2 bg-slate-900 border border-slate-700 rounded text-slate-200",children:[l.periodMonths," ",l.periodMonths===1?"–º–µ—Å—è—Ü":l.periodMonths<5?"–º–µ—Å—è—Ü–∞":"–º–µ—Å—è—Ü–µ–≤"]})]}),l.paymentStatus&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-slate-300 text-sm font-medium mb-2",children:"–°—Ç–∞—Ç—É—Å –æ–ø–ª–∞—Ç—ã"}),e.jsx("div",{className:"px-4 py-2 bg-slate-900 border border-slate-700 rounded",children:e.jsx("span",{className:`px-2 py-1 rounded text-xs font-medium ${l.paymentStatus==="paid"?"bg-green-900/30 text-green-300":l.paymentStatus==="test_period"?"bg-yellow-900/30 text-yellow-300":l.paymentStatus==="unpaid"?"bg-red-900/30 text-red-300":"bg-slate-700 text-slate-300"}`,children:l.paymentStatus==="paid"?"–û–ø–ª–∞—á–µ–Ω–æ":l.paymentStatus==="test_period"?"–¢–µ—Å—Ç–æ–≤—ã–π –ø–µ—Ä–∏–æ–¥":l.paymentStatus==="unpaid"?"–ù–µ –æ–ø–ª–∞—á–µ–Ω–æ":l.paymentStatus||"–ù–µ —É–∫–∞–∑–∞–Ω"})})]}),l.testPeriodStartDate&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-slate-300 text-sm font-medium mb-2",children:"–ù–∞—á–∞–ª–æ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –ø–µ—Ä–∏–æ–¥–∞"}),e.jsx("div",{className:"px-4 py-2 bg-slate-900 border border-slate-700 rounded text-slate-400 text-sm",children:i?.(l.testPeriodStartDate)||new Date(l.testPeriodStartDate).toLocaleString()})]}),l.testPeriodEndDate&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-slate-300 text-sm font-medium mb-2",children:"–û–∫–æ–Ω—á–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –ø–µ—Ä–∏–æ–¥–∞"}),e.jsx("div",{className:"px-4 py-2 bg-slate-900 border border-slate-700 rounded text-slate-400 text-sm",children:i?.(l.testPeriodEndDate)||new Date(l.testPeriodEndDate).toLocaleString()})]}),l.natrockPort&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-slate-300 text-sm font-medium mb-2",children:"NatRock –ø–æ—Ä—Ç"}),e.jsx("div",{className:"px-4 py-2 bg-slate-900 border border-slate-700 rounded text-slate-200",children:l.natrockPort})]}),l.syncedWithN8nAt&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-slate-300 text-sm font-medium mb-2",children:"–ü–æ—Å–ª–µ–¥–Ω—è—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å n8n"}),e.jsx("div",{className:"px-4 py-2 bg-slate-900 border border-slate-700 rounded text-slate-400 text-sm",children:i?.(l.syncedWithN8nAt)||new Date(l.syncedWithN8nAt).toLocaleString()}),l.lastSyncChanges&&l.lastSyncChanges.length>0&&e.jsxs("p",{className:"text-slate-500 text-xs mt-1",children:["–û–±–Ω–æ–≤–ª–µ–Ω–æ –ø–æ–ª–µ–π: ",l.lastSyncChanges.join(", ")]})]})]})]}),e.jsxs("div",{className:"bg-slate-800 rounded-lg p-6 border border-slate-700",children:[e.jsxs("h3",{className:"text-lg font-semibold text-slate-200 mb-4 flex items-center gap-2",children:[e.jsx(Pe,{className:"w-5 h-5"}),"–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è"]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-slate-300 text-sm font-medium mb-2",children:"–†–æ–ª—å"}),e.jsx("div",{className:"px-4 py-2 bg-slate-900 border border-slate-700 rounded",children:e.jsx("span",{className:`px-2 py-1 rounded text-xs font-medium ${l.role==="admin"?"bg-purple-900/30 text-purple-300":"bg-slate-700 text-slate-300"}`,children:l.role==="admin"?"–ê–¥–º–∏–Ω":"–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å"})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-slate-300 text-sm font-medium mb-2",children:"–ü–ª–∞–Ω"}),e.jsx("div",{className:"px-4 py-2 bg-slate-900 border border-slate-700 rounded text-slate-200",children:l.plan==="premium"?"–ü—Ä–µ–º–∏—É–º":l.plan||"–ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π"})]}),a.createdAt&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-slate-300 text-sm font-medium mb-2",children:"–î–∞—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏"}),e.jsx("div",{className:"px-4 py-2 bg-slate-900 border border-slate-700 rounded text-slate-400 text-sm",children:i?.(a.createdAt)||new Date(a.createdAt).toLocaleString()})]}),a.updatedAt&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-slate-300 text-sm font-medium mb-2",children:"–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ"}),e.jsx("div",{className:"px-4 py-2 bg-slate-900 border border-slate-700 rounded text-slate-400 text-sm",children:i?.(a.updatedAt)||new Date(a.updatedAt).toLocaleString()})]})]})]})]}),e.jsxs("div",{className:"sticky bottom-0 bg-slate-900 border-t border-slate-800 p-4 sm:p-6 flex flex-col sm:flex-row items-stretch sm:items-center justify-end gap-2 sm:gap-3",children:[e.jsx("button",{onClick:s,className:"px-4 py-2 bg-slate-700 hover:bg-slate-600 text-white rounded transition-colors w-full sm:w-auto",type:"button",disabled:N,children:"–û—Ç–º–µ–Ω–∞"}),e.jsx("button",{onClick:D,disabled:N,className:"px-4 py-2 bg-green-600 hover:bg-green-700 disabled:bg-slate-700 disabled:cursor-not-allowed text-white rounded transition-colors flex items-center justify-center gap-2 w-full sm:w-auto",type:"button",children:N?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),"–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ..."]}):e.jsxs(e.Fragment,{children:[e.jsx(re,{className:"w-4 h-4"}),"–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è"]})})]})]})})};Je.propTypes=ct;const mt=({onSaveSettings:a})=>{const{settings:s}=We(),[t,n]=c.useState(""),[i,r]=c.useState(!0),[u,l]=c.useState(!1),[f,N]=c.useState(null),[j,y]=c.useState(null),[m,T]=c.useState(!1),S=c.useRef(!1);c.useEffect(()=>{(async()=>{if(S.current){o.debug("Admin","–ü—Ä–æ–ø—É—Å–∫ –∑–∞–≥—Ä—É–∑–∫–∏ URL - —Ç–æ–ª—å–∫–æ —á—Ç–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω"),S.current=!1,r(!1);return}if(s){const k=s.n8nWebhookUrl||s.webhookUrl||"";o.info("Admin","–ó–∞–≥—Ä—É–∑–∫–∞ webhook URL –∏–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ settings",{hasSettings:!!s,n8nWebhookUrl:s.n8nWebhookUrl,webhookUrl:s.webhookUrl,loadedUrl:k,currentWebhookUrl:t}),k!==t&&n(k),r(!1);return}if(!B){N("–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞"),r(!1);return}try{o.debug("Admin","–ó–∞–≥—Ä—É–∑–∫–∞ webhook URL –∏–∑ Firestore (settings –Ω–µ—Ç –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ)");const k=Y(B,`artifacts/${z}/public/settings`),I=await ge(k);if(I.exists()){const E=I.data(),w=E.n8nWebhookUrl||E.webhookUrl||"";o.debug("Admin","Webhook URL –∑–∞–≥—Ä—É–∂–µ–Ω –∏–∑ Firestore",{n8nWebhookUrl:E.n8nWebhookUrl,webhookUrl:E.webhookUrl,loadedUrl:w}),n(w)}else o.debug("Admin","–î–æ–∫—É–º–µ–Ω—Ç –Ω–∞—Å—Ç—Ä–æ–µ–∫ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ Firestore"),n("")}catch(k){o.error("Admin","–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫ n8n",null,k),N("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫")}finally{r(!1)}})()},[s]);const P=c.useCallback(async()=>{if(!B){N("–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞");return}l(!0),N(null),y(null);try{if(t.trim()&&!v(t.trim())){N("–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç URL. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–æ–ª–Ω—ã–π URL (–Ω–∞–ø—Ä–∏–º–µ—Ä: https://example.com/webhook)"),l(!1);return}const h=Y(B,`artifacts/${z}/public/settings`),k=await ge(h),E={...k.exists()?k.data():{},n8nWebhookUrl:t.trim()||"",webhookUrl:t.trim()||"",updatedAt:new Date().toISOString()};await ie(h,E,{merge:!0}),o.info("Admin","Webhook URL —Å–æ—Ö—Ä–∞–Ω–µ–Ω –≤ Firestore",{webhookUrl:t.trim(),savedFields:{n8nWebhookUrl:E.n8nWebhookUrl,webhookUrl:E.webhookUrl}});const w=t.trim();if(S.current=!0,n(w),a)try{o.info("Admin","–í—ã–∑–æ–≤ onSaveSettings callback –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫"),await a(),o.info("Admin","onSaveSettings callback —É—Å–ø–µ—à–Ω–æ –≤—ã–ø–æ–ª–Ω–µ–Ω")}catch(R){o.warn("Admin","–û—à–∏–±–∫–∞ –≤—ã–∑–æ–≤–∞ onSaveSettings callback",null,R)}else o.warn("Admin","onSaveSettings callback –Ω–µ –ø–µ—Ä–µ–¥–∞–Ω –≤ N8nPanel");y("Webhook URL —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω –∏ –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –≤–µ–∑–¥–µ"),setTimeout(()=>y(null),3e3),setTimeout(()=>{S.current=!1,o.debug("Admin","–§–ª–∞–≥ justSaved —Å–±—Ä–æ—à–µ–Ω, –∑–∞–≥—Ä—É–∑–∫–∞ –∏–∑ settings —Ä–∞–∑—Ä–µ—à–µ–Ω–∞")},1e3),o.info("Admin","Webhook URL —Å–æ—Ö—Ä–∞–Ω–µ–Ω –∏ –ª–æ–∫–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–æ",{savedUrl:w,currentWebhookUrlState:w})}catch(h){o.error("Admin","–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è webhook URL",null,h),N("–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è: "+(h.message||"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞"))}finally{l(!1)}},[t,a]),C=c.useCallback(async()=>{if(t.trim())try{await navigator.clipboard.writeText(t.trim()),T(!0),setTimeout(()=>T(!1),2e3)}catch(h){o.error("Admin","–û—à–∏–±–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è URL",null,h),N("–ù–µ —É–¥–∞–ª–æ—Å—å —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å URL")}},[t]),v=h=>{try{const k=new URL(h);return k.protocol==="http:"||k.protocol==="https:"}catch{return!1}};return i?e.jsx("div",{className:"bg-slate-900 rounded-lg sm:rounded-xl shadow-xl border border-slate-800 p-6",children:e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"w-8 h-8 border-2 border-slate-600 border-t-blue-600 rounded-full animate-spin"})})}):e.jsxs("div",{className:"bg-slate-900 rounded-lg sm:rounded-xl shadow-xl border border-slate-800 overflow-hidden",children:[e.jsxs("div",{className:"p-4 sm:p-6 border-b border-slate-800",children:[e.jsxs("h2",{className:"text-xl sm:text-2xl font-bold text-slate-200 flex items-center gap-2 sm:gap-3",children:[e.jsx(Ee,{className:"w-5 h-5 sm:w-6 sm:h-6"}),"n8n Webhook"]}),e.jsx("p",{className:"text-slate-400 text-sm sm:text-base mt-1",children:"–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ webhook URL –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å n8n. –ò–∑–º–µ–Ω–µ–Ω–∏—è –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –∫–æ –≤—Å–µ–º –æ–ø–µ—Ä–∞—Ü–∏—è–º."})]}),e.jsxs("div",{className:"p-4 sm:p-6 space-y-4 sm:space-y-6",children:[f&&e.jsx("div",{className:"p-3 sm:p-4 bg-red-900/30 border border-red-800 rounded-lg text-red-300 text-sm sm:text-base",children:f}),j&&e.jsx("div",{className:"p-3 sm:p-4 bg-green-900/30 border border-green-800 rounded-lg text-green-300 text-sm sm:text-base",children:j}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-slate-300 text-sm sm:text-base font-medium mb-2",children:"Webhook URL"}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[e.jsx("input",{type:"url",value:t,onChange:h=>n(h.target.value),placeholder:"https://your-n8n-instance.com/webhook/...",className:"flex-1 px-4 py-2 sm:py-3 bg-slate-800 border border-slate-700 rounded-lg text-slate-200 focus:outline-none focus:ring-2 focus:ring-blue-500 font-mono text-sm sm:text-base"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:C,disabled:!t.trim(),className:"px-4 py-2 sm:py-3 bg-slate-700 hover:bg-slate-600 disabled:bg-slate-800 disabled:cursor-not-allowed text-white rounded-lg transition-colors flex items-center gap-2 min-h-[44px] touch-manipulation",title:"–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å URL",children:[e.jsx(me,{className:"w-4 h-4 sm:w-5 sm:h-5"}),m?"–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ!":"–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å"]}),t.trim()&&e.jsxs("a",{href:t.trim(),target:"_blank",rel:"noopener noreferrer",className:"px-4 py-2 sm:py-3 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors flex items-center gap-2 min-h-[44px] touch-manipulation",title:"–û—Ç–∫—Ä—ã—Ç—å –≤ –Ω–æ–≤–æ–π –≤–∫–ª–∞–¥–∫–µ",children:[e.jsx(Is,{className:"w-4 h-4 sm:w-5 sm:h-5"}),"–û—Ç–∫—Ä—ã—Ç—å"]})]})]}),e.jsx("p",{className:"text-slate-500 text-xs sm:text-sm mt-2",children:"–í–≤–µ–¥–∏—Ç–µ –ø–æ–ª–Ω—ã–π URL webhook –∏–∑ –≤–∞—à–µ–≥–æ n8n –∏–Ω—Å—Ç–∞–Ω—Å–∞. –≠—Ç–æ—Ç URL –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –¥–ª—è –≤—Å–µ—Ö –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–π —Å n8n."})]}),e.jsx("div",{className:"bg-blue-900/20 border border-blue-800/50 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(ue,{className:"w-5 h-5 text-blue-400 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"text-sm sm:text-base text-blue-300",children:[e.jsx("p",{className:"font-semibold mb-1",children:"–í–∞–∂–Ω–æ:"}),e.jsxs("ul",{className:"list-disc list-inside space-y-1 text-blue-200/90",children:[e.jsx("li",{children:"–ò–∑–º–µ–Ω–µ–Ω–∏–µ webhook URL –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –∫–æ –≤—Å–µ–º –æ–ø–µ—Ä–∞—Ü–∏—è–º, –∏—Å–ø–æ–ª—å–∑—É—é—â–∏–º n8n"}),e.jsx("li",{children:"–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ URL –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –∏ –¥–æ—Å—Ç—É–ø–µ–Ω"}),e.jsx("li",{children:"–°–æ—Ö—Ä–∞–Ω–∏—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫"})]})]})]})})]}),e.jsx("div",{className:"flex justify-end pt-4 border-t border-slate-800",children:e.jsx("button",{onClick:P,disabled:u,className:"px-6 py-2 sm:py-3 bg-green-600 hover:bg-green-700 disabled:bg-slate-700 disabled:cursor-not-allowed text-white rounded-lg transition-colors flex items-center gap-2 min-h-[44px] touch-manipulation",children:u?e.jsxs(e.Fragment,{children:[e.jsx(De,{className:"w-4 h-4 sm:w-5 sm:h-5 animate-spin"}),"–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ..."]}):e.jsxs(e.Fragment,{children:[e.jsx(re,{className:"w-4 h-4 sm:w-5 sm:h-5"}),"–°–æ—Ö—Ä–∞–Ω–∏—Ç—å webhook URL"]})})})]})]})},ut=()=>{const[a,s]=c.useState(null),[t,n]=c.useState([]),[i,r]=c.useState("all"),[u,l]=c.useState([]),[f,N]=c.useState(!0),[j,y]=c.useState(null),[m,T]=c.useState(null),[S,P]=c.useState(null),[C,v]=c.useState(null),h=c.useRef(null),k=30,I=window.location.origin,E=!0,w=c.useCallback(()=>{try{const d=performance.memory?{usedJSHeapSize:performance.memory.usedJSHeapSize,totalJSHeapSize:performance.memory.totalJSHeapSize,jsHeapSizeLimit:performance.memory.jsHeapSizeLimit}:null;return{platform:navigator.platform,userAgent:navigator.userAgent,language:navigator.language,onLine:navigator.onLine,cookieEnabled:navigator.cookieEnabled,memory:d,screen:{width:window.screen.width,height:window.screen.height,availWidth:window.screen.availWidth,availHeight:window.screen.availHeight},connection:navigator.connection?{effectiveType:navigator.connection.effectiveType,downlink:navigator.connection.downlink,rtt:navigator.connection.rtt,saveData:navigator.connection.saveData}:null,timestamp:Date.now()}}catch(d){return o.error("SystemMonitor","–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞ –∫–ª–∏–µ–Ω—Ç–∞",null,d),null}},[]),R=c.useCallback(async()=>{try{const d=await ce.get(`${I}/api/system/status`,{timeout:5e3,validateStatus:()=>!0});if(d.status===200&&d.data.success){const g=d.data.data;g.xui?.responseTime&&l(L=>[...L,{time:new Date().toLocaleTimeString("ru-RU",{hour:"2-digit",minute:"2-digit",second:"2-digit"}),latency:g.xui.responseTime,timestamp:Date.now()}].slice(-k)),s(g),y(null)}else P(w()),s(null)}catch(d){o.warn("SystemMonitor","API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω, –∏—Å–ø–æ–ª—å–∑—É–µ–º —Å—Ç–∞—Ç—É—Å –∫–ª–∏–µ–Ω—Ç–∞",null,d),P(w()),s(null),j||y(null)}finally{N(!1)}},[I,E,w,j]),X=c.useCallback(async()=>{try{const d=await ce.get(`${I}/api/system/logs`,{params:{limit:100,level:i==="all"?"all":i,since:36e5},timeout:5e3,validateStatus:()=>!0});d.status===200&&d.data.success&&n(d.data.data.logs||[])}catch(d){o.warn("SystemMonitor","–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –ª–æ–≥–æ–≤",null,d)}},[I,i,E]),p=c.useCallback(async d=>{T(d),y(null);try{const g=await ce.post(`${I}/api/system/restart/${d}`,{},{timeout:1e4,validateStatus:()=>!0});if(g.status===200&&g.data.success)o.info("SystemMonitor",`–ú–æ–¥—É–ª—å ${d} –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω`,{moduleId:d}),v(`–ú–æ–¥—É–ª—å ${d} —É—Å–ø–µ—à–Ω–æ –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω`),setTimeout(()=>v(null),3e3),setTimeout(()=>{R()},2e3);else throw new Error(g.data.message||"–ù–µ —É–¥–∞–ª–æ—Å—å –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –º–æ–¥—É–ª—å")}catch(g){o.error("SystemMonitor",`–û—à–∏–±–∫–∞ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ –º–æ–¥—É–ª—è ${d}`,{moduleId:d},g),y(`–û—à–∏–±–∫–∞ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ –º–æ–¥—É–ª—è ${d}: ${g.message||"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞"}`)}finally{T(null)}},[I,E,R]);c.useEffect(()=>{R(),X(),P(w())},[R,X,w]),c.useEffect(()=>{const d=setInterval(()=>{R(),X(),P(w())},5e3);return()=>clearInterval(d)},[R,X,w]),c.useEffect(()=>{h.current?.scrollIntoView({behavior:"smooth"})},[t]);const _=c.useCallback(()=>{n([]),o.info("SystemMonitor","–õ–æ–≥–∏ –æ—á–∏—â–µ–Ω—ã")},[]),U=d=>d?"text-green-400":"text-red-400",A=d=>d?le:ve,D=d=>{switch(d){case"error":return"text-red-400";case"warn":return"text-yellow-400";case"info":return"text-blue-400";default:return"text-slate-400"}},V=d=>{const g={error:"bg-red-900/30 text-red-400 border-red-800",warn:"bg-yellow-900/30 text-yellow-400 border-yellow-800",info:"bg-blue-900/30 text-blue-400 border-blue-800",pending:"bg-slate-800 text-slate-400 border-slate-700"};return g[d]||g.pending},F=d=>{if(!d||d===0)return"0 B";const g=1024,L=["B","KB","MB","GB"],O=Math.floor(Math.log(d)/Math.log(g));return`${(d/Math.pow(g,O)).toFixed(2)} ${L[O]}`},q=[{id:"app",name:"–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ",icon:de,description:"–û—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ"},{id:"api",name:"API",icon:As,description:"API —Å–µ—Ä–≤–µ—Ä"},{id:"vpn",name:"VPN –°–µ—Ä–≤–∏—Å",icon:_e,description:"VPN —Å–µ—Ä–≤–∏—Å –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å 3x-ui"},{id:"proxy",name:"–ü—Ä–æ–∫—Å–∏",icon:Le,description:"–ü—Ä–æ–∫—Å–∏ —Å–µ—Ä–≤–µ—Ä"}];return f&&!a&&!S?e.jsx("div",{className:"bg-slate-900 rounded-lg sm:rounded-xl shadow-xl section-spacing-sm border border-slate-800",children:e.jsx("div",{className:"flex items-center justify-center h-48 sm:h-64",children:e.jsxs("div",{className:"text-center",children:[e.jsx(ke,{className:"w-8 h-8 animate-spin text-blue-500 mx-auto mb-4"}),e.jsx("div",{className:"text-slate-400 text-[clamp(0.875rem,0.8rem+0.375vw,1rem)]",children:"–ó–∞–≥—Ä—É–∑–∫–∞ –º–µ—Ç—Ä–∏–∫ —Å–∏—Å—Ç–µ–º—ã..."})]})})}):e.jsxs("div",{className:"space-y-4 sm:space-y-5 md:space-y-6",children:[C&&e.jsxs("div",{className:"bg-green-900/30 border border-green-800 rounded-lg sm:rounded-xl p-3 sm:p-4 flex items-center gap-3",children:[e.jsx(le,{className:"w-5 h-5 text-green-400 flex-shrink-0"}),e.jsx("div",{className:"text-green-300 text-[clamp(0.875rem,0.8rem+0.375vw,1rem)]",children:C})]}),j&&e.jsxs("div",{className:"bg-red-900/30 border border-red-800 rounded-lg sm:rounded-xl p-3 sm:p-4 flex items-center gap-3",children:[e.jsx(ue,{className:"w-5 h-5 text-red-400 flex-shrink-0"}),e.jsx("div",{className:"text-red-300 text-[clamp(0.875rem,0.8rem+0.375vw,1rem)]",children:j})]}),e.jsxs("div",{className:"bg-slate-900 rounded-lg sm:rounded-xl shadow-xl section-spacing-sm border border-slate-800",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3 sm:mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(de,{className:"w-4 h-4 sm:w-5 sm:h-5 text-slate-400 flex-shrink-0"}),e.jsx("h3",{className:"text-[clamp(1rem,0.95rem+0.25vw,1.125rem)] sm:text-lg font-semibold text-slate-200",children:"–°–æ—Å—Ç–æ—è–Ω–∏–µ —Å–µ—Ä–≤–µ—Ä–∞"})]}),a&&(()=>{const d=A(a.connected!==!1);return e.jsx(d,{className:`w-5 h-5 sm:w-6 sm:h-6 ${U(a.connected!==!1)} flex-shrink-0`})})()]}),e.jsxs("div",{className:"space-y-2",children:[a?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-slate-400 text-[clamp(0.75rem,0.7rem+0.25vw,0.875rem)] sm:text-sm",children:"–°—Ç–∞—Ç—É—Å API"}),e.jsx("span",{className:`font-semibold text-[clamp(0.875rem,0.8rem+0.375vw,1rem)] ${U(a.connected!==!1)}`,children:a.connected!==!1?"–î–æ—Å—Ç—É–ø–µ–Ω":"–ù–µ–¥–æ—Å—Ç—É–ø–µ–Ω"})]}),a.uptime&&e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-slate-400 text-[clamp(0.75rem,0.7rem+0.25vw,0.875rem)] sm:text-sm",children:"Uptime"}),e.jsx("span",{className:"text-slate-200 font-mono text-[clamp(0.75rem,0.7rem+0.25vw,0.875rem)] sm:text-sm",children:a.uptime.formatted||a.uptime})]})]}):e.jsx("div",{className:"text-slate-400 text-[clamp(0.75rem,0.7rem+0.25vw,0.875rem)] sm:text-sm",children:"API —Å–µ—Ä–≤–µ—Ä–∞ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω. –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Å—Ç–∞—Ç—É—Å –∫–ª–∏–µ–Ω—Ç–∞."}),S&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-slate-400 text-[clamp(0.75rem,0.7rem+0.25vw,0.875rem)] sm:text-sm",children:"–ö–ª–∏–µ–Ω—Ç (–±—Ä–∞—É–∑–µ—Ä)"}),e.jsx("span",{className:`font-semibold text-[clamp(0.875rem,0.8rem+0.375vw,1rem)] ${U(S.onLine)}`,children:S.onLine?"–û–Ω–ª–∞–π–Ω":"–û—Ñ–ª–∞–π–Ω"})]}),S.memory&&e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-slate-400 text-[clamp(0.75rem,0.7rem+0.25vw,0.875rem)] sm:text-sm",children:"–ü–∞–º—è—Ç—å –±—Ä–∞—É–∑–µ—Ä–∞"}),e.jsxs("span",{className:"text-slate-200 font-mono text-[clamp(0.75rem,0.7rem+0.25vw,0.875rem)] sm:text-sm",children:[F(S.memory.usedJSHeapSize)," / ",F(S.memory.totalJSHeapSize)]})]}),S.connection&&e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-slate-400 text-[clamp(0.75rem,0.7rem+0.25vw,0.875rem)] sm:text-sm",children:"–°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ"}),e.jsxs("span",{className:"text-slate-200 text-[clamp(0.75rem,0.7rem+0.25vw,0.875rem)] sm:text-sm",children:[S.connection.effectiveType," (",S.connection.downlink," Mbps)"]})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3 sm:gap-4",children:[e.jsxs("div",{className:"bg-slate-900 rounded-lg sm:rounded-xl shadow-xl section-spacing-sm border border-slate-800",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3 sm:mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ks,{className:"w-4 h-4 sm:w-5 sm:h-5 text-slate-400 flex-shrink-0"}),e.jsx("h3",{className:"text-[clamp(1rem,0.95rem+0.25vw,1.125rem)] sm:text-lg font-semibold text-slate-200",children:"3x-ui"})]}),a?.xui&&(()=>{const d=A(a.xui.connected);return e.jsx(d,{className:`w-5 h-5 sm:w-6 sm:h-6 ${U(a.xui.connected)} flex-shrink-0`})})()]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-slate-400 text-[clamp(0.75rem,0.7rem+0.25vw,0.875rem)] sm:text-sm",children:"–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ"}),e.jsx("span",{className:`font-semibold text-[clamp(0.875rem,0.8rem+0.375vw,1rem)] ${U(a?.xui?.connected)}`,children:a?.xui?.connected?"–ü–æ–¥–∫–ª—é—á–µ–Ω–æ":a?.xui?"–û—Ç–∫–ª—é—á–µ–Ω–æ":"–ù/–î"})]}),a?.xui?.responseTime&&e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-slate-400 text-[clamp(0.75rem,0.7rem+0.25vw,0.875rem)] sm:text-sm",children:"–í—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞"}),e.jsxs("span",{className:"text-slate-200 font-mono text-[clamp(0.75rem,0.7rem+0.25vw,0.875rem)] sm:text-sm",children:[a.xui.responseTime,"ms"]})]}),a?.xui?.error&&e.jsx("div",{className:"text-red-400 text-xs mt-2",children:a.xui.error})]})]}),e.jsxs("div",{className:"bg-slate-900 rounded-lg sm:rounded-xl shadow-xl section-spacing-sm border border-slate-800",children:[e.jsx("div",{className:"flex items-center justify-between mb-3 sm:mb-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Us,{className:"w-4 h-4 sm:w-5 sm:h-5 text-slate-400 flex-shrink-0"}),e.jsx("h3",{className:"text-[clamp(1rem,0.95rem+0.25vw,1.125rem)] sm:text-lg font-semibold text-slate-200",children:"CPU"})]})}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-slate-400 text-[clamp(0.75rem,0.7rem+0.25vw,0.875rem)] sm:text-sm",children:"–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ"}),e.jsxs("span",{className:"text-slate-200 font-semibold text-[clamp(1rem,0.95rem+0.25vw,1.125rem)] sm:text-lg",children:[a?.cpu?.usage?.toFixed(1)||"N/A","%"]})]}),a?.cpu?.usage!==void 0?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-full bg-slate-800 rounded-full h-2",children:e.jsx("div",{className:`h-2 rounded-full transition-all ${a.cpu.usage>80?"bg-red-500":a.cpu.usage>50?"bg-yellow-500":"bg-green-500"}`,style:{width:`${Math.min(a.cpu.usage,100)}%`}})}),e.jsxs("div",{className:"flex justify-between items-center text-[clamp(0.7rem,0.65rem+0.25vw,0.75rem)] sm:text-xs text-slate-500",children:[e.jsxs("span",{children:["–Ø–¥–µ—Ä: ",a.cpu.cores||"N/A"]}),e.jsxs("span",{children:["Load: ",a.cpu.load?.toFixed(2)||"N/A"]})]})]}):e.jsx("div",{className:"text-slate-500 text-xs",children:"–ú–µ—Ç—Ä–∏–∫–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã"})]})]}),e.jsxs("div",{className:"bg-slate-900 rounded-lg sm:rounded-xl shadow-xl section-spacing-sm border border-slate-800",children:[e.jsx("div",{className:"flex items-center justify-between mb-3 sm:mb-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ie,{className:"w-4 h-4 sm:w-5 sm:h-5 text-slate-400 flex-shrink-0"}),e.jsx("h3",{className:"text-[clamp(1rem,0.95rem+0.25vw,1.125rem)] sm:text-lg font-semibold text-slate-200",children:"RAM"})]})}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-slate-400 text-[clamp(0.75rem,0.7rem+0.25vw,0.875rem)] sm:text-sm",children:"–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ"}),e.jsxs("span",{className:"text-slate-200 font-semibold text-[clamp(1rem,0.95rem+0.25vw,1.125rem)] sm:text-lg",children:[(a?.ram?.usage?.toFixed(1)||S?.memory)&&S.memory?(S.memory.usedJSHeapSize/S.memory.totalJSHeapSize*100).toFixed(1):"N/A","%"]})]}),a?.ram?.usage!==void 0?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-full bg-slate-800 rounded-full h-2",children:e.jsx("div",{className:`h-2 rounded-full transition-all ${a.ram.usage>80?"bg-red-500":a.ram.usage>50?"bg-yellow-500":"bg-green-500"}`,style:{width:`${Math.min(a.ram.usage,100)}%`}})}),e.jsxs("div",{className:"flex justify-between items-center text-[clamp(0.7rem,0.65rem+0.25vw,0.75rem)] sm:text-xs text-slate-500",children:[e.jsxs("span",{children:[a.ram.usedGB?.toFixed(2)||"N/A"," GB"]}),e.jsxs("span",{children:["–∏–∑ ",a.ram.totalGB?.toFixed(2)||"N/A"," GB"]})]})]}):S?.memory?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-full bg-slate-800 rounded-full h-2",children:e.jsx("div",{className:`h-2 rounded-full transition-all ${S.memory.usedJSHeapSize/S.memory.totalJSHeapSize*100>80?"bg-red-500":S.memory.usedJSHeapSize/S.memory.totalJSHeapSize*100>50?"bg-yellow-500":"bg-green-500"}`,style:{width:`${Math.min(S.memory.usedJSHeapSize/S.memory.totalJSHeapSize*100,100)}%`}})}),e.jsxs("div",{className:"flex justify-between items-center text-[clamp(0.7rem,0.65rem+0.25vw,0.75rem)] sm:text-xs text-slate-500",children:[e.jsx("span",{children:F(S.memory.usedJSHeapSize)}),e.jsxs("span",{children:["–∏–∑ ",F(S.memory.totalJSHeapSize)]})]})]}):e.jsx("div",{className:"text-slate-500 text-xs",children:"–ú–µ—Ç—Ä–∏–∫–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã"})]})]}),e.jsxs("div",{className:"bg-slate-900 rounded-lg sm:rounded-xl shadow-xl section-spacing-sm border border-slate-800",children:[e.jsx("div",{className:"flex items-center justify-between mb-3 sm:mb-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Le,{className:"w-4 h-4 sm:w-5 sm:h-5 text-slate-400 flex-shrink-0"}),e.jsx("h3",{className:"text-[clamp(1rem,0.95rem+0.25vw,1.125rem)] sm:text-lg font-semibold text-slate-200",children:"–ü–æ–¥–∫–ª—é—á–µ–Ω–∏—è"})]})}),e.jsx("div",{className:"space-y-2",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-slate-400 text-[clamp(0.75rem,0.7rem+0.25vw,0.875rem)] sm:text-sm",children:"–ê–∫—Ç–∏–≤–Ω—ã–µ"}),e.jsx("span",{className:"text-slate-200 font-semibold text-[clamp(1rem,0.95rem+0.25vw,1.125rem)] sm:text-lg",children:a?.activeConnections||0})]})})]})]}),e.jsxs("div",{className:"bg-slate-900 rounded-lg sm:rounded-xl shadow-xl section-spacing-sm border border-slate-800",children:[e.jsx("div",{className:"flex items-center justify-between mb-3 sm:mb-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(_e,{className:"w-4 h-4 sm:w-5 sm:h-5 text-slate-400 flex-shrink-0"}),e.jsx("h3",{className:"text-[clamp(1rem,0.95rem+0.25vw,1.125rem)] sm:text-lg font-semibold text-slate-200",children:"–ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ –º–æ–¥—É–ª–µ–π"})]})}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3 sm:gap-4",children:q.map(d=>{const g=d.icon,L=m===d.id;return e.jsxs("div",{className:"p-3 sm:p-4 bg-slate-800 rounded-lg sm:rounded-xl border border-slate-700 flex flex-col items-center gap-2 sm:gap-3",children:[e.jsx(g,{className:"w-6 h-6 sm:w-8 sm:h-8 text-slate-400 flex-shrink-0"}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-slate-200 font-semibold text-[clamp(0.875rem,0.8rem+0.375vw,1rem)]",children:d.name}),e.jsx("div",{className:"text-slate-500 text-[clamp(0.7rem,0.65rem+0.25vw,0.75rem)] sm:text-xs mt-1",children:d.description})]}),e.jsx("button",{onClick:()=>p(d.id),disabled:L,className:"w-full min-h-[44px] px-3 sm:px-4 py-2 bg-blue-600 hover:bg-blue-700 disabled:bg-slate-700 disabled:cursor-not-allowed text-white rounded-lg transition-colors flex items-center justify-center gap-2 text-sm sm:text-base touch-manipulation",title:`–ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å ${d.name}`,children:L?e.jsxs(e.Fragment,{children:[e.jsx(ke,{className:"w-4 h-4 animate-spin"}),e.jsx("span",{children:"–ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(De,{className:"w-4 h-4"}),e.jsx("span",{children:"–ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å"})]})})]},d.id)})}),e.jsx("p",{className:"text-slate-500 text-[clamp(0.7rem,0.65rem+0.25vw,0.75rem)] sm:text-xs mt-3 sm:mt-4",children:"–ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ –º–æ–¥—É–ª–µ–π –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ API —Å–µ—Ä–≤–µ—Ä–∞. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ API –¥–æ—Å—Ç—É–ø–µ–Ω."})]}),u.length>0&&e.jsxs("div",{className:"bg-slate-900 rounded-lg sm:rounded-xl shadow-xl section-spacing-sm border border-slate-800",children:[e.jsx("h3",{className:"text-[clamp(1rem,0.95rem+0.25vw,1.125rem)] sm:text-lg font-semibold text-slate-200 mb-3 sm:mb-4",children:"–í—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞ API (–º—Å)"}),e.jsx("div",{className:"w-full h-[200px] sm:h-[250px] md:h-[300px]",children:e.jsx($s,{width:"100%",height:"100%",children:e.jsxs(Ls,{data:u,children:[e.jsx(_s,{strokeDasharray:"3 3",stroke:"#334155"}),e.jsx(Fs,{dataKey:"time",stroke:"#94a3b8",style:{fontSize:"12px"}}),e.jsx(Os,{stroke:"#94a3b8",style:{fontSize:"12px"},label:{value:"–º—Å",angle:-90,position:"insideLeft",style:{fill:"#94a3b8"}}}),e.jsx(Bs,{contentStyle:{backgroundColor:"#1e293b",border:"1px solid #334155",borderRadius:"8px",color:"#e2e8f0"}}),e.jsx(Xs,{}),e.jsx(Vs,{type:"monotone",dataKey:"latency",stroke:"#3b82f6",strokeWidth:2,dot:{fill:"#3b82f6",r:4},name:"–í—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞ (–º—Å)"})]})})})]}),e.jsxs("div",{className:"bg-slate-900 rounded-lg sm:rounded-xl shadow-xl border border-slate-800",children:[e.jsxs("div",{className:"p-3 sm:p-4 border-b border-slate-800 flex flex-col sm:flex-row items-stretch sm:items-center justify-between gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2 sm:gap-4 flex-1",children:[e.jsx("h3",{className:"text-[clamp(1rem,0.95rem+0.25vw,1.125rem)] sm:text-lg font-semibold text-slate-200",children:"–õ–æ–≥–∏ —Å–∏—Å—Ç–µ–º—ã"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ts,{className:"w-4 h-4 text-slate-400 flex-shrink-0"}),e.jsxs("select",{value:i,onChange:d=>r(d.target.value),className:"min-h-[44px] bg-slate-800 border border-slate-700 rounded-lg px-3 py-2 text-[clamp(0.875rem,0.8rem+0.375vw,1rem)] text-slate-200 focus:outline-none focus:ring-2 focus:ring-blue-500 touch-manipulation",children:[e.jsx("option",{value:"all",children:"–í—Å–µ"}),e.jsx("option",{value:"info",children:"Info"}),e.jsx("option",{value:"warn",children:"Warning"}),e.jsx("option",{value:"error",children:"Error"})]})]})]}),e.jsxs("button",{onClick:_,className:"btn-icon-only-mobile min-h-[44px] flex items-center justify-center gap-2 px-3 py-2 bg-slate-800 hover:bg-slate-700 active:bg-slate-600 border border-slate-700 rounded-lg text-slate-200 text-[clamp(0.875rem,0.8rem+0.375vw,1rem)] transition-all touch-manipulation","aria-label":"–û—á–∏—Å—Ç–∏—Ç—å –ª–æ–≥–∏",children:[e.jsx(ae,{className:"w-4 h-4 flex-shrink-0"}),e.jsx("span",{className:"btn-text",children:"–û—á–∏—Å—Ç–∏—Ç—å"})]})]}),e.jsxs("div",{className:"p-3 sm:p-4 h-64 sm:h-96 overflow-y-auto bg-slate-950 font-mono text-[clamp(0.7rem,0.65rem+0.25vw,0.75rem)] sm:text-sm",children:[t.length>0?t.map((d,g)=>e.jsxs("div",{className:"mb-2 pb-2 border-b border-slate-800 last:border-0",children:[e.jsxs("div",{className:"flex items-start gap-3 flex-wrap",children:[e.jsx("span",{className:`px-2 py-0.5 rounded text-xs border ${V(d.level)}`,children:d.level?.toUpperCase()||"LOG"}),e.jsx("span",{className:"text-slate-500 text-xs",children:d.timestamp?new Date(d.timestamp).toLocaleTimeString("ru-RU",{hour:"2-digit",minute:"2-digit",second:"2-digit"}):"--:--:--"}),d.method&&e.jsx("span",{className:"text-slate-400 text-xs font-semibold",children:d.method}),d.endpoint&&e.jsx("span",{className:"text-slate-300 text-xs",children:d.endpoint}),d.statusCode&&e.jsx("span",{className:`text-xs ${d.statusCode>=400?"text-red-400":"text-green-400"}`,children:d.statusCode}),d.responseTime&&e.jsxs("span",{className:"text-slate-500 text-xs",children:[d.responseTime.toFixed(2),"ms"]})]}),e.jsx("div",{className:`mt-1 ${D(d.level)}`,children:d.message}),d.error?.stack&&e.jsx("div",{className:"mt-1 text-xs text-slate-600 font-mono",children:d.error.stack.split(`
`).slice(0,3).join(`
`)})]},d.id||g)):e.jsx("div",{className:"text-slate-500 text-center py-8",children:"–ù–µ—Ç –ª–æ–≥–æ–≤. API —Å–µ—Ä–≤–µ—Ä–∞ –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω."}),e.jsx("div",{ref:h})]})]}),!E]})},ht={currentUser:x.shape({id:x.string.isRequired,email:x.string.isRequired,role:x.string.isRequired}).isRequired,adminTab:x.oneOf(["users","settings","tariffs","n8n"]).isRequired,onSetAdminTab:x.func.isRequired,onSetView:x.func.isRequired,onHandleLogout:x.func.isRequired,users:x.arrayOf(x.shape({id:x.string.isRequired,email:x.string.isRequired,uuid:x.string,name:x.string,phone:x.string,expiresAt:x.number,trafficGB:x.number,devices:x.number,tariffId:x.string,plan:x.string,role:x.string})).isRequired,editingUser:x.object,onSetEditingUser:x.func.isRequired,onHandleUpdateUser:x.func.isRequired,onHandleDeleteUser:x.func.isRequired,onHandleCopy:x.func.isRequired,servers:x.arrayOf(x.object).isRequired,editingServer:x.object,onSetEditingServer:x.func.isRequired,onHandleAddServer:x.func.isRequired,onHandleSaveServer:x.func.isRequired,onHandleDeleteServer:x.func.isRequired,onHandleTestServerSession:x.func.isRequired,testingServerId:x.string,newServerIdRef:x.shape({current:x.string}),settingsLoading:x.bool.isRequired,tariffs:x.arrayOf(x.object).isRequired,editingTariff:x.object,onSetEditingTariff:x.func.isRequired,onHandleSaveTariff:x.func.isRequired,onHandleDeleteTariff:x.func.isRequired,onHandleSaveSettings:x.func.isRequired,formatDate:x.func.isRequired,showLogger:x.bool.isRequired,onSetShowLogger:x.func.isRequired,success:x.string,error:x.string,onHandleServerNameChange:x.func.isRequired,onHandleServerIPChange:x.func.isRequired,onHandleServerPortChange:x.func.isRequired,onHandleServerProtocolChange:x.func.isRequired,onHandleServerRandomPathChange:x.func.isRequired,onHandleServerRandomPathBlur:x.func.isRequired,onHandleServerUsernameChange:x.func.isRequired,onHandleServerPasswordChange:x.func.isRequired,onHandleServerInboundIdChange:x.func.isRequired,onHandleServerLocationChange:x.func.isRequired,onHandleServerActiveChange:x.func.isRequired,onHandleServerTariffChange:x.func.isRequired,onHandleTariffNameChange:x.func.isRequired,onHandleTariffPlanChange:x.func.isRequired,onHandleTariffPriceChange:x.func.isRequired,onHandleTariffDevicesChange:x.func.isRequired,onHandleTariffTrafficGBChange:x.func.isRequired,onHandleTariffDurationDaysChange:x.func.isRequired,onHandleTariffActiveChange:x.func.isRequired,onHandleSaveUserCard:x.func.isRequired,onGenerateUUID:x.func.isRequired};function be(a){return a?a.code==="permission-denied"?"–ù–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∏–ª–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ Firestore.":a.code==="unavailable"?"–°–µ—Ä–≤–∏—Å –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.":a.code==="not-found"?"–ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º—ã–µ –¥–∞–Ω–Ω—ã–µ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã.":a.code==="already-exists"?"–î–∞–Ω–Ω—ã–µ —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É—é—Ç.":a.code==="failed-precondition"?"–û–ø–µ—Ä–∞—Ü–∏—è –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ –≤ —Ç–µ–∫—É—â–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–∏.":a.code==="aborted"?"–û–ø–µ—Ä–∞—Ü–∏—è –±—ã–ª–∞ –ø—Ä–µ—Ä–≤–∞–Ω–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑.":a.code==="deadline-exceeded"?"–û–ø–µ—Ä–∞—Ü–∏—è –∑–∞–Ω—è–ª–∞ —Å–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑.":a.code==="resource-exhausted"?"–ü—Ä–µ–≤—ã—à–µ–Ω –ª–∏–º–∏—Ç —Ä–µ—Å—É—Ä—Å–æ–≤. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.":a.code==="cancelled"?"–û–ø–µ—Ä–∞—Ü–∏—è –±—ã–ª–∞ –æ—Ç–º–µ–Ω–µ–Ω–∞.":a.message&&a.message.includes("network")?"–ü—Ä–æ–±–ª–µ–º–∞ —Å —Å–µ—Ç—å—é. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É.":a.name==="ValidationError"?a.message||"–û—à–∏–±–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö.":a.message||"–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –æ–ø–µ—Ä–∞—Ü–∏–∏.":"–ü—Ä–æ–∏–∑–æ—à–ª–∞ –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞"}function se(a,s,t,n={}){const i={context:a,operation:s,error:{name:t?.name,message:t?.message,code:t?.code,stack:t?.stack},metadata:n,timestamp:new Date().toISOString()};console.error(`[${a}] –û—à–∏–±–∫–∞ –≤ ${s}:`,i)}const xt=({currentUser:a,adminTab:s,onSetAdminTab:t,onSetView:n,onHandleLogout:i,users:r,editingUser:u,onSetEditingUser:l,onHandleUpdateUser:f,onHandleDeleteUser:N,onHandleCopy:j,servers:y,editingServer:m,onSetEditingServer:T,onHandleAddServer:S,onHandleSaveServer:P,onHandleDeleteServer:C,onHandleTestServerSession:v,testingServerId:h,newServerIdRef:k,settingsLoading:I,tariffs:E,editingTariff:w,onSetEditingTariff:R,onHandleSaveTariff:X,onHandleDeleteTariff:p,onHandleSaveSettings:_,formatDate:U,showLogger:A,onSetShowLogger:D,success:V,error:F,onHandleServerNameChange:q,onHandleServerIPChange:d,onHandleServerPortChange:g,onHandleServerProtocolChange:L,onHandleServerRandomPathChange:O,onHandleServerRandomPathBlur:K,onHandleServerUsernameChange:oe,onHandleServerPasswordChange:J,onHandleServerInboundIdChange:he,onHandleServerLocationChange:xe,onHandleServerActiveChange:Ke,onHandleServerTariffChange:Ye,onHandleTariffNameChange:Ze,onHandleTariffPlanChange:Qe,onHandleTariffPriceChange:es,onHandleTariffDevicesChange:ss,onHandleTariffTrafficGBChange:ts,onHandleTariffDurationDaysChange:as,onHandleTariffActiveChange:ns})=>{const[te,we]=c.useState(null);c.useEffect(()=>{if(te){const b=r.find(H=>H.id===te.id);b&&JSON.stringify(te)!==JSON.stringify(b)&&(console.log("üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ selectedUser –≤ –∫–∞—Ä—Ç–æ—á–∫–µ:",{old:te,new:b}),we(b))}},[r,te?.id]);const rs=c.useCallback(b=>{we(b)},[]),is=c.useCallback(()=>{we(null)},[]),ls=c.useCallback(b=>{const H=b.target.value;l(G=>G?{...G,role:H}:null)},[l]),os=c.useCallback(b=>{const H=b.target.value;l(G=>G?{...G,plan:H}:null)},[l]),ds=c.useCallback(b=>{const H=Number(b.target.value)||1;l(G=>G?{...G,devices:H}:null)},[l]),cs=c.useCallback(b=>{const H=b.target.value?new Date(b.target.value).getTime():null;l(G=>G?{...G,expiresAt:H}:null)},[l]),ms=[{id:"users",label:"–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏",icon:Me},{id:"settings",label:"–ù–∞—Å—Ç—Ä–æ–π–∫–∏",icon:de},{id:"tariffs",label:"–¢–∞—Ä–∏—Ñ—ã –∏ —Ü–µ–Ω—ã",icon:Es},{id:"n8n",label:"n8n",icon:Ee}],[us,je]=c.useState(!1);return e.jsxs("div",{className:"min-h-screen bg-slate-950 flex flex-col lg:flex-row lg:h-screen lg:overflow-hidden",children:[e.jsx(rt,{currentUser:a,view:"admin",onSetView:n,onLogout:i}),e.jsx("div",{className:"flex-1 w-full min-w-0 p-3 sm:p-4 md:p-6 lg:pl-0 pt-14 sm:pt-16 lg:pt-4 lg:pt-6 lg:overflow-y-auto",children:e.jsxs("div",{className:"w-full max-w-[90rem] mx-auto",children:[e.jsx("div",{className:"bg-slate-900 rounded-lg sm:rounded-xl shadow-xl section-spacing-sm mb-[clamp(1rem,0.8rem+1vw,2rem)] border border-slate-800",children:e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3 sm:gap-4",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("h1",{className:"text-[clamp(1.25rem,1.1rem+0.75vw,1.875rem)] font-bold text-slate-200 flex items-center gap-2",children:[e.jsx(Ds,{className:"w-5 h-5 sm:w-6 sm:h-6 flex-shrink-0"}),e.jsx("span",{className:"truncate",children:"–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å"})]}),e.jsx("p",{className:"text-[clamp(0.875rem,0.8rem+0.375vw,1rem)] text-slate-400 mt-1",children:"–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º–æ–π"})]}),e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 md:gap-4 w-full sm:w-auto",children:[e.jsxs("button",{onClick:()=>je(!0),className:"btn-icon-only-mobile min-h-[44px] px-3 sm:px-4 py-2.5 sm:py-3 bg-purple-600 hover:bg-purple-700 active:bg-purple-800 text-white rounded-lg sm:rounded-xl transition-all flex items-center justify-center gap-2 text-sm sm:text-base flex-1 sm:flex-initial touch-manipulation",title:"–û—Ç–∫—Ä—ã—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–µ—Ä–≤–µ—Ä–∞","aria-label":"–û—Ç–∫—Ä—ã—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥",children:[e.jsx(Fe,{className:"w-4 h-4 sm:w-5 sm:h-5 flex-shrink-0"}),e.jsx("span",{className:"btn-text whitespace-nowrap",children:"–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥"})]}),e.jsxs("button",{onClick:()=>D(!0),className:"btn-icon-only-mobile min-h-[44px] px-3 sm:px-4 py-2.5 sm:py-3 bg-slate-700 hover:bg-slate-600 active:bg-slate-500 text-white rounded-lg sm:rounded-xl transition-all flex items-center justify-center gap-2 text-sm sm:text-base flex-1 sm:flex-initial touch-manipulation",title:"–û—Ç–∫—Ä—ã—Ç—å –ª–æ–≥–∏","aria-label":"–û—Ç–∫—Ä—ã—Ç—å –ª–æ–≥–∏",children:[e.jsx(Ce,{className:"w-4 h-4 sm:w-5 sm:h-5 flex-shrink-0"}),e.jsx("span",{className:"btn-text whitespace-nowrap",children:"–õ–æ–≥–∏"})]})]})]})}),e.jsx("div",{className:"bg-slate-900 rounded-lg sm:rounded-xl shadow-xl border border-slate-800 mb-[clamp(1rem,0.8rem+1vw,2rem)] overflow-hidden",children:e.jsx("div",{className:"flex border-b border-slate-800 overflow-x-auto scrollbar-hide -mx-1 sm:mx-0",children:ms.map(b=>{const H=b.icon;return e.jsxs("button",{onClick:()=>t(b.id),className:`min-h-[44px] flex items-center justify-center gap-1.5 sm:gap-2 px-3 sm:px-4 md:px-6 py-3 sm:py-3.5 md:py-4 font-medium transition-all whitespace-nowrap flex-shrink-0 min-w-fit touch-manipulation ${s===b.id?"text-blue-400 border-b-2 border-blue-400 bg-slate-800/50":"text-slate-400 hover:text-slate-200 active:text-slate-200 hover:bg-slate-800/30 active:bg-slate-800/50"}`,"aria-label":b.label,"aria-selected":s===b.id,children:[e.jsx(H,{className:"w-4 h-4 sm:w-5 sm:h-5 flex-shrink-0"}),e.jsx("span",{className:"text-[clamp(0.875rem,0.8rem+0.375vw,1rem)] sm:text-base",children:b.label})]},b.id)})})}),s==="users"&&e.jsxs(e.Fragment,{children:[e.jsx(it,{users:r,editingUser:u,onSetEditingUser:l,onHandleUpdateUser:f,onHandleDeleteUser:N,onHandleCopy:j,currentUser:a,formatDate:U,handleUserRoleChange:ls,handleUserPlanChange:os,handleUserDevicesChange:ds,handleUserExpiresAtChange:cs,onUserRowClick:rs}),te&&e.jsx(Je,{user:te,onClose:is,onCopy:j,tariffs:E,formatDate:U})]}),s==="settings"&&e.jsx("div",{className:"space-y-[clamp(1rem,0.8rem+1vw,2rem)]",children:e.jsxs("div",{className:"bg-slate-900 rounded-lg sm:rounded-xl shadow-xl border border-slate-800 section-spacing-sm",children:[e.jsxs("div",{className:"mb-4 sm:mb-5 md:mb-6 flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3 sm:gap-4",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("h2",{className:"text-[clamp(1.125rem,1rem+0.625vw,1.5rem)] font-bold text-slate-200 mb-1.5 sm:mb-2 flex items-center gap-2",children:[e.jsx(de,{className:"w-5 h-5 sm:w-6 sm:h-6 flex-shrink-0"}),e.jsx("span",{className:"truncate",children:"–°–µ—Ä–≤–µ—Ä—ã 3x-ui"})]}),e.jsx("p",{className:"text-[clamp(0.875rem,0.8rem+0.375vw,1rem)] text-slate-400",children:"–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Ä–≤–µ—Ä–∞–º–∏ –¥–ª—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å –ø–∞–Ω–µ–ª—è–º–∏ 3x-ui"})]}),e.jsxs("button",{onClick:S,className:"btn-icon-only-mobile min-h-[44px] w-full sm:w-auto px-4 sm:px-5 py-2.5 sm:py-3 bg-blue-600 hover:bg-blue-700 active:bg-blue-800 text-white rounded-lg sm:rounded-xl transition-all flex items-center justify-center gap-2 text-sm sm:text-base touch-manipulation","aria-label":"–î–æ–±–∞–≤–∏—Ç—å —Å–µ—Ä–≤–µ—Ä",children:[e.jsx(Rs,{className:"w-4 h-4 sm:w-5 sm:h-5 flex-shrink-0"}),e.jsx("span",{className:"btn-text whitespace-nowrap",children:"–î–æ–±–∞–≤–∏—Ç—å —Å–µ—Ä–≤–µ—Ä"})]})]}),I?e.jsx("div",{className:"flex items-center justify-center py-8 sm:py-10 md:py-12",children:e.jsx("div",{className:"w-7 h-7 sm:w-8 sm:h-8 border-2 border-slate-600 border-t-blue-600 rounded-full animate-spin"})}):e.jsxs("div",{className:"space-y-3 sm:space-y-4",children:[m&&e.jsxs("form",{onSubmit:b=>{b.preventDefault(),P()},className:"p-4 sm:p-5 md:p-6 bg-slate-800 rounded-lg sm:rounded-xl border border-slate-700",children:[e.jsx("h3",{className:"text-[clamp(1rem,0.95rem+0.25vw,1.125rem)] sm:text-lg font-semibold text-slate-200 mb-3 sm:mb-4",children:m.id&&y.find(b=>b.id===m.id)?"–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–µ—Ä–≤–µ—Ä–∞":"–ù–æ–≤—ã–π —Å–µ—Ä–≤–µ—Ä"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:`server-${m.id||"new"}-name`,className:"block text-slate-300 text-[clamp(0.875rem,0.8rem+0.375vw,1rem)] font-medium mb-1.5 sm:mb-2",children:"–ù–∞–∑–≤–∞–Ω–∏–µ —Å–µ—Ä–≤–µ—Ä–∞ *"}),e.jsx("input",{id:`server-${m.id||"new"}-name`,name:"server-name",type:"text",value:m.name||"",onChange:q,className:"w-full min-h-[44px] px-3 sm:px-4 py-2.5 sm:py-3 bg-slate-900 border border-slate-700 rounded-lg sm:rounded-xl text-slate-200 text-base focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all touch-manipulation",placeholder:"NL Server 1"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:`server-${m.id||"new"}-ip`,className:"block text-slate-300 text-sm font-medium mb-2",children:"IP –∞–¥—Ä–µ—Å / –î–æ–º–µ–Ω *"}),e.jsx("input",{id:`server-${m.id||"new"}-ip`,name:"server-ip",type:"text",value:m.serverIP||"",onChange:d,className:"w-full min-h-[44px] px-3 sm:px-4 py-2.5 sm:py-3 bg-slate-900 border border-slate-700 rounded-lg sm:rounded-xl text-slate-200 text-base focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all touch-manipulation",placeholder:"localhost –∏–ª–∏ your-server.com"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:`server-${m.id||"new"}-port`,className:"block text-slate-300 text-sm font-medium mb-2",children:"–ü–æ—Ä—Ç *"}),e.jsx("input",{id:`server-${m.id||"new"}-port`,name:"server-port",type:"number",min:"1",max:"65535",value:m.serverPort||2053,onChange:g,className:"w-full min-h-[44px] px-3 sm:px-4 py-2.5 sm:py-3 bg-slate-900 border border-slate-700 rounded-lg sm:rounded-xl text-slate-200 text-base focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all touch-manipulation",placeholder:"2053"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:`server-${m.id||"new"}-protocol`,className:"block text-slate-300 text-sm font-medium mb-2",children:"–ü—Ä–æ—Ç–æ–∫–æ–ª *"}),e.jsxs("select",{id:`server-${m.id||"new"}-protocol`,name:"server-protocol",value:m.protocol||(m.serverPort===443||m.serverPort===40919?"https":"http"),onChange:L,className:"w-full min-h-[44px] px-3 sm:px-4 py-2.5 sm:py-3 bg-slate-900 border border-slate-700 rounded-lg sm:rounded-xl text-slate-200 text-base focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all touch-manipulation",children:[e.jsx("option",{value:"http",children:"HTTP"}),e.jsx("option",{value:"https",children:"HTTPS"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:`server-${m.id||"new"}-path`,className:"block text-slate-300 text-sm font-medium mb-2",children:"Random Path"}),e.jsx("input",{id:`server-${m.id||"new"}-path`,name:"server-path",type:"text",value:m.randompath||"",onChange:O,onBlur:K,className:"w-full px-4 py-2 bg-slate-900 border border-slate-700 rounded text-slate-200 focus:outline-none focus:ring-2 focus:ring-blue-500 font-mono text-sm",placeholder:"/Gxckr4KcZGtB6aOZdw"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:`server-${m.id||"new"}-username`,className:"block text-slate-300 text-sm font-medium mb-2",children:"Username *"}),e.jsx("input",{id:`server-${m.id||"new"}-username`,name:"server-username",type:"text",value:m.xuiUsername||"",onChange:oe,autoComplete:"username",className:"w-full min-h-[44px] px-3 sm:px-4 py-2.5 sm:py-3 bg-slate-900 border border-slate-700 rounded-lg sm:rounded-xl text-slate-200 text-base focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all touch-manipulation",placeholder:"admin"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:`server-${m.id||"new"}-password`,className:"block text-slate-300 text-sm font-medium mb-2",children:"Password *"}),e.jsx("input",{id:`server-${m.id||"new"}-password`,name:"server-password",type:"password",value:m.xuiPassword||"",onChange:J,autoComplete:"new-password",className:"w-full min-h-[44px] px-3 sm:px-4 py-2.5 sm:py-3 bg-slate-900 border border-slate-700 rounded-lg sm:rounded-xl text-slate-200 text-base focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all touch-manipulation",placeholder:"‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:`server-${m.id||"new"}-inbound`,className:"block text-slate-300 text-sm font-medium mb-2",children:"Inbound ID *"}),e.jsx("input",{id:`server-${m.id||"new"}-inbound`,name:"server-inbound",type:"text",value:m.xuiInboundId||"",onChange:he,className:"w-full min-h-[44px] px-3 sm:px-4 py-2.5 sm:py-3 bg-slate-900 border border-slate-700 rounded-lg sm:rounded-xl text-slate-200 text-base focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all touch-manipulation",placeholder:"1"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:`server-${m.id||"new"}-location`,className:"block text-slate-300 text-sm font-medium mb-2",children:"–õ–æ–∫–∞—Ü–∏—è"}),e.jsx("input",{id:`server-${m.id||"new"}-location`,name:"server-location",type:"text",value:m.location||"",onChange:xe,className:"w-full min-h-[44px] px-3 sm:px-4 py-2.5 sm:py-3 bg-slate-900 border border-slate-700 rounded-lg sm:rounded-xl text-slate-200 text-base focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all touch-manipulation",placeholder:"NL, US, RU –∏ —Ç.–¥."})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("div",{className:"block text-slate-300 text-sm font-medium mb-2",children:"–ü—Ä–∏–≤—è–∑–∫–∞ –∫ —Ç–∞—Ä–∏—Ñ–∞–º"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:E.map(b=>e.jsxs("label",{htmlFor:`server-${m.id||"new"}-tariff-${b.id}`,className:"flex items-center gap-2 px-3 py-2 bg-slate-900 border border-slate-700 rounded cursor-pointer hover:bg-slate-800",children:[e.jsx("input",{id:`server-${m.id||"new"}-tariff-${b.id}`,name:`server-tariff-${b.id}`,type:"checkbox",checked:(m.tariffIds||[]).includes(b.id),onChange:H=>Ye(b.id,H.target.checked),className:"w-4 h-4 text-blue-600 bg-slate-900 border-slate-700 rounded focus:ring-blue-500"}),e.jsx("span",{className:"text-slate-300 text-sm",children:b.name})]},b.id))})]}),e.jsx("div",{className:"md:col-span-2",children:e.jsxs("label",{htmlFor:`server-${m.id||"new"}-active`,className:"flex items-center gap-2",children:[e.jsx("input",{id:`server-${m.id||"new"}-active`,name:"server-active",type:"checkbox",checked:m.active!==!1,onChange:Ke,className:"w-4 h-4 text-blue-600 bg-slate-900 border-slate-700 rounded focus:ring-blue-500"}),e.jsx("span",{className:"text-slate-300 text-sm",children:"–ê–∫—Ç–∏–≤–µ–Ω"})]})})]}),e.jsxs("div",{className:"flex flex-col-reverse sm:flex-row justify-end gap-2 sm:gap-3 mt-4 sm:mt-5 md:mt-6",children:[e.jsxs("button",{type:"button",onClick:()=>{k.current=null,T(null)},className:"btn-icon-only-mobile min-h-[44px] w-full sm:w-auto px-4 sm:px-5 py-2.5 sm:py-3 bg-slate-600 hover:bg-slate-700 active:bg-slate-800 text-white rounded-lg sm:rounded-xl transition-all flex items-center justify-center gap-2 text-sm sm:text-base touch-manipulation","aria-label":"–û—Ç–º–µ–Ω–∞",children:[e.jsx(ne,{className:"w-4 h-4 sm:w-5 sm:h-5 flex-shrink-0"}),e.jsx("span",{className:"btn-text",children:"–û—Ç–º–µ–Ω–∞"})]}),e.jsxs("button",{type:"submit",className:"btn-icon-only-mobile min-h-[44px] w-full sm:w-auto px-4 sm:px-5 py-2.5 sm:py-3 bg-green-600 hover:bg-green-700 active:bg-green-800 text-white rounded-lg sm:rounded-xl transition-all flex items-center justify-center gap-2 text-sm sm:text-base touch-manipulation","aria-label":"–°–æ—Ö—Ä–∞–Ω–∏—Ç—å",children:[e.jsx(re,{className:"w-4 h-4 sm:w-5 sm:h-5 flex-shrink-0"}),e.jsx("span",{className:"btn-text",children:"–°–æ—Ö—Ä–∞–Ω–∏—Ç—å"})]})]})]}),y.length===0?e.jsxs("div",{className:"text-center py-8 sm:py-10 md:py-12 text-slate-400",children:[e.jsx(de,{className:"w-10 h-10 sm:w-12 sm:h-12 mx-auto mb-3 sm:mb-4 opacity-50"}),e.jsx("p",{className:"text-[clamp(0.875rem,0.8rem+0.375vw,1rem)]",children:"–°–µ—Ä–≤–µ—Ä—ã –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω—ã"}),e.jsx("p",{className:"text-[clamp(0.75rem,0.7rem+0.25vw,0.875rem)] mt-2",children:'–ù–∞–∂–º–∏—Ç–µ "–î–æ–±–∞–≤–∏—Ç—å —Å–µ—Ä–≤–µ—Ä" –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è'})]}):e.jsx("div",{className:"space-y-3 sm:space-y-4",children:y.map(b=>{const H=h===b.id,ye=`${b.serverPort===443?"https":"http"}://${b.serverIP}:${b.serverPort}${b.randompath||""}`;return e.jsx("div",{className:"p-4 sm:p-5 bg-slate-800 rounded-lg sm:rounded-xl border border-slate-700",children:e.jsxs("div",{className:"flex flex-col lg:flex-row items-start lg:items-start justify-between gap-3 sm:gap-4",children:[e.jsxs("div",{className:"flex-1 min-w-0 w-full",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2 sm:gap-3 mb-2 sm:mb-3",children:[e.jsx("h4",{className:"text-[clamp(1rem,0.95rem+0.25vw,1.125rem)] sm:text-lg font-semibold text-slate-200 truncate",children:b.name}),b.active?e.jsx("span",{className:"px-2 py-1 bg-green-900/30 text-green-400 rounded text-xs font-medium",children:"–ê–∫—Ç–∏–≤–µ–Ω"}):e.jsx("span",{className:"px-2 py-1 bg-slate-700 text-slate-400 rounded text-xs font-medium",children:"–ù–µ–∞–∫—Ç–∏–≤–µ–Ω"}),b.sessionTested&&e.jsxs("span",{className:`px-2 py-1 rounded text-xs font-medium flex items-center gap-1 ${b.sessionError?"bg-red-900/30 text-red-400":"bg-green-900/30 text-green-400"}`,children:[b.sessionError?e.jsx(ve,{className:"w-3 h-3"}):e.jsx(le,{className:"w-3 h-3"}),b.sessionError?"–û—à–∏–±–∫–∞ —Å–µ—Å—Å–∏–∏":"–°–µ—Å—Å–∏—è OK"]}),b.location&&e.jsx("span",{className:"px-2 py-1 bg-blue-900/30 text-blue-400 rounded text-xs font-medium",children:b.location})]}),e.jsxs("div",{className:"space-y-1.5 sm:space-y-2 text-[clamp(0.875rem,0.8rem+0.375vw,1rem)] text-slate-400 break-words",children:[e.jsxs("p",{className:"break-all",children:[e.jsx("strong",{className:"text-slate-300",children:"URL:"})," ",e.jsx("code",{className:"font-mono text-xs sm:text-sm break-all",children:ye})]}),e.jsxs("p",{children:[e.jsx("strong",{className:"text-slate-300",children:"Inbound ID:"})," ",b.xuiInboundId||"‚Äî"]}),b.tariffIds&&b.tariffIds.length>0&&e.jsxs("p",{children:[e.jsx("strong",{className:"text-slate-300",children:"–¢–∞—Ä–∏—Ñ—ã:"})," ",b.tariffIds.map(Z=>{const Re=E.find(hs=>hs.id===Z);return Re?Re.name:Z}).join(", ")]}),b.sessionTestedAt&&e.jsxs("p",{className:"text-xs text-slate-500",children:["–ü–æ—Å–ª–µ–¥–Ω–∏–π —Ç–µ—Å—Ç: ",U(b.sessionTestedAt)]})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-stretch sm:items-center gap-2 w-full lg:w-auto lg:flex-shrink-0",children:[e.jsx("button",{onClick:()=>v(b),disabled:H,className:"btn-icon-only-mobile min-h-[44px] px-3 sm:px-4 py-2.5 sm:py-3 bg-blue-600 hover:bg-blue-700 active:bg-blue-800 disabled:bg-slate-700 disabled:cursor-not-allowed text-white rounded-lg sm:rounded-xl text-sm sm:text-base transition-all flex items-center justify-center gap-2 touch-manipulation flex-1 sm:flex-initial",title:"–ü–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ —Å–µ—Å—Å–∏–∏ –∏ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å cookies","aria-label":"–ü–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ —Å–µ—Å—Å–∏–∏",children:H?e.jsxs(e.Fragment,{children:[e.jsx(ke,{className:"w-4 h-4 sm:w-5 sm:h-5 animate-spin flex-shrink-0"}),e.jsx("span",{className:"btn-text whitespace-nowrap",children:"–ü–æ–ª—É—á–µ–Ω–∏–µ..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(Ps,{className:"w-4 h-4 sm:w-5 sm:h-5 flex-shrink-0"}),e.jsx("span",{className:"btn-text whitespace-nowrap",children:"–ü–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ"})]})}),e.jsxs("button",{onClick:()=>{const Z={...b};console.log("üîç –û—Ç–∫—Ä—ã—Ç–∏–µ —Ñ–æ—Ä–º—ã —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Å–µ—Ä–≤–µ—Ä–∞",{serverId:Z.id,serverName:Z.name,protocol:Z.protocol,serverPort:Z.serverPort,allFields:Z}),T(Z)},className:"btn-icon-only-mobile min-h-[44px] px-3 sm:px-4 py-2.5 sm:py-3 bg-slate-600 hover:bg-slate-700 active:bg-slate-800 text-white rounded-lg sm:rounded-xl text-sm sm:text-base transition-all flex items-center justify-center gap-1.5 sm:gap-2 touch-manipulation flex-1 sm:flex-initial","aria-label":"–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–µ—Ä–≤–µ—Ä",children:[e.jsx(fe,{className:"w-4 h-4 sm:w-5 sm:h-5 flex-shrink-0"}),e.jsx("span",{className:"btn-text whitespace-nowrap",children:"–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å"})]}),e.jsxs("button",{onClick:()=>C(b.id),className:"btn-icon-only-mobile min-h-[44px] px-3 sm:px-4 py-2.5 sm:py-3 bg-red-600 hover:bg-red-700 active:bg-red-800 text-white rounded-lg sm:rounded-xl text-sm sm:text-base transition-all flex items-center justify-center gap-1.5 sm:gap-2 touch-manipulation flex-1 sm:flex-initial","aria-label":"–£–¥–∞–ª–∏—Ç—å —Å–µ—Ä–≤–µ—Ä",children:[e.jsx(ae,{className:"w-4 h-4 sm:w-5 sm:h-5 flex-shrink-0"}),e.jsx("span",{className:"btn-text whitespace-nowrap",children:"–£–¥–∞–ª–∏—Ç—å"})]})]})]})},b.id)})})]}),e.jsx("div",{className:"flex justify-end pt-3 sm:pt-4 border-t border-slate-800 mt-4 sm:mt-5 md:mt-6",children:e.jsxs("button",{onClick:_,className:"btn-icon-only-mobile min-h-[44px] w-full sm:w-auto px-5 sm:px-6 py-2.5 sm:py-3 bg-blue-600 hover:bg-blue-700 active:bg-blue-800 text-white rounded-lg sm:rounded-xl transition-all flex items-center justify-center gap-2 text-sm sm:text-base touch-manipulation","aria-label":"–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤—Å–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏",children:[e.jsx(re,{className:"w-4 h-4 sm:w-5 sm:h-5 flex-shrink-0"}),e.jsx("span",{className:"btn-text whitespace-nowrap",children:"–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤—Å–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏"})]})})]})}),s==="tariffs"&&e.jsxs("div",{className:"bg-slate-900 rounded-lg sm:rounded-xl shadow-xl border border-slate-800 section-spacing-sm",children:[e.jsx("div",{className:"mb-4 sm:mb-5 md:mb-6",children:e.jsxs("div",{children:[e.jsx("h2",{className:"text-[clamp(1.125rem,1rem+0.625vw,1.5rem)] font-bold text-slate-200 mb-1.5 sm:mb-2",children:"–¢–∞—Ä–∏—Ñ—ã –∏ —Ü–µ–Ω—ã"}),e.jsx("p",{className:"text-[clamp(0.875rem,0.8rem+0.375vw,1rem)] text-slate-400",children:"–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–∞—Ä–∏—Ñ–Ω—ã–º–∏ –ø–ª–∞–Ω–∞–º–∏ SUPER –∏ MULTI"})]})}),w&&e.jsxs("div",{className:"mb-4 sm:mb-5 md:mb-6 p-4 sm:p-5 md:p-6 bg-slate-800 rounded-lg sm:rounded-xl border border-slate-700",children:[e.jsx("h3",{className:"text-[clamp(1rem,0.95rem+0.25vw,1.125rem)] sm:text-lg font-semibold text-slate-200 mb-3 sm:mb-4",children:w.id&&!w.id.startsWith("default-")?"–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–∞—Ä–∏—Ñ–∞":"–ù–æ–≤—ã–π —Ç–∞—Ä–∏—Ñ"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:`tariff-${w.id||"new"}-name`,className:"block text-slate-300 text-[clamp(0.875rem,0.8rem+0.375vw,1rem)] font-medium mb-1.5 sm:mb-2",children:"–ù–∞–∑–≤–∞–Ω–∏–µ"}),e.jsx("input",{id:`tariff-${w.id||"new"}-name`,name:"tariff-name",type:"text",value:w.name||"",onChange:Ze,className:"w-full min-h-[44px] px-3 sm:px-4 py-2.5 sm:py-3 bg-slate-900 border border-slate-700 rounded-lg sm:rounded-xl text-slate-200 text-base focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all touch-manipulation",placeholder:"–ü—Ä–µ–º–∏—É–º"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:`tariff-${w.id||"new"}-plan`,className:"block text-slate-300 text-sm font-medium mb-2",children:"–ü–ª–∞–Ω (ID)"}),e.jsx("input",{id:`tariff-${w.id||"new"}-plan`,name:"tariff-plan",type:"text",value:w.plan||"",onChange:Qe,className:"w-full px-4 py-2 bg-slate-900 border border-slate-700 rounded text-slate-200 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"premium"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:`tariff-${w.id||"new"}-price`,className:"block text-slate-300 text-sm font-medium mb-2",children:"–¶–µ–Ω–∞ (—Ä—É–±.)"}),e.jsx("input",{id:`tariff-${w.id||"new"}-price`,name:"tariff-price",type:"number",min:"0",value:w.price||0,onChange:es,className:"w-full px-4 py-2 bg-slate-900 border border-slate-700 rounded text-slate-200 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"500"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:`tariff-${w.id||"new"}-devices`,className:"block text-slate-300 text-sm font-medium mb-2",children:"–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤"}),e.jsx("input",{id:`tariff-${w.id||"new"}-devices`,name:"tariff-devices",type:"number",min:"1",value:w.devices||1,onChange:ss,className:"w-full px-4 py-2 bg-slate-900 border border-slate-700 rounded text-slate-200 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"5"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:`tariff-${w.id||"new"}-traffic-gb`,className:"block text-slate-300 text-sm font-medium mb-2",children:"–¢—Ä–∞—Ñ–∏–∫ (GB, 0 = –±–µ–∑–ª–∏–º–∏—Ç)"}),e.jsx("input",{id:`tariff-${w.id||"new"}-traffic-gb`,name:"tariff-traffic-gb",type:"number",min:"0",value:w.trafficGB||0,onChange:ts,className:"w-full px-4 py-2 bg-slate-900 border border-slate-700 rounded text-slate-200 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"0"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:`tariff-${w.id||"new"}-duration-days`,className:"block text-slate-300 text-sm font-medium mb-2",children:"–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å (–¥–Ω–µ–π)"}),e.jsx("input",{id:`tariff-${w.id||"new"}-duration-days`,name:"tariff-duration-days",type:"number",min:"1",value:w.durationDays||30,onChange:as,className:"w-full px-4 py-2 bg-slate-900 border border-slate-700 rounded text-slate-200 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"30"})]}),e.jsx("div",{className:"md:col-span-2",children:e.jsxs("label",{htmlFor:`tariff-${w.id||"new"}-active`,className:"flex items-center gap-2",children:[e.jsx("input",{id:`tariff-${w.id||"new"}-active`,name:"tariff-active",type:"checkbox",checked:w.active!==!1,onChange:ns,className:"w-4 h-4 text-blue-600 bg-slate-900 border-slate-700 rounded focus:ring-blue-500"}),e.jsx("span",{className:"text-slate-300 text-sm",children:"–ê–∫—Ç–∏–≤–µ–Ω"})]})})]}),e.jsxs("div",{className:"flex flex-col-reverse sm:flex-row justify-end gap-2 sm:gap-3 mt-4 sm:mt-5",children:[e.jsxs("button",{onClick:()=>R(null),className:"btn-icon-only-mobile min-h-[44px] w-full sm:w-auto px-4 sm:px-5 py-2.5 sm:py-3 bg-slate-600 hover:bg-slate-700 active:bg-slate-800 text-white rounded-lg sm:rounded-xl transition-all flex items-center justify-center gap-2 text-sm sm:text-base touch-manipulation","aria-label":"–û—Ç–º–µ–Ω–∞",children:[e.jsx(ne,{className:"w-4 h-4 sm:w-5 sm:h-5 flex-shrink-0"}),e.jsx("span",{className:"btn-text",children:"–û—Ç–º–µ–Ω–∞"})]}),e.jsxs("button",{onClick:()=>X(w),className:"btn-icon-only-mobile min-h-[44px] w-full sm:w-auto px-4 sm:px-5 py-2.5 sm:py-3 bg-green-600 hover:bg-green-700 active:bg-green-800 text-white rounded-lg sm:rounded-xl transition-all flex items-center justify-center gap-2 text-sm sm:text-base touch-manipulation","aria-label":"–°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ç–∞—Ä–∏—Ñ",children:[e.jsx(re,{className:"w-4 h-4 sm:w-5 sm:h-5 flex-shrink-0"}),e.jsx("span",{className:"btn-text",children:"–°–æ—Ö—Ä–∞–Ω–∏—Ç—å"})]})]})]}),e.jsx("div",{className:"overflow-x-auto -mx-2 sm:mx-0 md:hidden",children:e.jsx("div",{className:"space-y-3 px-2",children:E.map(b=>e.jsx("div",{className:"bg-slate-800 rounded-lg p-4 border border-slate-700",children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-xs font-medium text-slate-400 uppercase",children:"–ù–∞–∑–≤–∞–Ω–∏–µ"}),e.jsx("p",{className:"text-slate-200 font-semibold mt-0.5",children:b.name})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs font-medium text-slate-400 uppercase",children:"–ü–ª–∞–Ω"}),e.jsx("p",{className:"text-slate-400 font-mono text-sm mt-0.5",children:b.plan})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs font-medium text-slate-400 uppercase",children:"–¶–µ–Ω–∞"}),e.jsxs("p",{className:"text-slate-200 mt-0.5",children:[b.price," ‚ÇΩ"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs font-medium text-slate-400 uppercase",children:"–£—Å—Ç—Ä–æ–π—Å—Ç–≤–∞"}),e.jsx("p",{className:"text-slate-200 mt-0.5",children:b.devices})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs font-medium text-slate-400 uppercase",children:"–¢—Ä–∞—Ñ–∏–∫"}),e.jsx("p",{className:"text-slate-200 mt-0.5",children:b.trafficGB===0?"–ë–µ–∑–ª–∏–º–∏—Ç":`${b.trafficGB} GB`})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs font-medium text-slate-400 uppercase",children:"–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å"}),e.jsxs("p",{className:"text-slate-200 mt-0.5",children:[b.durationDays," –¥–Ω."]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs font-medium text-slate-400 uppercase",children:"–°—Ç–∞—Ç—É—Å"}),e.jsx("div",{className:"mt-0.5",children:e.jsx("span",{className:`px-2 py-1 rounded text-xs font-medium ${b.active?"bg-green-900/30 text-green-400":"bg-slate-700 text-slate-400"}`,children:b.active?"–ê–∫—Ç–∏–≤–µ–Ω":"–ù–µ–∞–∫—Ç–∏–≤–µ–Ω"})})]}),e.jsxs("div",{className:"flex items-center gap-2 pt-2 border-t border-slate-700",children:[e.jsxs("button",{onClick:()=>R({...b}),className:"btn-icon-only-mobile min-h-[44px] min-w-[44px] flex-1 sm:flex-initial px-3 py-2 bg-blue-600 hover:bg-blue-700 active:bg-blue-800 text-white rounded-lg text-sm transition-all flex items-center justify-center gap-1.5 touch-manipulation","aria-label":"–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Ç–∞—Ä–∏—Ñ",children:[e.jsx(fe,{className:"w-4 h-4 flex-shrink-0"}),e.jsx("span",{className:"btn-text",children:"–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å"})]}),(()=>{const H=b.plan?.toLowerCase(),G=b.name?.toLowerCase();return!(H==="super"||H==="multi"||G==="super"||G==="multi")&&!b.id?.startsWith("default-")?e.jsxs("button",{onClick:()=>p(b.id),className:"btn-icon-only-mobile min-h-[44px] min-w-[44px] flex-1 sm:flex-initial px-3 py-2 bg-red-600 hover:bg-red-700 active:bg-red-800 text-white rounded-lg text-sm transition-all flex items-center justify-center gap-1.5 touch-manipulation","aria-label":"–£–¥–∞–ª–∏—Ç—å —Ç–∞—Ä–∏—Ñ",children:[e.jsx(ae,{className:"w-4 h-4 flex-shrink-0"}),e.jsx("span",{className:"btn-text",children:"–£–¥–∞–ª–∏—Ç—å"})]}):null})()]})]})},b.id))})}),e.jsx("div",{className:"hidden md:block overflow-x-auto -mx-2 sm:mx-0",children:e.jsx("div",{className:"inline-block min-w-full align-middle",children:e.jsxs("table",{className:"min-w-full divide-y divide-slate-800",children:[e.jsx("thead",{className:"bg-slate-800",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-3 sm:px-6 py-3 text-left text-xs font-medium text-slate-300 uppercase tracking-wider",children:"–ù–∞–∑–≤–∞–Ω–∏–µ"}),e.jsx("th",{className:"px-3 sm:px-6 py-3 text-left text-xs font-medium text-slate-300 uppercase tracking-wider",children:"–ü–ª–∞–Ω"}),e.jsx("th",{className:"px-3 sm:px-6 py-3 text-left text-xs font-medium text-slate-300 uppercase tracking-wider",children:"–¶–µ–Ω–∞"}),e.jsx("th",{className:"px-3 sm:px-6 py-3 text-left text-xs font-medium text-slate-300 uppercase tracking-wider",children:"–£—Å—Ç—Ä–æ–π—Å—Ç–≤–∞"}),e.jsx("th",{className:"px-3 sm:px-6 py-3 text-left text-xs font-medium text-slate-300 uppercase tracking-wider",children:"–¢—Ä–∞—Ñ–∏–∫"}),e.jsx("th",{className:"px-3 sm:px-6 py-3 text-left text-xs font-medium text-slate-300 uppercase tracking-wider",children:"–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å"}),e.jsx("th",{className:"px-3 sm:px-6 py-3 text-left text-xs font-medium text-slate-300 uppercase tracking-wider",children:"–°—Ç–∞—Ç—É—Å"}),e.jsx("th",{className:"px-3 sm:px-6 py-3 text-left text-xs font-medium text-slate-300 uppercase tracking-wider",children:"–î–µ–π—Å—Ç–≤–∏—è"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-800",children:E.map(b=>e.jsxs("tr",{className:"hover:bg-slate-800/50 transition-colors",children:[e.jsx("td",{className:"px-3 sm:px-6 py-4 whitespace-nowrap text-slate-200",children:b.name}),e.jsx("td",{className:"px-3 sm:px-6 py-4 whitespace-nowrap text-slate-400 font-mono text-sm",children:b.plan}),e.jsxs("td",{className:"px-3 sm:px-6 py-4 whitespace-nowrap text-slate-200",children:[b.price," ‚ÇΩ"]}),e.jsx("td",{className:"px-3 sm:px-6 py-4 whitespace-nowrap text-slate-200",children:b.devices}),e.jsx("td",{className:"px-3 sm:px-6 py-4 whitespace-nowrap text-slate-200",children:b.trafficGB===0?"–ë–µ–∑–ª–∏–º–∏—Ç":`${b.trafficGB} GB`}),e.jsxs("td",{className:"px-3 sm:px-6 py-4 whitespace-nowrap text-slate-200",children:[b.durationDays," –¥–Ω."]}),e.jsx("td",{className:"px-3 sm:px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`px-2 py-1 rounded text-xs font-medium ${b.active?"bg-green-900/30 text-green-400":"bg-slate-700 text-slate-400"}`,children:b.active?"–ê–∫—Ç–∏–≤–µ–Ω":"–ù–µ–∞–∫—Ç–∏–≤–µ–Ω"})}),e.jsx("td",{className:"px-3 sm:px-6 py-3 sm:py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center gap-1.5 sm:gap-2 flex-wrap",children:[e.jsxs("button",{onClick:()=>R({...b}),className:"min-h-[44px] px-3 py-2 bg-blue-600 hover:bg-blue-700 active:bg-blue-800 text-white rounded-lg text-sm transition-all flex items-center justify-center gap-1.5 touch-manipulation","aria-label":"–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Ç–∞—Ä–∏—Ñ",children:[e.jsx(fe,{className:"w-4 h-4 flex-shrink-0"}),e.jsx("span",{children:"–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å"})]}),(()=>{const H=b.plan?.toLowerCase(),G=b.name?.toLowerCase();return!(H==="super"||H==="multi"||G==="super"||G==="multi")&&!b.id?.startsWith("default-")?e.jsxs("button",{onClick:()=>p(b.id),className:"min-h-[44px] px-3 py-2 bg-red-600 hover:bg-red-700 active:bg-red-800 text-white rounded-lg text-sm transition-all flex items-center justify-center gap-1.5 touch-manipulation","aria-label":"–£–¥–∞–ª–∏—Ç—å —Ç–∞—Ä–∏—Ñ",children:[e.jsx(ae,{className:"w-4 h-4 flex-shrink-0"}),e.jsx("span",{children:"–£–¥–∞–ª–∏—Ç—å"})]}):null})()]})})]},b.id))})]})})})]}),s==="n8n"&&e.jsx(mt,{onSaveSettings:_}),V&&e.jsx("div",{className:"mt-3 sm:mt-4 p-3 sm:p-4 bg-green-900/30 border border-green-800 rounded-lg sm:rounded-xl text-green-300 text-[clamp(0.875rem,0.8rem+0.375vw,1rem)]",children:V}),F&&e.jsx("div",{className:"mt-3 sm:mt-4 p-3 sm:p-4 bg-red-900/30 border border-red-800 rounded-lg sm:rounded-xl text-red-300 text-[clamp(0.875rem,0.8rem+0.375vw,1rem)]",children:F})]})}),A&&e.jsx(nt,{onClose:()=>D(!1)}),us&&e.jsx("div",{className:"fixed inset-0 bg-black/70 backdrop-blur-sm z-50 flex items-center justify-center p-2 sm:p-4",onClick:()=>je(!1),children:e.jsxs("div",{className:"bg-slate-900 rounded-xl shadow-2xl border border-slate-800 w-full max-w-7xl max-h-[90vh] overflow-y-auto m-2 sm:m-4",onClick:b=>b.stopPropagation(),children:[e.jsxs("div",{className:"sticky top-0 bg-slate-900 border-b border-slate-800 p-4 sm:p-6 flex items-center justify-between z-10",children:[e.jsxs("h2",{className:"text-xl sm:text-2xl font-bold text-slate-200 flex items-center gap-2",children:[e.jsx(Fe,{className:"w-6 h-6"}),"–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–µ—Ä–≤–µ—Ä–∞"]}),e.jsx("button",{onClick:()=>je(!1),className:"p-2 hover:bg-slate-800 rounded-lg transition-colors text-slate-400 hover:text-slate-200","aria-label":"–ó–∞–∫—Ä—ã—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥",children:e.jsx(ne,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"p-4 sm:p-6",children:e.jsx(ut,{})})]})})]})};xt.propTypes=ht;const ee={async loadUsers(){if(!B)throw new Error("–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞");try{o.info("Admin","–ó–∞–≥—Ä—É–∑–∫–∞ –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏–∑ Firestore (—Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–∞)");const a=Be(B,`artifacts/${z}/public/data/users_v4`),s=await Xe(a),t=[];return s.forEach(n=>{t.push({id:n.id,...n.data()})}),o.info("Admin",`–ó–∞–≥—Ä—É–∂–µ–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: ${t.length}`),t}catch(a){throw o.error("Admin","–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π",{code:a.code},a),a}},async updateUser(a,s,t,n){if(!B)throw new Error("–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞");try{o.info("Admin","–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è",{userId:a,updates:s});const i=Y(B,`artifacts/${z}/public/data/users_v4`,a),r={...s,subid:s.subid!==void 0?Array.isArray(s.subid)?s.subid:s.subid?[s.subid]:[]:void 0,updatedAt:new Date().toISOString()};r.subid===void 0&&delete r.subid,o.info("Admin","–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ Firestore",{userId:a,updateData:r,updateDataKeys:Object.keys(r),subid:r.subid,subidType:Array.isArray(r.subid)?"array":typeof r.subid,subidLength:Array.isArray(r.subid)?r.subid.length:0}),console.log("üî• –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ Firestore:",{userId:a,updateData:r,updateDataKeys:Object.keys(r),subid:r.subid,subidType:Array.isArray(r.subid)?"array":typeof r.subid,subidLength:Array.isArray(r.subid)?r.subid.length:0}),await ie(i,r,{merge:!0}),console.log("‚úÖ –î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ Firestore");const u=await ge(i);if(u.exists()){const m=u.data();if(console.log("‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö:",{savedKeys:Object.keys(m),savedValues:{uuid:m.uuid,name:m.name,phone:m.phone,expiresAt:m.expiresAt,trafficGB:m.trafficGB,devices:m.devices,tariffId:m.tariffId,plan:m.plan,subid:m.subid,subidType:Array.isArray(m.subid)?"array":typeof m.subid,subidLength:Array.isArray(m.subid)?m.subid.length:m.subid?1:0}}),r.subid!==void 0){const T=m.subid,S=r.subid;JSON.stringify(T)!==JSON.stringify(S)?console.warn("‚ö†Ô∏è –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ: subid –º–æ–∂–µ—Ç –±—ã—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ",{expected:S,saved:T}):console.log("‚úÖ subid —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω:",T)}}else console.error("‚ùå –î–æ–∫—É–º–µ–Ω—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω –ø–æ—Å–ª–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è!");const l={...t,...s},f=Array.isArray(t.subid)?t.subid:t.subid?[t.subid]:[],N=Array.isArray(s.subid)?s.subid:s.subid?[s.subid]:[],j=JSON.stringify(f)!==JSON.stringify(N),y=l.uuid&&(s.expiresAt!==void 0||s.trafficGB!==void 0||s.devices!==void 0||s.uuid!==void 0||s.subid!==void 0&&j);if(console.log("üîç adminService.updateUser: –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –≤ 3x-ui",{userId:a,shouldUpdateXui:y,hasUuid:!!l.uuid,subidChanged:j,oldSubid:f,newSubid:N,updatesKeys:Object.keys(s)}),y){const m=n?.xuiInboundId||"1";if(m)try{const T=l.expiresAt?new Date(l.expiresAt).getTime():0;let S="";l.subid&&(Array.isArray(l.subid)&&l.subid.length>0?S=l.subid.find(P=>P&&P.trim()!=="")||l.subid[0]||"":typeof l.subid=="string"&&l.subid.trim()!==""&&(S=l.subid.trim())),await Ue.updateClient(m,l.email,{expiryTime:T,totalGB:l.trafficGB||0,limitIp:l.devices||0,subId:S}),o.info("Admin","–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ–±–Ω–æ–≤–ª–µ–Ω –≤ 3x-ui",{email:l.email,subId:S,hasSubId:!!S})}catch(T){o.error("Admin","–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –≤ 3x-ui",{email:l.email},T)}}return o.info("Admin","–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω",{userId:a}),r}catch(i){throw o.error("Admin","–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è",{userId:a},i),i}},async deleteUser(a,s){if(!B)throw new Error("–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞");try{if(o.info("Admin","–£–¥–∞–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è",{userId:a,email:s.email}),s.uuid&&s.uuid.trim()!=="")try{await Ue.deleteClient("1",s.email),o.info("Admin","–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–¥–∞–ª–µ–Ω –∏–∑ 3x-ui",{email:s.email})}catch(n){o.warn("Admin","–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –∫–ª–∏–µ–Ω—Ç–∞ –∏–∑ 3x-ui",{email:s.email},n)}const t=Y(B,`artifacts/${z}/public/data/users_v4`,a);await Oe(t),o.info("Admin","–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–¥–∞–ª–µ–Ω –∏–∑ Firestore",{userId:a})}catch(t){throw o.error("Admin","–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è",{userId:a},t),t}},async loadSettings(){if(!B)throw new Error("–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞");try{o.info("Admin","–ó–∞–≥—Ä—É–∑–∫–∞ –≥–ª–æ–±–∞–ª—å–Ω—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫ —Å–∏—Å—Ç–µ–º—ã (—Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–∞)");const a=Y(B,`artifacts/${z}/public/settings`),s=await ge(a);if(s.exists()){const t=s.data(),n=(t.servers||[]).map(i=>{const r={...i,xuiUsername:(i.xuiUsername||"").trim().replace(/^["']|["']$/g,"")};return r.protocol||(r.protocol=r.serverPort===443||r.serverPort===40919?"https":"http"),r});return{...t,servers:n}}else{const t={serverIP:"http://localhost",serverPort:2053,xuiUsername:"vladislav4endev",xuiPassword:"v902l733a00d94%",xuiInboundId:"1",servers:[],updatedAt:new Date().toISOString()};return await ie(a,t),t}}catch(a){if(a.code==="unavailable"||a.message?.includes("offline")||a.message?.includes("Failed to get document because the client is offline"))return o.warn("Admin","–û—Ñ–ª–∞–π–Ω-—Ä–µ–∂–∏–º: –∏—Å–ø–æ–ª—å–∑—É–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é",null),{serverIP:"http://localhost",serverPort:2053,xuiUsername:"vladislav4endev",xuiPassword:"v902l733a00d94%",xuiInboundId:"1",servers:[],updatedAt:new Date().toISOString()};throw o.error("Admin","–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫",null,a),a}},async saveSettings(a,s,t){if(!B)throw new Error("–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞");try{o.info("Admin","–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≥–ª–æ–±–∞–ª—å–Ω—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫ —Å–∏—Å—Ç–µ–º—ã",{adminId:t});const n=Y(B,`artifacts/${z}/public/settings`);await ie(n,{...a,servers:s,updatedAt:new Date().toISOString(),updatedBy:t}),o.info("Admin","–ì–ª–æ–±–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã",{adminId:t})}catch(n){throw o.error("Admin","–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫",{adminId:t},n),n}},async loadTariffs(){if(!B)throw new Error("–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞");try{const a=Be(B,`artifacts/${z}/public/data/tariffs`),s=await Xe(a),t=[];return s.forEach(n=>{t.push({id:n.id,...n.data()})}),o.info("Admin","–¢–∞—Ä–∏—Ñ—ã –∑–∞–≥—Ä—É–∂–µ–Ω—ã",{count:t.length}),t}catch(a){throw o.error("Admin","–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–∞—Ä–∏—Ñ–æ–≤",null,a),a}},async saveTariff(a,s){if(!B)throw new Error("–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞");try{const t=Y(B,`artifacts/${z}/public/data/tariffs`,a);return await Js(t,{...s,updatedAt:new Date().toISOString()}),o.info("Admin","–¢–∞—Ä–∏—Ñ —Å–æ—Ö—Ä–∞–Ω–µ–Ω",{tariffId:a}),s}catch(t){throw o.error("Admin","–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ç–∞—Ä–∏—Ñ–∞",{tariffId:a},t),t}},async deleteTariff(a){if(!B)throw new Error("–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞");try{const s=Y(B,`artifacts/${z}/public/data/tariffs`,a);await Oe(s),o.info("Admin","–¢–∞—Ä–∏—Ñ —É–¥–∞–ª–µ–Ω",{tariffId:a})}catch(s){throw o.error("Admin","–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è —Ç–∞—Ä–∏—Ñ–∞",{tariffId:a},s),s}}};function pt(a,s,t,n,i,r,u){const[l,f]=c.useState(null),[N,j]=c.useState(!1),y=v=>{const h={...v};return h.createdAt&&(h.createdAt.seconds?h.createdAt=h.createdAt.seconds*1e3:typeof h.createdAt=="string"?h.createdAt=new Date(h.createdAt).getTime():typeof h.createdAt=="number"&&(h.createdAt=h.createdAt)),h.expiresAt&&(h.expiresAt.seconds?h.expiresAt=h.expiresAt.seconds*1e3:typeof h.expiresAt=="string"?h.expiresAt=new Date(h.expiresAt).getTime():typeof h.expiresAt=="number"&&(h.expiresAt=h.expiresAt)),h},m=c.useCallback(async()=>{if(!a||a.role!=="admin"){o.warn("Admin","–ü–æ–ø—ã—Ç–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –±–µ–∑ –ø—Ä–∞–≤ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞");return}j(!0);try{const h=(await ee.loadUsers()).map(y);t(h),o.info("Admin","–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∏ –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω—ã",{count:h.length})}catch(v){const h=be(v);se("Admin","loadUsers",v,{userId:a.id}),r(h)}finally{j(!1)}},[a,t,r]),T=c.useCallback(async(v,h)=>{if(!a||a.role!=="admin"){r("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø—Ä–∞–≤");return}try{const k=s.find(R=>R.id===v);if(!k){r("–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω");return}const I={...k,...h},E=Ae(I);if(!E.isValid){r(E.errors.join(", "));return}const w=Te(I);await ee.updateUser(v,w,w,i),t(R=>R.map(X=>X.id===v?w:X)),a.id===v&&n(w),u("–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ–±–Ω–æ–≤–ª–µ–Ω"),f(null),setTimeout(()=>u(""),3e3)}catch(k){const I=be(k);se("Admin","handleUpdateUser",k,{userId:v}),r(I)}},[a,s,t,n,i,r,u]),S=c.useCallback(async v=>{if(!a||a.role!=="admin"){const k=new Error("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø—Ä–∞–≤");throw se("Admin","handleSaveUserCard",k,{userId:a?.id}),r("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø—Ä–∞–≤"),k}const h=Ae(v);if(!h.isValid){const k=new Error(h.errors.join(", "));throw se("Admin","handleSaveUserCard",k,{userId:v.id,errors:h.errors}),r(h.errors.join(", ")),k}try{const k=v.id,I=s.find(p=>p.id===k);if(!I){const p=new Error("–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω");throw se("Admin","handleSaveUserCard",p,{userId:k}),r("–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω"),p}const E=Te(v),w=Array.isArray(I.subid)?I.subid:I.subid?[I.subid]:[],R=E.subid||[],X=JSON.stringify(w)!==JSON.stringify(R);o.info("Admin","–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ –∫–∞—Ä—Ç–æ—á–∫–∏",{userId:k,fields:Object.keys(E),subidChanged:X,oldSubid:w,newSubid:R,changes:Object.keys(E).filter(p=>{const _=I[p],U=E[p];return Array.isArray(_)||Array.isArray(U)?JSON.stringify(_)!==JSON.stringify(U):_!==U})}),console.log("üîç handleSaveUserCard: –î–∞–Ω–Ω—ã–µ –ø–µ—Ä–µ–¥ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º",{userId:k,normalizedUser:E,subid:E.subid,subidType:Array.isArray(E.subid)?"array":typeof E.subid,subidLength:Array.isArray(E.subid)?E.subid.length:E.subid?1:0,oldSubid:w,newSubid:R,subidChanged:X}),await ee.updateUser(k,E,I,i),t(p=>p.map(U=>{if(U.id===k){const A={...U,...E};return console.log("‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è",{userId:k,updatedUser:A,subid:A.subid,subidType:Array.isArray(A.subid)?"array":typeof A.subid,subidLength:Array.isArray(A.subid)?A.subid.length:0,allFields:Object.keys(A)}),A}return U})),a.id===k&&n(E),u("–î–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω—ã"),setTimeout(()=>u(""),3e3),o.info("Admin","–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω",{userId:k})}catch(k){const I=be(k);throw se("Admin","handleSaveUserCard",k,{userId:v.id}),r(I),k}},[a,s,t,n,i,r,u]),P=c.useCallback(()=>{try{return Ue.generateUUID()}catch(v){return se("Admin","generateUUID",v),r("–û—à–∏–±–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ UUID"),""}},[r]),C=c.useCallback(async v=>{if(!a||a.role!=="admin"){r("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø—Ä–∞–≤");return}if(!window.confirm("–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è?"))return;const h=s.find(k=>k.id===v);if(!h){r("–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω");return}try{await ee.deleteUser(v,h),t(k=>k.filter(I=>I.id!==v)),u("–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–¥–∞–ª–µ–Ω –∏–∑ —Å–∏—Å—Ç–µ–º—ã –∏ VPN –ø–∞–Ω–µ–ª–∏"),setTimeout(()=>u(""),3e3),o.info("Admin","–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω",{userId:v})}catch(k){const I=be(k);se("Admin","handleDeleteUser",k,{userId:v}),r(I)}},[a,s,t,r,u]);return{editingUser:l,loading:N,setEditingUser:f,loadUsers:m,handleUpdateUser:T,handleDeleteUser:C,handleSaveUserCard:S,generateUUID:P}}function bt(a,s,t,n,i,r,u){const[l,f]=c.useState(null),[N,j]=c.useState(null),y=c.useRef(null),m=c.useCallback(()=>{y.current||(y.current=`new-server-${Date.now()}-${Math.random().toString(36).substr(2,9)}`);const U={id:y.current,name:"",serverIP:"",serverPort:2053,protocol:"http",randompath:"",xuiUsername:"",xuiPassword:"",xuiInboundId:"",tariffIds:[],location:"",active:!0,sessionTested:!1,sessionTestedAt:null};f(U)},[]),T=c.useCallback(async()=>{if(!l)return;if(!a||a.role!=="admin"){r("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø—Ä–∞–≤ –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–µ—Ä–≤–µ—Ä–∞"),o.warn("Admin","–ü–æ–ø—ã—Ç–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–µ—Ä–≤–µ—Ä–∞ –±–µ–∑ –ø—Ä–∞–≤ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞",{userId:a?.id});return}const A=l.protocol&&l.protocol.trim()!==""?l.protocol.trim():l.serverPort===443||l.serverPort===40919?"https":"http",D=(l.xuiUsername||"").trim().replace(/^["']|["']$/g,""),V={...l,name:(l.name||"").trim(),serverIP:(l.serverIP||"").trim(),protocol:A,xuiUsername:D,xuiPassword:l.xuiPassword||"",xuiInboundId:(l.xuiInboundId||"").trim(),location:(l.location||"").trim(),randompath:(l.randompath||"").trim()};if(!V.name||!V.serverIP||!V.serverPort){r("–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è: –Ω–∞–∑–≤–∞–Ω–∏–µ, IP –∏ –ø–æ—Ä—Ç");return}if(!V.xuiUsername||!V.xuiPassword||!V.xuiInboundId){r("–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è: –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –ø–∞—Ä–æ–ª—å –∏ ID –∏–Ω–±–∞—É–Ω–¥–∞");return}if(!B){r("–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞");return}try{const F=V.id&&s.find(O=>O.id===V.id);let q=[];F?q=s.map(O=>O.id===V.id?V:O):q=[...s,V],t(q);const g={...n||{serverIP:"http://localhost",serverPort:2053,xuiUsername:"vladislav4endev",xuiPassword:"v902l733a00d94%",xuiInboundId:"1",servers:[]},servers:q,updatedAt:new Date().toISOString(),updatedBy:a.id};i(g);const L=Y(B,`artifacts/${z}/public/settings`);await ie(L,g,{merge:!0}),y.current=null,f(null),u("–°–µ—Ä–≤–µ—Ä —Å–æ—Ö—Ä–∞–Ω–µ–Ω"),setTimeout(()=>u(""),2e3)}catch(F){o.error("Admin","–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–µ—Ä–≤–µ—Ä–∞ –≤ Firestore",{adminId:a.id},F),r("–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–µ—Ä–≤–µ—Ä–∞: "+(F.message||"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞"))}},[l,a,B,n,s,t,i,r,u]),S=c.useCallback(async U=>{if(!a||a.role!=="admin"){r("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø—Ä–∞–≤ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è —Å–µ—Ä–≤–µ—Ä–∞");return}if(window.confirm("–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç —Å–µ—Ä–≤–µ—Ä?")){if(!B){r("–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞");return}try{const A=s.filter(q=>q.id!==U);t(A);const V={...n||{serverIP:"http://localhost",serverPort:2053,xuiUsername:"vladislav4endev",xuiPassword:"v902l733a00d94%",xuiInboundId:"1",servers:[]},servers:A,updatedAt:new Date().toISOString(),updatedBy:a.id};i(V);const F=Y(B,`artifacts/${z}/public/settings`);await ie(F,V,{merge:!0}),u("–°–µ—Ä–≤–µ—Ä —É–¥–∞–ª–µ–Ω"),setTimeout(()=>u(""),2e3)}catch(A){o.error("Admin","–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è —Å–µ—Ä–≤–µ—Ä–∞ –∏–∑ Firestore",{adminId:a.id},A),r("–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è —Å–µ—Ä–≤–µ—Ä–∞: "+(A.message||"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞")),t(s)}}},[s,a,B,n,t,i,r,u]),P=c.useCallback(async U=>{if(!U||!U.id)return;j(U.id),r(""),u("");const A=s.find(F=>F.id===U.id)||U,D=A.protocol||(A.serverPort===443||A.serverPort===40919?"https":"http"),V=A.randompath?`/${A.randompath.replace(/^\/+|\/+$/g,"")}`:"";`${D}://${A.serverIP}:${A.serverPort}${V}`.replace(/\/+$/,"");try{const F=(A.xuiUsername||"").trim().replace(/^["']|["']$/g,""),q=A.xuiPassword||"";if(!F||!q){const J=[];throw F||J.push("Username"),q||J.push("Password"),new Error(`–û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏: ${J.join(", ")}`)}const d={serverIP:U.serverIP,serverPort:U.serverPort,protocol:D,randompath:U.randompath||"",username:F,password:q},g=await ce.post("/api/test-session",d,{withCredentials:!0,timeout:1e4,headers:{"Content-Type":"application/json",Accept:"application/json"}}),L=g.data||{};let O=null;const K=g.headers["set-cookie"]||g.headers["Set-Cookie"];if(K){const J=Array.isArray(K)?K:[K];for(const he of J)if(he.includes("3x-ui=")){const xe=he.match(/3x-ui=([^;]+)/);if(xe){O=xe[1];break}}}const oe=s.map(J=>J.id===U.id?{...J,sessionTested:!0,sessionTestedAt:new Date().toISOString(),sessionError:null,sessionCookie:O}:J);t(oe),u("–°–µ—Å—Å–∏—è —É—Å–ø–µ—à–Ω–æ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∞"),setTimeout(()=>u(""),3e3)}catch(F){o.error("Admin","–û—à–∏–±–∫–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Å–µ—Å—Å–∏–∏",{serverId:U.id},F);const q=s.map(d=>d.id===U.id?{...d,sessionTested:!1,sessionTestedAt:new Date().toISOString(),sessionError:F.message||"–û—à–∏–±–∫–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Å–µ—Å—Å–∏–∏"}:d);t(q),r(F.message||"–û—à–∏–±–∫–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Å–µ—Å—Å–∏–∏")}finally{j(null)}},[s,t,r,u]),C=c.useCallback(U=>{const A=U.target.value;f(D=>D?{...D,name:A}:null)},[]),v=c.useCallback(U=>{const A=U.target.value;f(D=>D?{...D,serverIP:A}:null)},[]),h=c.useCallback(U=>{const A=Number(U.target.value)||2053;f(D=>D?{...D,serverPort:A}:null)},[]),k=c.useCallback(U=>{const A=U.target.value;f(D=>D?{...D,protocol:A}:null)},[]),I=c.useCallback(U=>{const A=U.target.value;f(D=>D?{...D,randompath:A}:null)},[]),E=c.useCallback(U=>{const A=U.target.value;f(D=>D?{...D,xuiUsername:A}:null)},[]),w=c.useCallback(U=>{const A=U.target.value;f(D=>D?{...D,xuiPassword:A}:null)},[]),R=c.useCallback(U=>{const A=U.target.value;f(D=>D?{...D,xuiInboundId:A}:null)},[]),X=c.useCallback(U=>{const A=U.target.value;f(D=>D?{...D,location:A}:null)},[]),p=c.useCallback(U=>{const A=U.target.checked;f(D=>D?{...D,active:A}:null)},[]),_=c.useCallback((U,A)=>{f(D=>{if(!D)return null;const V=D.tariffIds||[],F=A?[...V,U]:V.filter(q=>q!==U);return{...D,tariffIds:F}})},[]);return{editingServer:l,testingServerId:N,setEditingServer:f,handleAddServer:m,handleSaveServer:T,handleDeleteServer:S,handleTestServerSession:P,handleServerNameChange:C,handleServerIPChange:v,handleServerPortChange:h,handleServerProtocolChange:k,handleServerRandompathChange:I,handleServerXuiUsernameChange:E,handleServerXuiPasswordChange:w,handleServerXuiInboundIdChange:R,handleServerLocationChange:X,handleServerActiveChange:p,handleServerTariffChange:_}}function ft(a,s,t,n){const[i,r]=c.useState(null),u=c.useCallback(async()=>{try{const C=await ee.loadTariffs();s(C)}catch(C){o.error("Admin","–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–∞—Ä–∏—Ñ–æ–≤",null,C),t("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–∞—Ä–∏—Ñ–æ–≤")}},[s,t]),l=c.useCallback(async C=>{if(!i||!i.id||i.id.startsWith("default-")){t("–ú–æ–∂–Ω–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ç–∞—Ä–∏—Ñ—ã SUPER –∏ MULTI");return}const v=C.plan?.toLowerCase(),h=C.name?.toLowerCase();if(v!=="super"&&v!=="multi"&&h!=="super"&&h!=="multi"){t("–†–∞–∑—Ä–µ—à–µ–Ω—ã —Ç–æ–ª—å–∫–æ —Ç–∞—Ä–∏—Ñ—ã SUPER –∏ MULTI");return}try{await ee.saveTariff(i.id,C),s(k=>k.map(I=>I.id===i.id?{...I,...C}:I)),n("–¢–∞—Ä–∏—Ñ —Å–æ—Ö—Ä–∞–Ω–µ–Ω"),r(null),setTimeout(()=>n(""),3e3)}catch(k){o.error("Admin","–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ç–∞—Ä–∏—Ñ–∞",{tariffId:i?.id},k),t("–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ç–∞—Ä–∏—Ñ–∞")}},[i,a,s,t,n]),f=c.useCallback(async C=>{const v=a.find(I=>I.id===C);if(!v)return;const h=v.plan?.toLowerCase(),k=v.name?.toLowerCase();if(h==="super"||h==="multi"||k==="super"||k==="multi"){t("–ù–µ–ª—å–∑—è —É–¥–∞–ª–∏—Ç—å —Ç–∞—Ä–∏—Ñ—ã SUPER –∏ MULTI"),setTimeout(()=>t(""),3e3);return}if(window.confirm("–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç —Ç–∞—Ä–∏—Ñ?"))try{await ee.deleteTariff(C),s(I=>I.filter(E=>E.id!==C)),n("–¢–∞—Ä–∏—Ñ —É–¥–∞–ª–µ–Ω"),setTimeout(()=>n(""),3e3)}catch(I){o.error("Admin","–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è —Ç–∞—Ä–∏—Ñ–∞",{tariffId:C},I),t("–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è —Ç–∞—Ä–∏—Ñ–∞")}},[a,s,t,n]),N=c.useCallback(C=>{const v=C.target.value;r(h=>h?{...h,name:v}:null)},[]),j=c.useCallback(C=>{const v=C.target.value;r(h=>h?{...h,plan:v}:null)},[]),y=c.useCallback(C=>{const v=Number(C.target.value)||0;r(h=>h?{...h,price:v}:null)},[]),m=c.useCallback(C=>{const v=Number(C.target.value)||1;r(h=>h?{...h,devices:v}:null)},[]),T=c.useCallback(C=>{const v=Number(C.target.value)||0;r(h=>h?{...h,trafficGB:v}:null)},[]),S=c.useCallback(C=>{const v=Number(C.target.value)||30;r(h=>h?{...h,durationDays:v}:null)},[]),P=c.useCallback(C=>{const v=C.target.checked;r(h=>h?{...h,active:v}:null)},[]);return{editingTariff:i,setEditingTariff:r,loadTariffs:u,handleSaveTariff:l,handleDeleteTariff:f,handleTariffNameChange:N,handleTariffPlanChange:j,handleTariffPriceChange:y,handleTariffDevicesChange:m,handleTariffTrafficGBChange:T,handleTariffDurationDaysChange:S,handleTariffActiveChange:P}}function gt(a,s,t){const[n,i]=c.useState(null),[r,u]=c.useState(!0),[l,f]=c.useState([]),N=c.useRef(!1),j=c.useCallback(async()=>{if(!a||a.role!=="admin"){o.warn("Admin","–ü–æ–ø—ã—Ç–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –±–µ–∑ –ø—Ä–∞–≤ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞");return}if(N.current){o.debug("Admin","–ó–∞–≥—Ä—É–∑–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫ —É–∂–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º");return}N.current=!0;try{const m=await ee.loadSettings();i(m);const T=m.servers||[];f(S=>{if(S||(S=[]),!S||S.length===0)return T;const P=[...T];let C=0,v=0;return S.forEach(h=>{if(!T.some(I=>I.id===h.id))P.push(h),C++;else{const I=P.findIndex(E=>E.id===h.id);if(I!==-1){const E=h.sessionTestedAt||h.sessionError!==void 0,w=P[I].sessionTestedAt||P[I].sessionError!==void 0;E&&(!w||new Date(h.sessionTestedAt||0)>new Date(P[I].sessionTestedAt||0))?(P[I]={...P[I],...h},v++):(P[I]={...P[I],...h,sessionTested:h.sessionTested??P[I].sessionTested,sessionTestedAt:h.sessionTestedAt??P[I].sessionTestedAt,sessionError:h.sessionError??P[I].sessionError},v++)}}}),o.info("Admin","–û–±—ä–µ–¥–∏–Ω–µ–Ω—ã —Å–µ—Ä–≤–µ—Ä—ã –∏–∑ Firestore –∏ –ª–æ–∫–∞–ª—å–Ω—ã–µ",{firestoreCount:T.length,localCount:S.length,mergedCount:P.length,addedCount:C,updatedCount:v}),P})}catch(m){o.error("Admin","–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫",null,m)}finally{u(!1),N.current=!1}},[a,f]),y=c.useCallback(async()=>{if(!a||a.role!=="admin"){s("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø—Ä–∞–≤ –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫"),o.warn("Admin","–ü–æ–ø—ã—Ç–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫ –±–µ–∑ –ø—Ä–∞–≤ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞",{userId:a?.id});return}if(n)try{await ee.saveSettings(n,l,a.id),t("–ì–ª–æ–±–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –∏ –ø—Ä–∏–º–µ–Ω–µ–Ω—ã –∫–æ –≤—Å–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º"),setTimeout(()=>t(""),3e3)}catch(m){o.error("Admin","–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫",{adminId:a.id},m),s("–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫")}},[a,n,l,s,t]);return{settings:n,settingsLoading:r,servers:l,setSettings:i,setServers:f,loadSettings:j,handleSaveSettings:y}}function vt({currentUser:a,users:s,setUsers:t,setCurrentUser:n,tariffs:i,setTariffs:r,setError:u,setSuccess:l}){const[f,N]=c.useState("users"),j=gt(a,u,l),y=bt(a,j.servers,C=>{j.setServers(C),j.setSettings(v=>v?{...v,servers:C}:null)},j.settings,j.setSettings,u,l),m=pt(a,s,t,n,j.settings,u,l),T=ft(i,r,u,l),S=c.useMemo(()=>(console.log("üîç useAdmin: –°–æ–∑–¥–∞–Ω–∏–µ safeHandleSaveUserCard",{hasUsersHook:!!m,hasHandleSaveUserCard:!!m?.handleSaveUserCard,handleSaveUserCardType:typeof m?.handleSaveUserCard,usersHookKeys:m?Object.keys(m):"usersHook is null"}),m?.handleSaveUserCard&&typeof m.handleSaveUserCard=="function"?(console.log("‚úÖ useAdmin: –ò—Å–ø–æ–ª—å–∑—É–µ–º usersHook.handleSaveUserCard"),m.handleSaveUserCard):(console.warn("‚ö†Ô∏è useAdmin: handleSaveUserCard –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω, —Å–æ–∑–¥–∞–µ–º fallback"),async C=>{throw console.error("‚ùå useAdmin: handleSaveUserCard –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω –≤ usersHook!",{usersHookKeys:m?Object.keys(m):"usersHook is null",updatedUser:C}),new Error("–§—É–Ω–∫—Ü–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–µ –¥–æ—Å—Ç—É–ø–Ω–∞")})),[m?.handleSaveUserCard]),P=c.useMemo(()=>m.generateUUID&&typeof m.generateUUID=="function"?m.generateUUID:()=>(console.error("‚ùå useAdmin: generateUUID –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω –≤ usersHook!",{usersHookKeys:Object.keys(m)}),""),[m.generateUUID]);return{adminTab:f,setAdminTab:N,settings:j.settings,settingsLoading:j.settingsLoading,loadSettings:j.loadSettings,handleSaveSettings:j.handleSaveSettings,servers:j.servers,editingServer:y.editingServer,testingServerId:y.testingServerId,setEditingServer:y.setEditingServer,handleAddServer:y.handleAddServer,handleSaveServer:y.handleSaveServer,handleDeleteServer:y.handleDeleteServer,handleTestServerSession:y.handleTestServerSession,handleServerNameChange:y.handleServerNameChange,handleServerIPChange:y.handleServerIPChange,handleServerPortChange:y.handleServerPortChange,handleServerProtocolChange:y.handleServerProtocolChange,handleServerRandompathChange:y.handleServerRandompathChange,handleServerXuiUsernameChange:y.handleServerXuiUsernameChange,handleServerXuiPasswordChange:y.handleServerXuiPasswordChange,handleServerXuiInboundIdChange:y.handleServerXuiInboundIdChange,handleServerLocationChange:y.handleServerLocationChange,handleServerActiveChange:y.handleServerActiveChange,handleServerTariffChange:y.handleServerTariffChange,editingUser:m.editingUser,usersLoading:m.loading,setEditingUser:m.setEditingUser,loadUsers:m.loadUsers,handleUpdateUser:m.handleUpdateUser,handleDeleteUser:m.handleDeleteUser,handleSaveUserCard:S,generateUUID:P,editingTariff:T.editingTariff,setEditingTariff:T.setEditingTariff,loadTariffs:T.loadTariffs,handleSaveTariff:T.handleSaveTariff,handleDeleteTariff:T.handleDeleteTariff,handleTariffNameChange:T.handleTariffNameChange,handleTariffPlanChange:T.handleTariffPlanChange,handleTariffPriceChange:T.handleTariffPriceChange,handleTariffDevicesChange:T.handleTariffDevicesChange,handleTariffTrafficGBChange:T.handleTariffTrafficGBChange,handleTariffDurationDaysChange:T.handleTariffDurationDaysChange,handleTariffActiveChange:T.handleTariffActiveChange}}const $=(a,s="unknown",t=null)=>typeof a=="function"?a:(console.warn(`[Admin Warning]: Function ${s} is missing, using fallback.`,{functionName:s,receivedType:typeof a,receivedValue:a}),t&&typeof t=="function"?t:async(...n)=>{throw console.error(`Action ${s} failed: function not implemented`,{functionName:s,args:n}),new Error(`Function ${s} is not available`)}),Nt=({children:a,...s})=>{const t=vt(s);if(!t){console.error("‚ùå AdminProviderWrapper: adminHandlers –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω!",{adminProps:s,adminHandlers:t});const i={handleSaveUserCard:$(null,"handleSaveUserCard"),generateUUID:$(null,"generateUUID"),handleUpdateUser:$(null,"handleUpdateUser"),handleDeleteUser:$(null,"handleDeleteUser"),loadUsers:$(null,"loadUsers"),setEditingUser:()=>{},editingUser:null,handleAddServer:$(null,"handleAddServer"),handleSaveServer:$(null,"handleSaveServer"),handleDeleteServer:$(null,"handleDeleteServer"),handleTestServerSession:$(null,"handleTestServerSession"),setEditingServer:()=>{},editingServer:null,testingServerId:null,handleSaveTariff:$(null,"handleSaveTariff"),handleDeleteTariff:$(null,"handleDeleteTariff"),setEditingTariff:()=>{},editingTariff:null,loadTariffs:$(null,"loadTariffs"),handleSaveSettings:$(null,"handleSaveSettings"),loadSettings:$(null,"loadSettings"),settings:null,settingsLoading:!1,adminTab:"users",setAdminTab:()=>{}};return e.jsx(qe,{value:i,children:a})}const n={handleSaveUserCard:$(t.handleSaveUserCard,"handleSaveUserCard"),generateUUID:$(t.generateUUID,"generateUUID"),handleUpdateUser:$(t.handleUpdateUser,"handleUpdateUser"),handleDeleteUser:$(t.handleDeleteUser,"handleDeleteUser"),loadUsers:$(t.loadUsers,"loadUsers"),setEditingUser:t.setEditingUser,editingUser:t.editingUser,handleAddServer:$(t.handleAddServer,"handleAddServer"),handleSaveServer:$(t.handleSaveServer,"handleSaveServer"),handleDeleteServer:$(t.handleDeleteServer,"handleDeleteServer"),handleTestServerSession:$(t.handleTestServerSession,"handleTestServerSession"),setEditingServer:t.setEditingServer,editingServer:t.editingServer,testingServerId:t.testingServerId,handleSaveTariff:$(t.handleSaveTariff,"handleSaveTariff"),handleDeleteTariff:$(t.handleDeleteTariff,"handleDeleteTariff"),setEditingTariff:t.setEditingTariff,editingTariff:t.editingTariff,loadTariffs:$(t.loadTariffs,"loadTariffs"),handleSaveSettings:$(t.handleSaveSettings,"handleSaveSettings"),loadSettings:$(t.loadSettings,"loadSettings"),settings:t.settings,settingsLoading:t.settingsLoading,handleServerNameChange:$(t.handleServerNameChange,"handleServerNameChange"),handleServerIPChange:$(t.handleServerIPChange,"handleServerIPChange"),handleServerPortChange:$(t.handleServerPortChange,"handleServerPortChange"),handleServerProtocolChange:$(t.handleServerProtocolChange,"handleServerProtocolChange"),handleServerRandompathChange:$(t.handleServerRandompathChange,"handleServerRandompathChange"),handleServerXuiUsernameChange:$(t.handleServerXuiUsernameChange,"handleServerXuiUsernameChange"),handleServerXuiPasswordChange:$(t.handleServerXuiPasswordChange,"handleServerXuiPasswordChange"),handleServerXuiInboundIdChange:$(t.handleServerXuiInboundIdChange,"handleServerXuiInboundIdChange"),handleServerLocationChange:$(t.handleServerLocationChange,"handleServerLocationChange"),handleServerActiveChange:$(t.handleServerActiveChange,"handleServerActiveChange"),handleServerTariffChange:$(t.handleServerTariffChange,"handleServerTariffChange"),handleTariffNameChange:$(t.handleTariffNameChange,"handleTariffNameChange"),handleTariffPlanChange:$(t.handleTariffPlanChange,"handleTariffPlanChange"),handleTariffPriceChange:$(t.handleTariffPriceChange,"handleTariffPriceChange"),handleTariffDevicesChange:$(t.handleTariffDevicesChange,"handleTariffDevicesChange"),handleTariffTrafficGBChange:$(t.handleTariffTrafficGBChange,"handleTariffTrafficGBChange"),handleTariffDurationDaysChange:$(t.handleTariffDurationDaysChange,"handleTariffDurationDaysChange"),handleTariffActiveChange:$(t.handleTariffActiveChange,"handleTariffActiveChange"),adminTab:t.adminTab,setAdminTab:t.setAdminTab};if(!n)throw console.error("‚ùå AdminProviderWrapper: contextValue –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω!",{adminHandlers:t,adminProps:s}),new Error("AdminProviderWrapper: contextValue –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å undefined");return e.jsx(qe,{value:n,children:a})};export{z as A,nt as L,rt as S,tt as a,Nt as b,xt as c,B as d,Ge as g,Ue as i,o as l,st as v};
