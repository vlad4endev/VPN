# üîÑ –ü–ª–∞–Ω –º–∏–≥—Ä–∞—Ü–∏–∏ –Ω–∞ Firebase Authentication

## üìã –û–±–∑–æ—Ä

–ú–∏–≥—Ä–∞—Ü–∏—è —Å –∫–∞—Å—Ç–æ–º–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ (bcrypt + Firestore) –Ω–∞ Firebase Authentication:
- **Email/Password** –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ Firebase Auth
- **Google Sign-In** –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ Firebase Auth
- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ Firestore –ø–æ UID

---

## üéØ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –º–∏–≥—Ä–∞—Ü–∏–∏

1. ‚úÖ **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** - Firebase Auth —É–ø—Ä–∞–≤–ª—è–µ—Ç –ø–∞—Ä–æ–ª—è–º–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ
2. ‚úÖ **–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å** - –ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ –æ—Ç Google
3. ‚úÖ **–ü—Ä–æ—Å—Ç–æ—Ç–∞** - –Ω–µ –Ω—É–∂–Ω–æ —É–ø—Ä–∞–≤–ª—è—Ç—å —Ö–µ—à–∞–º–∏ –ø–∞—Ä–æ–ª–µ–π
4. ‚úÖ **Google Sign-In** - –±—ã—Å—Ç—Ä–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ Google
5. ‚úÖ **–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–∞—Ä–æ–ª—è** - –≤—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è Firebase
6. ‚úÖ **Email –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è** - –≤—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è Firebase

---

## üèóÔ∏è –ù–æ–≤–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö

**Firebase Authentication:**
- Email/Password –∞–∫–∫–∞—É–Ω—Ç—ã
- Google –∞–∫–∫–∞—É–Ω—Ç—ã
- UID - —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

**Firestore (–¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ):**
```
artifacts/skyputh/public/data/users_v4/{uid}
{
  email: string,              // –î—É–±–ª–∏—Ä—É–µ—Ç—Å—è –∏–∑ Firebase Auth (–¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞)
  name: string,               // –ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  phone: string,              // –¢–µ–ª–µ—Ñ–æ–Ω
  role: 'user' | 'admin',     // –†–æ–ª—å
  plan: string,               // –¢–∞—Ä–∏—Ñ–Ω—ã–π –ø–ª–∞–Ω
  uuid: string,               // UUID –¥–ª—è VPN –∫–ª—é—á–∞
  expiresAt: number | null,   // –î–∞—Ç–∞ –∏—Å—Ç–µ—á–µ–Ω–∏—è –ø–æ–¥–ø–∏—Å–∫–∏
  tariffName: string,         // –ù–∞–∑–≤–∞–Ω–∏–µ —Ç–∞—Ä–∏—Ñ–∞
  tariffId: string,           // ID —Ç–∞—Ä–∏—Ñ–∞
  createdAt: string,          // –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è
  updatedAt: string,          // –î–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
  photoURL: string | null     // URL —Ñ–æ—Ç–æ (–¥–ª—è Google –∞–∫–∫–∞—É–Ω—Ç–æ–≤)
}
```

### –°–≤—è–∑—å –¥–∞–Ω–Ω—ã—Ö

- **Firebase Auth UID** = **Firestore Document ID** –≤ `users_v4`
- –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–µ—Ç—Å—è –¥–æ–∫—É–º–µ–Ω—Ç –≤ Firestore
- Email –±–µ—Ä–µ—Ç—Å—è –∏–∑ Firebase Auth (–∏ –¥—É–±–ª–∏—Ä—É–µ—Ç—Å—è –≤ Firestore –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞)

---

## üìù –®–∞–≥–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Firebase Console

### –®–∞–≥ 1: –í–∫–ª—é—á–∏—Ç—å Email/Password –ø—Ä–æ–≤–∞–π–¥–µ—Ä

1. –û—Ç–∫—Ä–æ–π—Ç–µ: https://console.firebase.google.com/project/skypathvpn/authentication/providers
2. –ù–∞–π–¥–∏—Ç–µ **"Email/Password"** –≤ —Å–ø–∏—Å–∫–µ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤
3. –ù–∞–∂–º–∏—Ç–µ –Ω–∞ **"Email/Password"**
4. –í–∫–ª—é—á–∏—Ç–µ –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å **"Enable"**
5. (–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) –í–∫–ª—é—á–∏—Ç–µ **"Email link (passwordless sign-in)"** –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
6. –ù–∞–∂–º–∏—Ç–µ **"Save"**

### –®–∞–≥ 2: –í–∫–ª—é—á–∏—Ç—å Google –ø—Ä–æ–≤–∞–π–¥–µ—Ä

1. –í —Ç–æ–º –∂–µ —Å–ø–∏—Å–∫–µ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤ –Ω–∞–π–¥–∏—Ç–µ **"Google"**
2. –ù–∞–∂–º–∏—Ç–µ –Ω–∞ **"Google"**
3. –í–∫–ª—é—á–∏—Ç–µ –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å **"Enable"**
4. –£–∫–∞–∂–∏—Ç–µ **"Project support email"** (–≤–∞—à email)
5. –ù–∞–∂–º–∏—Ç–µ **"Save"**

### –®–∞–≥ 3: –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –¥–æ–º–µ–Ω –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ (–¥–ª—è Google)

1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ: Authentication > Settings > Authorized domains
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤–∞—à –¥–æ–º–µ–Ω –¥–æ–±–∞–≤–ª–µ–Ω (localhost –¥–æ–±–∞–≤–ª–µ–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
3. –î–ª—è production –¥–æ–±–∞–≤—å—Ç–µ –≤–∞—à –¥–æ–º–µ–Ω

### –®–∞–≥ 4: –û–±–Ω–æ–≤–∏—Ç—å –ø—Ä–∞–≤–∏–ª–∞ Firestore

–û–±–Ω–æ–≤–∏—Ç—å –ø—Ä–∞–≤–∏–ª–∞ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å Firebase Auth:

```javascript
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // –î–æ–∫—É–º–µ–Ω—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–æ—Å—Ç—É–ø–µ–Ω —Ç–æ–ª—å–∫–æ —Å–∞–º–æ–º—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –∏–ª–∏ –∞–¥–º–∏–Ω–∞–º
    match /artifacts/{appId}/public/data/users_v4/{userId} {
      allow read: if request.auth != null && (
        request.auth.uid == userId || 
        get(/databases/$(database)/documents/artifacts/$(appId)/public/data/users_v4/$(request.auth.uid)).data.role == 'admin'
      );
      allow write: if request.auth != null && request.auth.uid == userId;
      allow create: if request.auth != null && request.auth.uid == userId;
    }
    
    // –ê–¥–º–∏–Ω—ã –º–æ–≥—É—Ç —á–∏—Ç–∞—Ç—å –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
    match /artifacts/{appId}/public/data/users_v4/{userId} {
      allow read: if request.auth != null && 
        get(/databases/$(database)/documents/artifacts/$(appId)/public/data/users_v4/$(request.auth.uid)).data.role == 'admin';
    }
    
    // –î—Ä—É–≥–∏–µ –∫–æ–ª–ª–µ–∫—Ü–∏–∏ (payments, tariffs, etc.)
    match /artifacts/{appId}/public/data/{collection=**} {
      allow read, write: if request.auth != null;
    }
  }
}
```

---

## üîß –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–¥–µ

### 1. –ò–º–ø–æ—Ä—Ç—ã Firebase Auth

```javascript
// –ó–∞–º–µ–Ω–∏—Ç—å:
import { getAuth, signInAnonymously, onAuthStateChanged } from 'firebase/auth'

// –ù–∞:
import { 
  getAuth, 
  createUserWithEmailAndPassword,
  signInWithEmailAndPassword,
  signInWithPopup,
  GoogleAuthProvider,
  signOut,
  onAuthStateChanged,
  updateProfile
} from 'firebase/auth'
```

### 2. –£–¥–∞–ª–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

- ‚ùå –£–¥–∞–ª–∏—Ç—å `bcryptjs` (–±–æ–ª—å—à–µ –Ω–µ –Ω—É–∂–µ–Ω)
- ‚úÖ –û—Å—Ç–∞–≤–∏—Ç—å `firebase` (–≤–µ—Ä—Å–∏—è 12.7.0 –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –≤—Å–µ –Ω—É–∂–Ω—ã–µ –º–µ—Ç–æ–¥—ã)

### 3. –ù–æ–≤—ã–µ –º–µ—Ç–æ–¥—ã

#### –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
```javascript
// createUserWithEmailAndPassword(auth, email, password)
// ‚Üí —Å–æ–∑–¥–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ Firebase Auth
// ‚Üí –∑–∞—Ç–µ–º —Å–æ–∑–¥–∞–µ–º –¥–æ–∫—É–º–µ–Ω—Ç –≤ Firestore —Å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
```

#### –í—Ö–æ–¥
```javascript
// signInWithEmailAndPassword(auth, email, password)
// ‚Üí –≤—Ö–æ–¥ —á–µ—Ä–µ–∑ Firebase Auth
// ‚Üí –∑–∞–≥—Ä—É–∂–∞–µ–º –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ Firestore –ø–æ UID
```

#### Google Sign-In
```javascript
// signInWithPopup(auth, googleProvider)
// ‚Üí –≤—Ö–æ–¥ —á–µ—Ä–µ–∑ Google
// ‚Üí —Å–æ–∑–¥–∞–µ–º/–æ–±–Ω–æ–≤–ª—è–µ–º –¥–æ–∫—É–º–µ–Ω—Ç –≤ Firestore
```

#### –í—ã—Ö–æ–¥
```javascript
// signOut(auth)
// ‚Üí –≤—ã—Ö–æ–¥ –∏–∑ Firebase Auth
// ‚Üí –æ—á–∏—Å—Ç–∫–∞ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è
```

---

## üìä –ú–∏–≥—Ä–∞—Ü–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

### –í–∞—Ä–∏–∞–Ω—Ç 1: –†—É—á–Ω–∞—è –º–∏–≥—Ä–∞—Ü–∏—è (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è –Ω–µ–±–æ–ª—å—à–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π)

1. –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏–∑ Firestore
2. –°–æ–∑–¥–∞—Ç—å —Å–∫—Ä–∏–ø—Ç –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞ –≤ Firebase Auth
3. –û–±–Ω–æ–≤–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç—ã –≤ Firestore (–∑–∞–º–µ–Ω–∏—Ç—å ID –Ω–∞ UID)

### –í–∞—Ä–∏–∞–Ω—Ç 2: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –º–∏–≥—Ä–∞—Ü–∏—è –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –≤—Ö–æ–¥–µ

1. –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å—Ç–∞—Ä—É—é —Å–∏—Å—Ç–µ–º—É –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ
2. –ü—Ä–∏ –≤—Ö–æ–¥–µ –ø—Ä–æ–≤–µ—Ä—è—Ç—å: –µ—Å—Ç—å –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤ Firebase Auth
3. –ï—Å–ª–∏ –Ω–µ—Ç - –ø—Ä–µ–¥–ª–æ–∂–∏—Ç—å —Å–æ–∑–¥–∞—Ç—å –∞–∫–∫–∞—É–Ω—Ç —Å —Ç–µ–º –∂–µ email
4. –ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è - –ø–µ—Ä–µ–Ω–µ—Å—Ç–∏ –¥–∞–Ω–Ω—ã–µ

### –í–∞—Ä–∏–∞–Ω—Ç 3: –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∑–∞–Ω–æ–≤–æ (–¥–ª—è —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è)

- –£–¥–∞–ª–∏—Ç—å —Å—Ç–∞—Ä—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –ü–æ–ø—Ä–æ—Å–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è –∑–∞–Ω–æ–≤–æ

---

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã

1. **UID vs Document ID**: –¢–µ–ø–µ—Ä—å UID –∏–∑ Firebase Auth = Document ID –≤ Firestore
2. **Email –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è**: –ú–æ–∂–Ω–æ –≤–∫–ª—é—á–∏—Ç—å, –Ω–æ –Ω–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –¥–ª—è MVP
3. **–û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å**: –°—Ç–∞—Ä—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –Ω–µ —Å–º–æ–≥—É—Ç –≤–æ–π—Ç–∏ (–Ω—É–∂–Ω–∞ –º–∏–≥—Ä–∞—Ü–∏—è)
4. **Anonymous Auth**: –ú–æ–∂–Ω–æ –æ—Å—Ç–∞–≤–∏—Ç—å –¥–ª—è –ø—É–±–ª–∏—á–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –∫ –Ω–µ–∫–æ—Ç–æ—Ä—ã–º –¥–∞–Ω–Ω—ã–º
5. **–ü–∞—Ä–æ–ª–∏**: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –¥–æ–ª–∂–Ω—ã –±—É–¥—É—Ç —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–µ –ø–∞—Ä–æ–ª–∏ (—Å—Ç–∞—Ä—ã–µ –Ω–µ –ø–µ—Ä–µ–Ω–æ—Å—è—Ç—Å—è)

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –°—Ü–µ–Ω–∞—Ä–∏–∏ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:

1. ‚úÖ –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —Å email/password
2. ‚úÖ –í—Ö–æ–¥ —Å email/password
3. ‚úÖ –í—Ö–æ–¥ —á–µ—Ä–µ–∑ Google
4. ‚úÖ –í—ã—Ö–æ–¥
5. ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ/–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è
6. ‚úÖ –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–∞—Ä–æ–ª—è (–µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω–æ)
7. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞ (–æ–±—ã—á–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å, –∞–¥–º–∏–Ω)

---

## üìÖ –ü–ª–∞–Ω —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

1. **–≠—Ç–∞–ø 1**: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Firebase Console (Email/Password + Google)
2. **–≠—Ç–∞–ø 2**: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–¥–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
3. **–≠—Ç–∞–ø 3**: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ —Ç–µ—Å—Ç–æ–≤–æ–º –æ–∫—Ä—É–∂–µ–Ω–∏–∏
4. **–≠—Ç–∞–ø 4**: –ú–∏–≥—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
5. **–≠—Ç–∞–ø 5**: –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –Ω–∞ production

---

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 2025-01-27  
**–°—Ç–∞—Ç—É—Å:** –ì–æ—Ç–æ–≤ –∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

