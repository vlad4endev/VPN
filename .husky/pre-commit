#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

# ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ½Ğ° Ğ½Ğ°Ğ»Ğ¸Ñ‡Ğ¸Ğµ ÑĞµĞºÑ€ĞµÑ‚Ğ¾Ğ² Ğ² ĞºĞ¾Ğ´Ğµ
echo "ğŸ” ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ½Ğ° Ğ½Ğ°Ğ»Ğ¸Ñ‡Ğ¸Ğµ ÑĞµĞºÑ€ĞµÑ‚Ğ¾Ğ² Ğ² ĞºĞ¾Ğ´Ğµ..."

# ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼, Ñ‡Ñ‚Ğ¾ .env Ğ½Ğµ Ğ¿Ğ¾Ğ¿Ğ°Ğ´Ğ°ĞµÑ‚ Ğ² ĞºĞ¾Ğ¼Ğ¼Ğ¸Ñ‚
if git diff --cached --name-only | grep -q "\.env$"; then
  echo "âŒ ĞĞ¨Ğ˜Ğ‘ĞšĞ: Ğ¤Ğ°Ğ¹Ğ» .env Ğ¾Ğ±Ğ½Ğ°Ñ€ÑƒĞ¶ĞµĞ½ Ğ² staged Ñ„Ğ°Ğ¹Ğ»Ğ°Ñ…!"
  echo "   Ğ¤Ğ°Ğ¹Ğ» .env Ğ½Ğµ Ğ´Ğ¾Ğ»Ğ¶ĞµĞ½ Ğ¿Ğ¾Ğ¿Ğ°Ğ´Ğ°Ñ‚ÑŒ Ğ² Git."
  echo "   Ğ£Ğ±ĞµĞ´Ğ¸Ñ‚ĞµÑÑŒ, Ñ‡Ñ‚Ğ¾ .env Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½ Ğ² .gitignore"
  exit 1
fi

# ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ Ğ½Ğ° Ğ½Ğ°Ğ»Ğ¸Ñ‡Ğ¸Ğµ Ğ¿Ğ¾Ñ‚ĞµĞ½Ñ†Ğ¸Ğ°Ğ»ÑŒĞ½Ñ‹Ñ… ÑĞµĞºÑ€ĞµÑ‚Ğ¾Ğ² Ğ² staged Ñ„Ğ°Ğ¹Ğ»Ğ°Ñ…
if git diff --cached | grep -iE "(password|secret|api[_-]?key|token|private[_-]?key)\s*[:=]\s*['\"][^'\"]{8,}['\"]" | grep -v "example\|your_\|here\|test\|dummy"; then
  echo "âš ï¸  Ğ’ĞĞ˜ĞœĞĞĞ˜Ğ•: ĞĞ±Ğ½Ğ°Ñ€ÑƒĞ¶ĞµĞ½Ñ‹ Ğ¿Ğ¾Ñ‚ĞµĞ½Ñ†Ğ¸Ğ°Ğ»ÑŒĞ½Ñ‹Ğµ ÑĞµĞºÑ€ĞµÑ‚Ñ‹ Ğ² ĞºĞ¾Ğ´Ğµ!"
  echo "   Ğ£Ğ±ĞµĞ´Ğ¸Ñ‚ĞµÑÑŒ, Ñ‡Ñ‚Ğ¾ Ğ²ÑĞµ ÑĞµĞºÑ€ĞµÑ‚Ñ‹ Ğ²Ñ‹Ğ½ĞµÑĞµĞ½Ñ‹ Ğ² Ğ¿ĞµÑ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ğµ Ğ¾ĞºÑ€ÑƒĞ¶ĞµĞ½Ğ¸Ñ."
  echo "   ĞŸÑ€Ğ¾Ğ´Ğ¾Ğ»Ğ¶Ğ¸Ñ‚ÑŒ ĞºĞ¾Ğ¼Ğ¼Ğ¸Ñ‚? (y/N)"
  read -r response
  if [ "$response" != "y" ] && [ "$response" != "Y" ]; then
    exit 1
  fi
fi

echo "âœ… ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° ÑĞµĞºÑ€ĞµÑ‚Ğ¾Ğ² Ğ¿Ñ€Ğ¾Ğ¹Ğ´ĞµĞ½Ğ°"

# Ğ—Ğ°Ğ¿ÑƒÑĞºĞ°ĞµĞ¼ lint-staged ĞµÑĞ»Ğ¸ ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½
if command -v npx &> /dev/null && [ -f ".lintstagedrc.js" ]; then
  npx lint-staged || true
fi
