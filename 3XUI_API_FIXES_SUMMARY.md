# ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ—Ç–æ–∫–æ–ª–∞ 3x-ui API - –ò—Ç–æ–≥–æ–≤–∞—è —Å–≤–æ–¥–∫–∞

## üî¥ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### 1. ‚úÖ `totalGB` - –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≤ –±–∞–π—Ç—ã

**–ü—Ä–æ–±–ª–µ–º–∞:** 3x-ui –ø—Ä–∏–Ω–∏–º–∞–µ—Ç —Ç—Ä–∞—Ñ–∏–∫ –≤ **–±–∞–π—Ç–∞—Ö**, –∞ –Ω–µ –≤ –≥–∏–≥–∞–±–∞–π—Ç–∞—Ö.

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
```javascript
// server/xui-backend-proxy.js
const trafficInBytes = totalGB > 0 ? totalGB * 1024 * 1024 * 1024 : 0
totalGB: trafficInBytes  // 100 GB = 107374182400 –±–∞–π—Ç
```

**–ü—Ä–∏–º–µ—Ä:**
- –í—Ö–æ–¥: `totalGB = 100` (GB)
- –í—ã—Ö–æ–¥: `totalGB = 107374182400` (–±–∞–π—Ç)

---

### 2. ‚úÖ `expiryTime` - –û—Å—Ç–∞–µ—Ç—Å—è –≤ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥–∞—Ö

**–ü—Ä–æ–±–ª–µ–º–∞:** –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞–ª–æ—Å—å –≤ —Å–µ–∫—É–Ω–¥—ã, —á—Ç–æ –ø—Ä–∏–≤–æ–¥–∏–ª–æ –∫ "–∏—Å—Ç–µ—á–µ–Ω–∏—é" –≤ 1970 –≥–æ–¥—É.

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
```javascript
// server/xui-backend-proxy.js
let expiryTimestamp = expiryTime  // –û—Å—Ç–∞–µ—Ç—Å—è –≤ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥–∞—Ö
if (!expiryTimestamp || expiryTimestamp <= 0) {
  expiryTimestamp = Date.now() + (24 * 60 * 60 * 1000)  // +24 —á–∞—Å–∞
}
expiryTime: expiryTimestamp  // –ü–µ—Ä–µ–¥–∞–µ–º –≤ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥–∞—Ö
```

**–ü—Ä–∏–º–µ—Ä:**
- –í—Ö–æ–¥: `expiryTime = 1735689600000` (–º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥—ã)
- –í—ã—Ö–æ–¥: `expiryTime = 1735689600000` (–º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥—ã) ‚úÖ
- –ë—ã–ª–æ: `expiryTime = 1735689600` (—Å–µ–∫—É–Ω–¥—ã) ‚ùå

---

### 3. ‚úÖ –≠–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ JSON –≤ `settings`

**–ü—Ä–æ–±–ª–µ–º–∞:** –†—É—á–Ω–æ–µ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ JSON –º–æ–≥–ª–æ —Å–ª–æ–º–∞—Ç—å—Å—è –ø—Ä–∏ —Å–ø–µ—Ü—Å–∏–º–≤–æ–ª–∞—Ö.

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
```javascript
// server/xui-backend-proxy.js
const settings = JSON.stringify({
  clients: [clientSettings]
})  // –ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
```

---

### 4. ‚úÖ –§–∏–∫—Å–∞—Ü–∏—è –¥–∞—Ç—ã –ø–µ—Ä–≤–æ–≥–æ –ø–æ–ª—É—á–µ–Ω–∏—è –∫–ª—é—á–∞

**–ü—Ä–æ–±–ª–µ–º–∞:** –ü—Ä–∏ –∫–∞–∂–¥–æ–º –Ω–∞–∂–∞—Ç–∏–∏ "–ü–æ–ª—É—á–∏—Ç—å –∫–ª—é—á" —Å—Ä–æ–∫ –æ–±–Ω–æ–≤–ª—è–ª—Å—è –µ—â–µ –Ω–∞ 24 —á–∞—Å–∞.

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
```javascript
// src/features/dashboard/services/dashboardService.js
const firstKeyDate = user.firstKeyDate || user.createdAt

if (firstKeyDate) {
  // –ò—Å–ø–æ–ª—å–∑—É–µ–º –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—É—é –¥–∞—Ç—É + 24 —á–∞—Å–∞
  expiryTime = new Date(firstKeyDate).getTime() + (24 * 60 * 60 * 1000)
} else {
  // –ü–µ—Ä–≤–æ–µ –ø–æ–ª—É—á–µ–Ω–∏–µ - —Ñ–∏–∫—Å–∏—Ä—É–µ–º –¥–∞—Ç—É –≤ Firestore
  expiryTime = Date.now() + (24 * 60 * 60 * 1000)
  await updateDoc(userDoc, {
    firstKeyDate: new Date().toISOString()
  })
}
```

---

### 5. ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã —Å—á–µ—Ç—á–∏–∫–∏ `up` –∏ `down`

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
```javascript
// server/xui-backend-proxy.js
const clientSettings = {
  // ...
  up: 0,    // –°—á–µ—Ç—á–∏–∫ –≤—Ö–æ–¥—è—â–µ–≥–æ —Ç—Ä–∞—Ñ–∏–∫–∞
  down: 0,  // –°—á–µ—Ç—á–∏–∫ –∏—Å—Ö–æ–¥—è—â–µ–≥–æ —Ç—Ä–∞—Ñ–∏–∫–∞
}
```

---

### 6. ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø—Ä–æ–±–µ–ª–æ–≤ –≤ `email`

**–ü—Ä–æ–±–ª–µ–º–∞:** –ü—Ä–æ–±–µ–ª—ã –≤ email –º–æ–≥–ª–∏ –≤—ã–∑–≤–∞—Ç—å –±–∞–≥–∏ –≤ –ø—É—Ç—è—Ö –ø–æ–¥–ø–∏—Å–∫–∏.

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
```javascript
// server/xui-backend-proxy.js
const cleanEmail = (email || '').replace(/\s+/g, '_')
email: cleanEmail  // "–ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤" ‚Üí "–ò–≤–∞–Ω_–ò–≤–∞–Ω–æ–≤"
```

---

## üìã –ò—Ç–æ–≥–æ–≤—ã–π —Ñ–æ—Ä–º–∞—Ç –∑–∞–ø—Ä–æ—Å–∞

### –ó–∞–≥–æ–ª–æ–≤–∫–∏
```json
{
  "Accept": "application/json",
  "Content-Type": "application/json",
  "Cookie": "{–¥–∞–Ω–Ω—ã–µ –∏–∑ —Å–µ—Å—Å–∏–∏}"
}
```

### –¢–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞
```json
{
  "id": 3,
  "settings": "{\"clients\": [{\"id\": \"uuid\",\"flow\": \"xtls-rprx-vision\",\"email\": \"user_name\",\"limitIp\": 2,\"totalGB\": 107374182400,\"expiryTime\": 1735689600000,\"enable\": true,\"tgId\":\"\",\"subId\": \"sub-id\",\"reset\": 0,\"up\": 0,\"down\": 0}]}"
}
```

---

## üß™ –ü—Ä–∏–º–µ—Ä—ã –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏

### –¢—Ä–∞—Ñ–∏–∫
```
100 GB ‚Üí 107374182400 –±–∞–π—Ç
50 GB  ‚Üí 53687091200 –±–∞–π—Ç
0 GB   ‚Üí 0 –±–∞–π—Ç (–±–µ–∑–ª–∏–º–∏—Ç)
```

### –í—Ä–µ–º—è –∏—Å—Ç–µ—á–µ–Ω–∏—è
```
2025-01-27 20:00:00 ‚Üí 1735689600000 (–º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥—ã) ‚úÖ
2025-01-27 20:00:00 ‚Üí 1735689600 (—Å–µ–∫—É–Ω–¥—ã) ‚ùå
```

### Email
```
"–ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤" ‚Üí "–ò–≤–∞–Ω_–ò–≤–∞–Ω–æ–≤" ‚úÖ
"John Doe"    ‚Üí "John_Doe" ‚úÖ
"user@mail"   ‚Üí "user@mail" ‚úÖ (–±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π)
```

---

## ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π

1. **totalGB:** –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤ –ª–æ–≥–∞—Ö: `Traffic: 100 GB = 107374182400 bytes`
2. **expiryTime:** –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤ –ª–æ–≥–∞—Ö: `Expiry: 2025-01-28T20:00:00.000Z`
3. **email:** –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤ –ª–æ–≥–∞—Ö: `Creating client in 3x-ui: user_name (UUID: ...)`
4. **firstKeyDate:** –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤ Firestore: –ø–æ–ª–µ `firstKeyDate` –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ

---

**–î–∞—Ç–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:** 2025-01-27  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –í—Å–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã
