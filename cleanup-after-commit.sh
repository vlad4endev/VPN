#!/bin/bash

# –°–∫—Ä–∏–ø—Ç –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è –≤—Å–µ—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π –ø–æ—Å–ª–µ –∫–æ–º–º–∏—Ç–∞ 0c96a83f72aa70d64fa8cdcb27e9554beb234b5b

TARGET_COMMIT="0c96a83f72aa70d64fa8cdcb27e9554beb234b5b"

echo "üßπ –ù–∞—á–∏–Ω–∞—é –æ—á–∏—Å—Ç–∫—É –ø—Ä–æ–µ–∫—Ç–∞ –¥–æ –∫–æ–º–º–∏—Ç–∞ $TARGET_COMMIT..."
echo ""

# –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –º—ã –Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –∫–æ–º–º–∏—Ç–µ
CURRENT_COMMIT=$(git rev-parse HEAD)
if [ "$CURRENT_COMMIT" != "$TARGET_COMMIT" ]; then
    echo "‚ö†Ô∏è  –¢–µ–∫—É—â–∏–π –∫–æ–º–º–∏—Ç: $CURRENT_COMMIT"
    echo "üîÑ –ü–µ—Ä–µ–∫–ª—é—á–∞—é—Å—å –Ω–∞ –∫–æ–º–º–∏—Ç $TARGET_COMMIT..."
    git reset --hard $TARGET_COMMIT
fi

# 1. –£–¥–∞–ª—è–µ–º –≤—Å–µ –Ω–µ–æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ–º—ã–µ —Ñ–∞–π–ª—ã –∏ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
echo "üìÅ –£–¥–∞–ª—è—é –Ω–µ–æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ–º—ã–µ —Ñ–∞–π–ª—ã..."
git clean -fd

# 2. –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å
echo ""
echo "üìä –¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å:"
git status

echo ""
echo "‚úÖ –õ–æ–∫–∞–ª—å–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!"
echo ""

# –°–ø—Ä–∞—à–∏–≤–∞–µ–º –æ force push
read -p "‚ùì –£–¥–∞–ª–∏—Ç—å –∫–æ–º–º–∏—Ç—ã –Ω–∞ —É–¥–∞–ª–µ–Ω–Ω–æ–º —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ (origin/main)? [y/N]: " -n 1 -r
echo
if [[ $REPLY =~ ^[Yy]$ ]]; then
    echo "üöÄ –í—ã–ø–æ–ª–Ω—è—é force push..."
    git push --force origin main
    echo "‚úÖ –ö–æ–º–º–∏—Ç—ã –Ω–∞ —É–¥–∞–ª–µ–Ω–Ω–æ–º —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ —É–¥–∞–ª–µ–Ω—ã!"
else
    echo "‚ö†Ô∏è  –î–ª—è —É–¥–∞–ª–µ–Ω–∏—è –∫–æ–º–º–∏—Ç–æ–≤ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ –≤—Ä—É—á–Ω—É—é:"
    echo "   git push --force origin main"
fi

echo ""
echo "‚ú® –ì–æ—Ç–æ–≤–æ!"
