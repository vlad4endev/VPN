# üîë –§–∏–Ω–∞–ª—å–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è "–ü–æ–ª—É—á–∏—Ç—å –∫–ª—é—á"

## ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ —Å–æ–≥–ª–∞—Å–Ω–æ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º

### 1. UUID –∏–∑ –ø—Ä–æ—Ñ–∏–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `user.uuid` –∏–∑ –∫–∞—Ä—Ç–æ—á–∫–∏ –ª–∏—á–Ω–æ–≥–æ –∫–∞–±–∏–Ω–µ—Ç–∞ (–≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏)
- ‚úÖ –ù–µ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –Ω–æ–≤—ã–π UUID, –µ—Å–ª–∏ –æ–Ω —É–∂–µ –µ—Å—Ç—å

### 2. –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ —Ç–∞—Ä–∏—Ñ–∞ –∏ —Å—Ä–æ–∫–∞ –æ–ø–ª–∞—Ç—ã
- ‚úÖ `totalGB`: –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –ø–æ —Ç–∞—Ä–∏—Ñ—É (`tariff.trafficGB`)
- ‚úÖ `limitIp`: –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è —Ç–∞—Ä–∏—Ñ–∞ (`tariff.devices`) –ª–∏–±–æ –≤—ã–±—Ä–∞–Ω–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (`user.devices`)
- ‚úÖ `expiryTime`: —Å—Ä–æ–∫ —Ä–∞–±–æ—Ç—ã –ø–æ–¥–ø–∏—Å–∫–∏ —Å–æ–≥–ª–∞—Å–Ω–æ –æ–ø–ª–∞—Ç–µ (`user.expiresAt`) –∏–ª–∏ —Ç–µ—Å—Ç–æ–≤—ã–µ 24 —á–∞—Å–∞

### 3. –°–µ—Å—Å–∏—è –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ –ò—â–µ—Ç—Å—è –∞–∫—Ç–∏–≤–Ω—ã–π —Å–µ—Ä–≤–µ—Ä —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–æ–π —Å–µ—Å—Å–∏–µ–π
- ‚úÖ –ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è —Å—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è —Å–µ—Å—Å–∏–∏ (1 —á–∞—Å)
- ‚úÖ –ü–µ—Ä–µ–¥–∞—é—Ç—Å—è –¥–∞–Ω–Ω—ã–µ —Å–µ—Ä–≤–µ—Ä–∞: `sessionCookie`, `serverIP`, `serverPort`, `randompath`, `protocol`
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `inboundId` –∏–∑ –Ω–∞—Å—Ç—Ä–æ–µ–∫ —Å–µ—Ä–≤–µ—Ä–∞ (`server.xuiInboundId`)

### 4. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è
- ‚úÖ `subId`: –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è
- ‚úÖ `tgId`: –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –∏–∑ Telegram
- ‚úÖ `email`: –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ –ø—Ä–æ—Ñ–∏–ª—è (`user.name`)

---

## üìã –§–æ—Ä–º–∞—Ç –∑–∞–ø—Ä–æ—Å–∞

### –ó–∞–≥–æ–ª–æ–≤–∫–∏ (Backend ‚Üí 3x-ui)
```json
{
  "Accept": "application/json",
  "Content-Type": "application/json",
  "Cookie": "{–¥–∞–Ω–Ω—ã–µ –∏–∑ —Å–µ—Å—Å–∏–∏}"
}
```

### –¢–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞ (Backend ‚Üí 3x-ui)
```json
{
  "id": 3,
  "settings": "{\"clients\": [{\"id\": \"uuid-from-profile\",\"flow\": \"xtls-rprx-vision\",\"email\": \"user-name-from-profile\",\"limitIp\": 2,\"totalGB\": 100,\"expiryTime\": 1735689600,\"enable\": true,\"tgId\":\"\",\"subId\": \"sub-id-from-registration\",\"reset\": 0}]}"
}
```

**–ü–æ–ª—è:**
- `id`: ID –∏–Ω–±–∞—É–Ω–¥–∞ –∏–∑ –Ω–∞—Å—Ç—Ä–æ–µ–∫ —Å–µ—Ä–≤–µ—Ä–∞ (`server.xuiInboundId`)
- `settings`: JSON —Å—Ç—Ä–æ–∫–∞ —Å –æ–±—ä–µ–∫—Ç–æ–º clients:
  - `id`: UUID –∏–∑ –∫–∞—Ä—Ç–æ—á–∫–∏ –ª–∏—á–Ω–æ–≥–æ –∫–∞–±–∏–Ω–µ—Ç–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  - `flow`: "xtls-rprx-vision"
  - `email`: –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ –ø—Ä–æ—Ñ–∏–ª—è (`user.name`)
  - `limitIp`: –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è —Ç–∞—Ä–∏—Ñ–∞ –ª–∏–±–æ –≤—ã–±—Ä–∞–Ω–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  - `totalGB`: –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –ø–æ —Ç–∞—Ä–∏—Ñ—É
  - `expiryTime`: —Å—Ä–æ–∫ —Ä–∞–±–æ—Ç—ã –ø–æ–¥–ø–∏—Å–∫–∏ —Å–æ–≥–ª–∞—Å–Ω–æ –æ–ø–ª–∞—Ç–µ –ª–∏–±–æ —Ç–µ—Å—Ç–æ–≤—ã–µ 24 —á–∞—Å–∞ (–≤ —Å–µ–∫—É–Ω–¥–∞—Ö, Unix timestamp)
  - `enable`: true
  - `tgId`: –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –∏–∑ Telegram
  - `subId`: –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  - `reset`: 0

---

## üîÑ –ü–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö

```
Dashboard ‚Üí "–ü–æ–ª—É—á–∏—Ç—å –∫–ª—é—á"
    ‚Üì
dashboardService.getKey(user)
    ‚Üì
1. –ü—Ä–æ–≤–µ—Ä–∫–∞ UUID –∏–∑ –ø—Ä–æ—Ñ–∏–ª—è (user.uuid)
2. –ó–∞–≥—Ä—É–∑–∫–∞ —Ç–∞—Ä–∏—Ñ–∞ –∏–∑ Firestore (user.tariffId)
   - totalGB = tariff.trafficGB
   - limitIp = tariff.devices || user.devices
3. –ü–æ–∏—Å–∫ –∞–∫—Ç–∏–≤–Ω–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞ —Å —Å–µ—Å—Å–∏–µ–π
   - sessionCookie, serverIP, serverPort, randompath, protocol
   - inboundId = server.xuiInboundId
4. –ü–æ–ª—É—á–µ–Ω–∏–µ subId –∏ tgId –∏–∑ –ø—Ä–æ—Ñ–∏–ª—è
5. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ expiryTime:
   - –ï—Å–ª–∏ user.expiresAt > 0 ‚Üí –∏—Å–ø–æ–ª—å–∑—É–µ–º –µ–≥–æ
   - –ò–Ω–∞—á–µ ‚Üí —Ç–µ—Å—Ç–æ–≤—ã–µ 24 —á–∞—Å–∞
    ‚Üì
XUIService.addClient({
  clientId: user.uuid,
  email: user.name,
  inboundId: server.xuiInboundId,
  totalGB: tariff.trafficGB,
  expiryTime: user.expiresAt || 24 —á–∞—Å–∞,
  limitIp: tariff.devices || user.devices,
  subId: user.subId,
  tgId: user.tgId,
  sessionCookie, serverIP, serverPort, randompath, protocol
})
    ‚Üì
Backend Proxy
    ‚Üì
1. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç sessionCookie –∏–∑ –±–∞–∑—ã
2. –§–æ—Ä–º–∏—Ä—É–µ—Ç baseUrl –∏–∑ –¥–∞–Ω–Ω—ã—Ö —Å–µ—Ä–≤–µ—Ä–∞
3. –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç expiryTime –≤ —Å–µ–∫—É–Ω–¥—ã (–µ—Å–ª–∏ > 0, –∏–Ω–∞—á–µ 24 —á–∞—Å–∞)
4. –§–æ—Ä–º–∏—Ä—É–µ—Ç –∑–∞–ø—Ä–æ—Å —Å–æ–≥–ª–∞—Å–Ω–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏
    ‚Üì
3x-ui API
```

---

## üìù –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö

### –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å (Firestore)
```javascript
{
  uuid: "uuid-from-registration",  // UUID –∏–∑ –∫–∞—Ä—Ç–æ—á–∫–∏ –ª–∏—á–Ω–æ–≥–æ –∫–∞–±–∏–Ω–µ—Ç–∞
  name: "–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è",        // –ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ –ø—Ä–æ—Ñ–∏–ª—è
  email: "user@example.com",       // Email
  tariffId: "tariff-id",           // ID —Ç–∞—Ä–∏—Ñ–∞
  devices: 2,                      // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤
  expiresAt: 1735689600000,        // –°—Ä–æ–∫ –æ–ø–ª–∞—Ç—ã (–≤ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥–∞—Ö)
  subId: "sub-id-from-registration", // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
  tgId: "telegram-id"              // –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –∏–∑ Telegram
}
```

### –¢–∞—Ä–∏—Ñ (Firestore)
```javascript
{
  trafficGB: 100,    // –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –ø–æ —Ç–∞—Ä–∏—Ñ—É
  devices: 2,        // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤
  durationDays: 30   // –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Ç–∞—Ä–∏—Ñ–∞
}
```

### –°–µ—Ä–≤–µ—Ä (Firestore)
```javascript
{
  active: true,
  xuiInboundId: 3,                    // ID –∏–Ω–±–∞—É–Ω–¥–∞ –∏–∑ –Ω–∞—Å—Ç—Ä–æ–µ–∫ —Å–µ—Ä–≤–µ—Ä–∞
  sessionCookie: "3x-ui=...",         // –°–µ—Å—Å–∏—è –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
  sessionCookieReceivedAt: "2025-01-27T...",
  serverIP: "84.201.161.204",
  serverPort: 40919,
  randompath: "Gxckr4KcZGtB6aOZdw",
  protocol: "https"
}
```

---

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã

1. **UUID**: –î–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤ –ø—Ä–æ—Ñ–∏–ª–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏)
2. **–°–µ—Å—Å–∏—è**: –î–æ–ª–∂–Ω–∞ –±—ã—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö (—á–µ—Ä–µ–∑ "–¢–µ—Å—Ç —Å–µ—Å—Å–∏–∏" –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö —Å–µ—Ä–≤–µ—Ä–∞)
3. **–¢–∞—Ä–∏—Ñ**: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ–ª–∂–µ–Ω –∏–º–µ—Ç—å `tariffId` –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –ª–∏–º–∏—Ç–æ–≤
4. **expiryTime**: –ï—Å–ª–∏ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω —Å—Ä–æ–∫ –æ–ø–ª–∞—Ç—ã, –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Ç–µ—Å—Ç–æ–≤—ã–µ 24 —á–∞—Å–∞
5. **limitIp**: –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: `tariff.devices` ‚Üí `user.devices` ‚Üí 1 (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
6. **inboundId**: –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: `server.xuiInboundId` ‚Üí `VITE_XUI_INBOUND_ID` ‚Üí 1 (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)

---

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 2025-01-27  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é
