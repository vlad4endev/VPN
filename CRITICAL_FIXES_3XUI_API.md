# üîß –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ—Ç–æ–∫–æ–ª–∞ 3x-ui API

## ‚ùå –ù–∞–π–¥–µ–Ω–Ω—ã–µ –æ—à–∏–±–∫–∏ –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### 1. ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ: –§–æ—Ä–º–∞—Ç `totalGB` (–ö–†–ò–¢–ò–ß–ù–û!)

**–û—à–∏–±–∫–∞:**
- –ü–µ—Ä–µ–¥–∞–≤–∞–ª–æ—Å—å –∑–Ω–∞—á–µ–Ω–∏–µ –≤ –≥–∏–≥–∞–±–∞–π—Ç–∞—Ö (–Ω–∞–ø—Ä–∏–º–µ—Ä, `100`)
- 3x-ui –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∏—Ä–æ–≤–∞–ª —ç—Ç–æ –∫–∞–∫ **100 –±–∞–π—Ç** –≤–º–µ—Å—Ç–æ 100 GB

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
```javascript
// –ë–´–õ–û:
totalGB: totalGB  // 100 (GB) ‚Üí 3x-ui –≤–∏–¥–∏—Ç –∫–∞–∫ 100 –±–∞–π—Ç ‚ùå

// –°–¢–ê–õ–û:
const trafficInBytes = totalGB > 0 ? totalGB * 1024 * 1024 * 1024 : 0
totalGB: trafficInBytes  // 100 GB = 107374182400 –±–∞–π—Ç ‚úÖ
```

**–§–∞–π–ª:** `server/xui-backend-proxy.js` (—Å—Ç—Ä–æ–∫–∞ ~496)

---

### 2. ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ: –§–æ—Ä–º–∞—Ç `expiryTime` (–ö–†–ò–¢–ò–ß–ù–û!)

**–û—à–∏–±–∫–∞:**
- –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞–ª–æ—Å—å –∏–∑ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥ –≤ —Å–µ–∫—É–Ω–¥—ã
- 3x-ui –æ–∂–∏–¥–∞–µ—Ç **–º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥—ã** (Unix Timestamp * 1000)
- –ü—Ä–∏ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ –≤ —Å–µ–∫—É–Ω–¥—ã –ø–æ–¥–ø–∏—Å–∫–∞ "–∏—Å—Ç–µ–∫–∞–ª–∞" –≤ 1970 –≥–æ–¥—É

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
```javascript
// –ë–´–õ–û:
if (expiryTime > 0) {
  clientSettings.expiryTime = Math.floor(expiryTime / 1000)  // ‚ùå –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≤ —Å–µ–∫—É–Ω–¥—ã
}

// –°–¢–ê–õ–û:
let expiryTimestamp = expiryTime
if (!expiryTimestamp || expiryTimestamp <= 0) {
  expiryTimestamp = Date.now() + (24 * 60 * 60 * 1000)  // ‚úÖ –û—Å—Ç–∞–µ—Ç—Å—è –≤ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥–∞—Ö
}
clientSettings.expiryTime = expiryTimestamp  // ‚úÖ –ü–µ—Ä–µ–¥–∞–µ–º –≤ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥–∞—Ö
```

**–§–∞–π–ª:** `server/xui-backend-proxy.js` (—Å—Ç—Ä–æ–∫–∞ ~502-512)

---

### 3. ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ: –≠–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ JSON –≤ `settings`

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –ü—Ä–∏ —Ä—É—á–Ω–æ–º —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–∏ —Å—Ç—Ä–æ–∫–∏ JSON –º–æ–≥–ª–∏ –≤–æ–∑–Ω–∏–∫–Ω—É—Ç—å –æ—à–∏–±–∫–∏ –ø—Ä–∏ —Å–ø–µ—Ü—Å–∏–º–≤–æ–ª–∞—Ö
- –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –º–æ–≥–ª–æ —Å–ª–æ–º–∞—Ç—å JSON

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
```javascript
// –ë–´–õ–û:
const settings = "{\"clients\": [{...}]}"  // ‚ùå –†—É—á–Ω–æ–µ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ

// –°–¢–ê–õ–û:
const settings = JSON.stringify({
  clients: [clientSettings]
})  // ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ JSON.stringify
```

**–§–∞–π–ª:** `server/xui-backend-proxy.js` (—Å—Ç—Ä–æ–∫–∞ ~523-526)

---

### 4. ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ: –õ–æ–≥–∏–∫–∞ `expiryTime` –¥–ª—è —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –ø–µ—Ä–∏–æ–¥–∞

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –ü—Ä–∏ –∫–∞–∂–¥–æ–º –Ω–∞–∂–∞—Ç–∏–∏ "–ü–æ–ª—É—á–∏—Ç—å –∫–ª—é—á" —Å—Ä–æ–∫ –æ–±–Ω–æ–≤–ª—è–ª—Å—è –µ—â–µ –Ω–∞ 24 —á–∞—Å–∞
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–≥ –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ –ø—Ä–æ–¥–ª–µ–≤–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–π –ø–µ—Ä–∏–æ–¥

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
```javascript
// –ë–´–õ–û:
if (!expiryTime || expiryTime === 0) {
  expiryTime = Date.now() + (24 * 60 * 60 * 1000)  // ‚ùå –ö–∞–∂–¥—ã–π —Ä–∞–∑ +24 —á–∞—Å–∞
}

// –°–¢–ê–õ–û:
if (!expiryTime || expiryTime === 0) {
  const firstKeyDate = user.firstKeyDate || user.createdAt
  
  if (firstKeyDate) {
    // –ò—Å–ø–æ–ª—å–∑—É–µ–º –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—É—é –¥–∞—Ç—É + 24 —á–∞—Å–∞
    expiryTime = new Date(firstKeyDate).getTime() + (24 * 60 * 60 * 1000)  // ‚úÖ
  } else {
    // –ü–µ—Ä–≤–æ–µ –ø–æ–ª—É—á–µ–Ω–∏–µ - —Ñ–∏–∫—Å–∏—Ä—É–µ–º –¥–∞—Ç—É –≤ Firestore
    expiryTime = Date.now() + (24 * 60 * 60 * 1000)
    await updateDoc(userDoc, {
      firstKeyDate: new Date().toISOString()  // ‚úÖ –§–∏–∫—Å–∏—Ä—É–µ–º –¥–∞—Ç—É
    })
  }
}
```

**–§–∞–π–ª:** `src/features/dashboard/services/dashboardService.js` (—Å—Ç—Ä–æ–∫–∞ ~198-230)

---

### 5. ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ: –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å—á–µ—Ç—á–∏–∫–æ–≤ `up` –∏ `down`

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –û—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª–∏ —Å—á–µ—Ç—á–∏–∫–∏ —Ç—Ä–∞—Ñ–∏–∫–∞
- –ú–æ–≥–ª–∏ –≤–æ–∑–Ω–∏–∫–Ω—É—Ç—å –ø—Ä–æ–±–ª–µ–º—ã —Å –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
```javascript
const clientSettings = {
  // ... –¥—Ä—É–≥–∏–µ –ø–æ–ª—è
  up: 0,    // ‚úÖ –°—á–µ—Ç—á–∏–∫ –≤—Ö–æ–¥—è—â–µ–≥–æ —Ç—Ä–∞—Ñ–∏–∫–∞ (–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è)
  down: 0,  // ‚úÖ –°—á–µ—Ç—á–∏–∫ –∏—Å—Ö–æ–¥—è—â–µ–≥–æ —Ç—Ä–∞—Ñ–∏–∫–∞ (–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è)
}
```

**–§–∞–π–ª:** `server/xui-backend-proxy.js` (—Å—Ç—Ä–æ–∫–∞ ~519-520)

---

### 6. ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ: –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø—Ä–æ–±–µ–ª–æ–≤ –≤ `email`

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –ü—Ä–æ–±–µ–ª—ã –≤ –ø–æ–ª–µ `email` –º–æ–≥–ª–∏ –≤—ã–∑–≤–∞—Ç—å –±–∞–≥–∏ –≤ –ø—É—Ç—è—Ö –ø–æ–¥–ø–∏—Å–∫–∏
- 3x-ui –Ω–µ –ª—é–±–∏—Ç –ø—Ä–æ–±–µ–ª—ã –≤ email

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
```javascript
// –ë–´–õ–û:
email: email  // ‚ùå –ú–æ–∂–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å –ø—Ä–æ–±–µ–ª—ã

// –°–¢–ê–õ–û:
const cleanEmail = (email || '').replace(/\s+/g, '_')  // ‚úÖ –ó–∞–º–µ–Ω—è–µ–º –ø—Ä–æ–±–µ–ª—ã –Ω–∞ –ø–æ–¥—á–µ—Ä–∫–∏–≤–∞–Ω–∏—è
email: cleanEmail
```

**–§–∞–π–ª:** `server/xui-backend-proxy.js` (—Å—Ç—Ä–æ–∫–∞ ~503)

---

## üìã –ò—Ç–æ–≥–æ–≤—ã–π —Ñ–æ—Ä–º–∞—Ç –∑–∞–ø—Ä–æ—Å–∞

### –ó–∞–≥–æ–ª–æ–≤–∫–∏
```json
{
  "Accept": "application/json",
  "Content-Type": "application/json",
  "Cookie": "{–¥–∞–Ω–Ω—ã–µ –∏–∑ —Å–µ—Å—Å–∏–∏}"
}
```

### –¢–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞
```json
{
  "id": 3,
  "settings": "{\"clients\": [{\"id\": \"uuid-from-profile\",\"flow\": \"xtls-rprx-vision\",\"email\": \"user_name_from_profile\",\"limitIp\": 2,\"totalGB\": 107374182400,\"expiryTime\": 1735689600000,\"enable\": true,\"tgId\":\"\",\"subId\": \"sub-id\",\"reset\": 0,\"up\": 0,\"down\": 0}]}"
}
```

**–ö–ª—é—á–µ–≤—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è:**
- `totalGB`: **107374182400** (–±–∞–π—Ç—ã) –≤–º–µ—Å—Ç–æ `100` (GB)
- `expiryTime`: **1735689600000** (–º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥—ã) –≤–º–µ—Å—Ç–æ `1735689600` (—Å–µ–∫—É–Ω–¥—ã)
- `email`: **"user_name_from_profile"** (–±–µ–∑ –ø—Ä–æ–±–µ–ª–æ–≤) –≤–º–µ—Å—Ç–æ `"user name"`
- `up` –∏ `down`: **0** (–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω—ã)

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ —Ç—Ä–∞—Ñ–∏–∫–∞:
```javascript
// 100 GB –¥–æ–ª–∂–Ω–æ —Å—Ç–∞—Ç—å:
100 * 1024 * 1024 * 1024 = 107374182400 –±–∞–π—Ç
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ expiryTime:
```javascript
// –î–æ–ª–∂–Ω–æ –±—ã—Ç—å –≤ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥–∞—Ö:
Date.now() = 1735689600000  // ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ
Math.floor(Date.now() / 1000) = 1735689600  // ‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ (—Å–µ–∫—É–Ω–¥—ã)
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ email:
```javascript
"–ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤".replace(/\s+/g, '_') = "–ò–≤–∞–Ω_–ò–≤–∞–Ω–æ–≤"  // ‚úÖ
```

---

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

1. **totalGB –≤ –±–∞–π—Ç–∞—Ö:** –í—Å–µ–≥–¥–∞ –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–π—Ç–µ GB –≤ –±–∞–π—Ç—ã –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π
2. **expiryTime –≤ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥–∞—Ö:** –ù–ï –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–π—Ç–µ –≤ —Å–µ–∫—É–Ω–¥—ã
3. **–§–∏–∫—Å–∞—Ü–∏—è –¥–∞—Ç—ã:** –°–æ—Ö—Ä–∞–Ω—è–π—Ç–µ `firstKeyDate` –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –ø–æ–ª—É—á–µ–Ω–∏–∏ –∫–ª—é—á–∞
4. **Email –±–µ–∑ –ø—Ä–æ–±–µ–ª–æ–≤:** –ó–∞–º–µ–Ω—è–π—Ç–µ –ø—Ä–æ–±–µ–ª—ã –Ω–∞ –ø–æ–¥—á–µ—Ä–∫–∏–≤–∞–Ω–∏—è
5. **JSON.stringify:** –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è

---

**–î–∞—Ç–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:** 2025-01-27  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –í—Å–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã
