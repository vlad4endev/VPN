version: '3.8'

services:
  skyputh-vpn:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: skyputh-vpn
    ports:
      - "3001:3001"
    environment:
      # –û–±—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
      - NODE_ENV=production
      - PROXY_PORT=3001
      - PROXY_HOST=0.0.0.0
      
      # Backend proxy –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
      - XUI_HOST=${XUI_HOST:-http://localhost:2053}
      - XUI_USERNAME=${XUI_USERNAME:-admin}
      - XUI_PASSWORD=${XUI_PASSWORD}
      - XUI_INBOUND_ID=${XUI_INBOUND_ID:-1}
      
      # CORS –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
      - ALLOWED_ORIGINS=${ALLOWED_ORIGINS:-http://localhost:3001,https://yourdomain.com}
      - FRONTEND_URL=${FRONTEND_URL:-http://localhost:3001}
      
      # Firebase (–µ—Å–ª–∏ –Ω—É–∂–µ–Ω –¥–ª—è backend)
      # - FIREBASE_PROJECT_ID=${FIREBASE_PROJECT_ID}
      # - FIREBASE_PRIVATE_KEY=${FIREBASE_PRIVATE_KEY}
    
    # –ò—Å–ø–æ–ª—å–∑—É–µ–º .env —Ñ–∞–π–ª (–ù–ï –∫–æ–ø–∏—Ä—É–µ—Ç—Å—è –≤ –æ–±—Ä–∞–∑!)
    env_file:
      - .env.production
    
    # Healthcheck
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:3001/health"]
      interval: 30s
      timeout: 5s
      retries: 3
      start_period: 10s
    
    # Restart policy
    restart: unless-stopped
    
    # Security: –Ω–µ–ø—Ä–∏–≤–∏–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å (—É–∂–µ –≤ –æ–±—Ä–∞–∑–µ)
    user: "1001:1001"
    
    # Resource limits (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
    # deploy:
    #   resources:
    #     limits:
    #       cpus: '1.0'
    #       memory: 512M
    #     reservations:
    #       cpus: '0.5'
    #       memory: 256M

# ========================================
# üìù –ò–ù–°–¢–†–£–ö–¶–ò–Ø
# ========================================
# 1. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —ç—Ç–æ—Ç —Ñ–∞–π–ª: cp docker-compose.example.yml docker-compose.yml
# 2. –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≤ .env.production
# 3. –ó–∞–ø—É—Å—Ç–∏—Ç–µ: docker-compose up -d
# 4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏: docker-compose logs -f
# ========================================
